<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Li</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Li">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Li">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Li" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Li</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-返回值和错误处理" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/07/03/%E8%BF%94%E5%9B%9E%E5%80%BC%E5%92%8C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" class="article-date">
  <time class="dt-published" datetime="2025-07-03T08:36:33.000Z" itemprop="datePublished">2025-07-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/07/03/%E8%BF%94%E5%9B%9E%E5%80%BC%E5%92%8C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/">返回值和错误处理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="panic"><a href="#panic" class="headerlink" title="panic"></a>panic</h3><p>只有当你不知道该如何处理时，再去调用 panic!</p>
<h4 id="backtrace-栈展开"><a href="#backtrace-栈展开" class="headerlink" title="backtrace 栈展开"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/result-error/panic.html#backtrace-%E6%A0%88%E5%B1%95%E5%BC%80"><font style="color:rgb(0, 0, 0);">backtrace 栈展开</font></a></h4><p> 自动开启 backtrace（调试 panic）  </p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">RUST_BACKTRACE</span>=<span class="number">1</span> cargo run</span><br></pre></td></tr></table></figure>

<p>运行代码</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let <span class="attr">v</span> = vec![<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    v<span class="section">[99]</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印如下信息</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">thread <span class="symbol">&#x27;mai</span>n<span class="string">&#x27; panicked at src/main.rs:4:6:</span></span><br><span class="line"><span class="string">index out of bounds: the len is 3 but the index is 99</span></span><br><span class="line"><span class="string">stack backtrace:</span></span><br><span class="line"><span class="string">0: __rustc::rust_begin_unwind</span></span><br><span class="line"><span class="string">at /rustc/17067e9ac6d7ecb70e50f92c1944e545188d2359/library/std/src/panicking.rs:697:5</span></span><br><span class="line"><span class="string">1: core::panicking::panic_fmt</span></span><br><span class="line"><span class="string">at /rustc/17067e9ac6d7ecb70e50f92c1944e545188d2359/library/core/src/panicking.rs:75:14</span></span><br><span class="line"><span class="string">2: core::panicking::panic_bounds_check</span></span><br><span class="line"><span class="string">at /rustc/17067e9ac6d7ecb70e50f92c1944e545188d2359/library/core/src/panicking.rs:273:5</span></span><br><span class="line"><span class="string">3: &lt;usize as core::slice::index::SliceIndex&lt;[T]&gt;&gt;::index</span></span><br><span class="line"><span class="string">at /home/lsy/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/slice/index.rs:274:10</span></span><br><span class="line"><span class="string">4: core::slice::index::&lt;impl core::ops::index::Index&lt;I&gt; for [T]&gt;::index</span></span><br><span class="line"><span class="string">at /home/lsy/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/slice/index.rs:16:9</span></span><br><span class="line"><span class="string">5: &lt;alloc::vec::Vec&lt;T,A&gt; as core::ops::index::Index&lt;I&gt;&gt;::index</span></span><br><span class="line"><span class="string">at /home/lsy/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/alloc/src/vec/mod.rs:3372:9</span></span><br><span class="line"><span class="string">6: hello_rust::main</span></span><br><span class="line"><span class="string">at ./src/main.rs:4:6</span></span><br><span class="line"><span class="string">7: core::ops::function::FnOnce::call_once</span></span><br><span class="line"><span class="string">at /home/lsy/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ops/function.rs:250:5</span></span><br><span class="line"><span class="string">note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.</span></span><br></pre></td></tr></table></figure>

<h4 id="panic-时的两种终止方式"><a href="#panic-时的两种终止方式" class="headerlink" title="panic 时的两种终止方式"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/result-error/panic.html#panic-%E6%97%B6%E7%9A%84%E4%B8%A4%E7%A7%8D%E7%BB%88%E6%AD%A2%E6%96%B9%E5%BC%8F"><font style="color:rgb(0, 0, 0);">panic 时的两种终止方式</font></a></h4><p><font style="color:rgb(0, 0, 0);">程序提供了两种方式来处理终止流程：</font><strong><font style="color:rgb(0, 0, 0);">栈展开</font></strong><font style="color:rgb(0, 0, 0);">和</font><strong><font style="color:rgb(0, 0, 0);">直接终止</font></strong><font style="color:rgb(0, 0, 0);">。</font></p>
<h5 id="直接终止"><a href="#直接终止" class="headerlink" title="直接终止"></a><font style="color:rgb(0, 0, 0);">直接终止</font></h5><p><code>panic = &#39;abort&#39;</code> 是 Rust <code>Cargo.toml</code> 中的一项构建配置，控制程序在遇到 <code>panic!()</code> 时的行为。  </p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[profile.release]</span></span><br><span class="line"><span class="attr">panic</span> = <span class="string">&#x27;abort&#x27;</span></span><br></pre></td></tr></table></figure>

<p> 当程序发生 <code>panic!()</code> 时，<strong>直接终止程序（abort）</strong>，<strong>不再进行“栈展开”（stack unwinding）</strong>。  </p>
<h3 id="result"><a href="#result" class="headerlink" title="result"></a>result</h3><h4 id="对返回的错误进行处理"><a href="#对返回的错误进行处理" class="headerlink" title="对返回的错误进行处理"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/result-error/result.html#%E5%AF%B9%E8%BF%94%E5%9B%9E%E7%9A%84%E9%94%99%E8%AF%AF%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86"><font style="color:rgb(0, 0, 0);">对返回的错误进行处理</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io::ErrorKind;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = <span class="keyword">match</span> f &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(error) =&gt; <span class="keyword">match</span> error.<span class="title function_ invoke__">kind</span>() &#123;</span><br><span class="line">            ErrorKind::NotFound =&gt; <span class="keyword">match</span> File::<span class="title function_ invoke__">create</span>(<span class="string">&quot;hello.txt&quot;</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">Ok</span>(fc) =&gt; fc,</span><br><span class="line">                <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;Problem creating the file: &#123;:?&#125;&quot;</span>, e),</span><br><span class="line">            &#125;,</span><br><span class="line">            other_error =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;Problem opening the file: &#123;:?&#125;&quot;</span>, other_error),</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//  也可以写成下面这样</span></span><br><span class="line">    <span class="comment">// let f = File::open(&quot;hello.txt&quot;).unwrap_or_else(|error|&#123;</span></span><br><span class="line">    <span class="comment">//     if error.kind() == ErrorKind::NotFound &#123;</span></span><br><span class="line">    <span class="comment">//         File::create(&quot;hello.txt&quot;).unwrap_or_else(|error| &#123;</span></span><br><span class="line">    <span class="comment">//             panic!(&quot;&#123;:?&#125;&quot;, error)</span></span><br><span class="line">    <span class="comment">//         &#125;)</span></span><br><span class="line">    <span class="comment">//     &#125; else &#123;</span></span><br><span class="line">    <span class="comment">//         panic!(&quot;&#123;:?&#125;&quot;, error)</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="失败就-panic-unwrap-和-expect"><a href="#失败就-panic-unwrap-和-expect" class="headerlink" title="失败就 panic: unwrap 和 expect"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/result-error/result.html#%E5%A4%B1%E8%B4%A5%E5%B0%B1-panic-unwrap-%E5%92%8C-expect"><font style="color:rgb(0, 0, 0);">失败就 panic: unwrap 和 expect</font></a></h4><p><code>unwrap()</code>：直接解包，不成功就 panic  </p>
<p><code>expect(&quot;message&quot;)</code>：解包失败时自定义 panic 消息  </p>
<table>
<thead>
<tr>
<th>方法</th>
<th>是否支持自定义错误消息</th>
<th>panic 时显示信息</th>
<th>推荐用途</th>
</tr>
</thead>
<tbody><tr>
<td><code>unwrap()</code></td>
<td>否</td>
<td>默认提示</td>
<td>临时测试、原型开发</td>
</tr>
<tr>
<td><code>expect()</code></td>
<td>✅ 支持</td>
<td>自定义信息</td>
<td>生产代码，能明确报错场景</td>
</tr>
</tbody></table>
<h5 id="何时不要用-unwrap-expect"><a href="#何时不要用-unwrap-expect" class="headerlink" title="何时不要用 unwrap &#x2F; expect"></a>何时不要用 unwrap &#x2F; expect</h5><p><strong>只在你非常确定不会出错的地方使用</strong>（如刚插入哈希表就 <code>get()</code>）</p>
<p>否则建议使用：</p>
<ul>
<li><code>match</code></li>
<li><code>if let</code></li>
<li><code>unwrap_or()</code> &#x2F; <code>unwrap_or_else()</code></li>
<li><code>?</code> 运算符（推荐！）</li>
</ul>
<h4 id="传播错误"><a href="#传播错误" class="headerlink" title="传播错误"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/result-error/result.html#%E4%BC%A0%E6%92%AD%E9%94%99%E8%AF%AF"><font style="color:rgb(0, 0, 0);">传播错误</font></a></h4><h4 id="自动处理错误的“语法糖”"><a href="#自动处理错误的“语法糖”" class="headerlink" title="?自动处理错误的“语法糖”"></a>?自动处理错误的“语法糖”</h4><p>它的作用是：</p>
<ul>
<li>如果是成功（<code>Ok</code> 或 <code>Some</code>），就把值取出来；</li>
<li>如果是失败（<code>Err</code> 或 <code>None</code>），就<strong>提前返回</strong>，不往下执行。</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">value</span> = <span class="title function_ invoke__">maybe_error</span>()?; <span class="comment">// 如果错误就自动 return</span></span><br></pre></td></tr></table></figure>

<h4 id="在哪些地方可以用"><a href="#在哪些地方可以用" class="headerlink" title="在哪些地方可以用 ?"></a>在哪些地方可以用 ?</h4><p> 条件 1：你正在处理一个 <code>Result&lt;T, E&gt;</code> 或 <code>Option&lt;T&gt;</code> 类型  </p>
<p> 条件 2:   你的<strong>当前函数</strong>返回的也是 <code>Result</code> 或 <code>Option</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">read_file</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, std::io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">content</span> = std::fs::<span class="title function_ invoke__">read_to_string</span>(<span class="string">&quot;hello.txt&quot;</span>)?;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(content)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>内容</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>?</code> 是什么</td>
<td>错误传播工具：成功就继续，失败就自动 return</td>
</tr>
<tr>
<td>适用于什么</td>
<td><code>Result&lt;T, E&gt;</code> 或 <code>Option&lt;T&gt;</code> 类型</td>
</tr>
<tr>
<td>要求</td>
<td>当前函数也必须返回 <code>Result</code> 或 <code>Option</code></td>
</tr>
<tr>
<td>作用</td>
<td>省去很多 if&#x2F;match，代码更简洁清爽</td>
</tr>
<tr>
<td>不能用</td>
<td>main() 不返回 Result 时、非 Result 类型上</td>
</tr>
</tbody></table>
<h3 id="Box或-anyhow-Result"><a href="#Box或-anyhow-Result" class="headerlink" title="Box或 anyhow::Result"></a>Box<dyn Error>或 anyhow::Result</h3><h4 id="Box"><a href="#Box" class="headerlink" title="Box"></a>Box<dyn Error></h4><p><code>Box&lt;dyn Error&gt;</code> 表示：“我不关心具体是哪种错误，只要它实现了 <code>std::error::Error</code>，我都能接收。就像一个“万能盒子”装错误，能装：</p>
<ul>
<li>I&#x2F;O 错误（<code>std::io::Error</code>）</li>
<li>字符串解析错误（<code>std::num::ParseIntError</code>）</li>
<li>环境变量错误（<code>std::env::VarError</code>）</li>
<li>…等等，只要实现了 <code>Error</code> trait</li>
</ul>
<h4 id="anyhow-Result"><a href="#anyhow-Result" class="headerlink" title="anyhow::Result"></a>anyhow::Result</h4><p><code>anyhow</code> 是一个第三方 crate，用于简化错误处理。你可以在 <code>Cargo.toml</code> 中添加：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">anyhow</span> = <span class="string">&quot;1&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> anyhow::&#123;Context, <span class="type">Result</span>&#125;; <span class="comment">// 导入 Result = anyhow::Result</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = <span class="title function_ invoke__">file_read</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, f);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">file_read</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;File&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>)</span><br><span class="line">        .<span class="title function_ invoke__">context</span>(<span class="string">&quot;not found hello.txt&quot;</span>)?; <span class="comment">// 如果失败，自动返回并附加错误信息</span></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>特性</th>
<th><code>Box&lt;dyn Error&gt;</code></th>
<th><code>anyhow::Result&lt;T&gt;</code></th>
</tr>
</thead>
<tbody><tr>
<td>属于标准库</td>
<td>✅ 是</td>
<td>❌ 需要引入第三方 crate</td>
</tr>
<tr>
<td>错误信息丰富</td>
<td>❌ 错误链较弱</td>
<td>✅ 有上下文 <code>.context()</code>、更易调试</td>
</tr>
<tr>
<td>使用简便程度</td>
<td>一般，需要自己 wrap</td>
<td>更高，写业务代码几乎不用关心错误类型</td>
</tr>
<tr>
<td>适合用途</td>
<td>小项目、库内部统一错误</td>
<td>业务代码、命令行工具、服务端程序（推荐）</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/07/03/%E8%BF%94%E5%9B%9E%E5%80%BC%E5%92%8C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" data-id="cmcn4u1bb000ulrqw0hnjcarj" data-title="返回值和错误处理" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-集合" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/07/02/%E9%9B%86%E5%90%88/" class="article-date">
  <time class="dt-published" datetime="2025-07-02T08:42:13.000Z" itemprop="datePublished">2025-07-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/07/02/%E9%9B%86%E5%90%88/">集合</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="动态数组-Vector"><a href="#动态数组-Vector" class="headerlink" title="动态数组 Vector"></a><a target="_blank" rel="noopener" href="https://doc.rust-lang.org/std/vec/struct.Vec.html#method.push">动态数组 Vector</a></h3><h4 id="创建动态数组"><a href="#创建动态数组" class="headerlink" title="创建动态数组"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/collections/vector.html#%E5%88%9B%E5%BB%BA%E5%8A%A8%E6%80%81%E6%95%B0%E7%BB%84"><font style="color:rgb(0, 0, 0);">创建动态数组</font></a></h4><h5 id="Vec-new"><a href="#Vec-new" class="headerlink" title="Vec::new"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/collections/vector.html#vecnew"><font style="color:rgb(0, 0, 0);">Vec::new</font></a></h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br></pre></td></tr></table></figure>

<h5 id="Vec-with-capacity-capacity-创建定长的数组"><a href="#Vec-with-capacity-capacity-创建定长的数组" class="headerlink" title="Vec::with_capacity(capacity)创建定长的数组"></a>Vec::with_capacity(capacity)创建定长的数组</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">with_capacity</span>(<span class="number">10</span>);</span><br><span class="line">v.<span class="title function_ invoke__">push</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h5 id="vec"><a href="#vec" class="headerlink" title="vec![]"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/collections/vector.html#vec"><font style="color:rgb(0, 0, 0);">vec![]</font></a></h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="built_in">vec!</span>[<span class="number">1</span>;<span class="number">5</span>];</span><br><span class="line"><span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> x.<span class="title function_ invoke__">iter</span>()&#123;</span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>对比项</th>
<th><code>Vec::new()</code></th>
<th><code>vec![]</code> 宏</th>
</tr>
</thead>
<tbody><tr>
<td>类型推导</td>
<td><strong>需要显式指定类型</strong>或上下文推导</td>
<td><strong>自动根据内容推导类型</strong></td>
</tr>
<tr>
<td>初始元素</td>
<td>不支持初始化内容</td>
<td>✅ 支持一次性填充多个元素</td>
</tr>
<tr>
<td>用法语法</td>
<td>是函数（<code>fn new() -&gt; Vec&lt;T&gt;</code>）</td>
<td>是宏（<code>macro_rules!</code>）</td>
</tr>
<tr>
<td>性能</td>
<td>相同，都生成空向量（或相同初始化）</td>
<td>没有明显性能差异</td>
</tr>
</tbody></table>
<p> 想空用 <code>new</code>，想填用 <code>vec![]</code>，想简用宏  </p>
<h4 id="从-Vector-中读取元素"><a href="#从-Vector-中读取元素" class="headerlink" title="从 Vector 中读取元素"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/collections/vector.html#%E4%BB%8E-vector-%E4%B8%AD%E8%AF%BB%E5%8F%96%E5%85%83%E7%B4%A0"><font style="color:rgb(0, 0, 0);">从 Vector 中读取元素</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::vec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span>= <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">match</span> v.<span class="title function_ invoke__">get</span>(<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(b) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,b),</span><br><span class="line">        <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;None&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(b) = v.<span class="title function_ invoke__">get</span>(<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>get和通过下标获取元素的区别是:get索引越界不会报错返回的是option</p>
<h3 id="KV-存储-HashMap"><a href="#KV-存储-HashMap" class="headerlink" title="KV 存储 HashMap"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/collections/hashmap.html#kv-%E5%AD%98%E5%82%A8-hashmap"><font style="color:rgb(0, 0, 0);">KV 存储 HashMap</font></a></h3><h4 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个HashMap，用于存储宝石种类和对应的数量</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">my_gems</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将宝石类型和对应的数量写入表中</span></span><br><span class="line">my_gems.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;红宝石&quot;</span>, <span class="number">1</span>);</span><br><span class="line">my_gems.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;蓝宝石&quot;</span>, <span class="number">2</span>);</span><br><span class="line">my_gems.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;河边捡的误以为是宝石的破石头&quot;</span>, <span class="number">18</span>);</span><br></pre></td></tr></table></figure>

<h4 id="所有权转移"><a href="#所有权转移" class="headerlink" title="所有权转移"></a>所有权转移</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">name</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Sunface&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">age</span> = <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">handsome_boys</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    handsome_boys.<span class="title function_ invoke__">insert</span>(name, age);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;因为过于无耻，&#123;&#125;已经被从帅气男孩名单中除名&quot;</span>, name);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;还有，他的真实年龄远远不止&#123;&#125;岁&quot;</span>, age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="查询-HashMap"><a href="#查询-HashMap" class="headerlink" title="查询 HashMap"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/collections/hashmap.html#%E6%9F%A5%E8%AF%A2-hashmap"><font style="color:rgb(0, 0, 0);">查询 HashMap</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"><span class="keyword">let</span> <span class="variable">key</span> =  scores.<span class="title function_ invoke__">get</span>(<span class="string">&quot;key&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>优雅的获取k-v</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">score</span>: <span class="type">i32</span> = scores.<span class="title function_ invoke__">get</span>(&amp;team_name).<span class="title function_ invoke__">copied</span>().<span class="title function_ invoke__">unwrap_or</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>完整流程：</p>
<ol>
<li><code>scores.get(&amp;team_name)</code> → <code>Option&lt;&amp;i32&gt;</code></li>
<li><code>.copied()</code> → <code>Option&lt;i32&gt;</code></li>
<li><code>.unwrap_or(0)</code> → 若存在值就返回，否则返回默认的 <code>0</code></li>
</ol>
<h4 id="三方库-Hash-库"><a href="#三方库-Hash-库" class="headerlink" title="三方库 Hash 库"></a><a target="_blank" rel="noopener" href="https://practice-zh.course.rs/collections/hashmap.html#%E4%B8%89%E6%96%B9%E5%BA%93-hash-%E5%BA%93"><font style="color:rgb(0, 0, 0);">三方库 Hash 库</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"><span class="keyword">use</span> std::hash::BuildHasherDefault;</span><br><span class="line"><span class="keyword">use</span> twox_hash::XxHash64;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">hash</span>:HashMap&lt;_, _,BuildHasherDefault&lt;XxHash64&gt;&gt;=<span class="built_in">Default</span>::<span class="title function_ invoke__">default</span>();</span><br><span class="line">    hash.<span class="title function_ invoke__">insert</span>(<span class="number">1</span>, <span class="string">&quot;one&quot;</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(hash.<span class="title function_ invoke__">get</span>(&amp;<span class="number">1</span>), <span class="title function_ invoke__">Some</span>(&amp;<span class="string">&quot;one&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Cargo.toml 依赖</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">twox-hash</span>=<span class="string">&quot;2.1.0&quot;</span></span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/07/02/%E9%9B%86%E5%90%88/" data-id="cmcn4u1bb000wlrqw24ap8o81" data-title="集合" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-特征" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/07/01/%E7%89%B9%E5%BE%81/" class="article-date">
  <time class="dt-published" datetime="2025-07-01T13:23:53.000Z" itemprop="datePublished">2025-07-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/07/01/%E7%89%B9%E5%BE%81/">特征</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="Trait"><a href="#Trait" class="headerlink" title="Trait"></a>Trait</h3><p>特征定义了一组可以被共享的行为，只要实现了特征，你就能使用这组行为;<font style="color:rgb(0, 0, 0);">特征跟接口很类似</font></p>
<h4 id="定义特征"><a href="#定义特征" class="headerlink" title="定义特征"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/trait/trait.html#%E5%AE%9A%E4%B9%89%E7%89%B9%E5%BE%81"><font style="color:rgb(0, 0, 0);">定义特征</font></a></h4><p><strong><font style="color:rgb(0, 0, 0);">定义特征</font></strong><font style="color:rgb(0, 0, 0);">是把一些方法组合在一起，目的是定义一个实现某些目标所必需的行为的集合。</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>trait</code><font style="color:rgb(0, 0, 0);"> 关键字来声明一个特征，</font><code>Summary</code><font style="color:rgb(0, 0, 0);"> 是特征名。在大括号中定义了该特征的所有方法，在这个例子中是： </font><code>fn summarize(&amp;self) -&gt; String</code></p>
<h4 id="为类型实现特征"><a href="#为类型实现特征" class="headerlink" title="为类型实现特征"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/trait/trait.html#%E4%B8%BA%E7%B1%BB%E5%9E%8B%E5%AE%9E%E7%8E%B0%E7%89%B9%E5%BE%81"><font style="color:rgb(0, 0, 0);">为类型实现特征</font></a></h4><p><font style="color:rgb(0, 0, 0);">实现方法很像：</font><code>impl Summary for Post</code><font style="color:rgb(0, 0, 0);">，读作“为 </font><code>Post</code><font style="color:rgb(0, 0, 0);"> 类型实现 </font><code>Summary</code><font style="color:rgb(0, 0, 0);"> 特征”，然后在 </font><code>impl</code><font style="color:rgb(0, 0, 0);"> 的花括号中实现该特征的具体方法</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> title: <span class="type">String</span>, <span class="comment">// 标题</span></span><br><span class="line">    <span class="keyword">pub</span> author: <span class="type">String</span>, <span class="comment">// 作者</span></span><br><span class="line">    <span class="keyword">pub</span> content: <span class="type">String</span>, <span class="comment">// 内容</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;文章&#123;&#125;, 作者是&#123;&#125;&quot;</span>, <span class="keyword">self</span>.title, <span class="keyword">self</span>.author)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Weibo</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> username: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> content: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">Weibo</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;发表了微博&#123;&#125;&quot;</span>, <span class="keyword">self</span>.username, <span class="keyword">self</span>.content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">post</span> = Post&#123;title: <span class="string">&quot;Rust语言简介&quot;</span>.<span class="title function_ invoke__">to_string</span>(),author: <span class="string">&quot;Sunface&quot;</span>.<span class="title function_ invoke__">to_string</span>(), content: <span class="string">&quot;Rust棒极了!&quot;</span>.<span class="title function_ invoke__">to_string</span>()&#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">weibo</span> = Weibo&#123;username: <span class="string">&quot;sunface&quot;</span>.<span class="title function_ invoke__">to_string</span>(),content: <span class="string">&quot;好像微博没Tweet好用&quot;</span>.<span class="title function_ invoke__">to_string</span>()&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,post.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,weibo.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="默认实现"><a href="#默认实现" class="headerlink" title="默认实现"></a>默认实现</h4><p>默认实现的方法，这样其它类型无需再实现该方法，或者也可以选择重写该方法</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;(Read more...)&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果一个方法实现了Summary,但是没有进行重写,使用默认实现;如果重写就使用重写方法</p>
<h4 id="使用特征作为函数参数"><a href="#使用特征作为函数参数" class="headerlink" title="使用特征作为函数参数"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/trait/trait.html#%E4%BD%BF%E7%94%A8%E7%89%B9%E5%BE%81%E4%BD%9C%E4%B8%BA%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0"><font style="color:rgb(0, 0, 0);">使用特征作为函数参数</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>(item: &amp;<span class="keyword">impl</span> <span class="title class_">Summary</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如: impl Summary for A; 可以使用 notify(&amp;A)进行调用</p>
<h4 id="特征约束"><a href="#特征约束" class="headerlink" title="特征约束"></a>特征约束</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>&lt;T: Summary&gt;(item1: &amp;T, item2: &amp;T) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0, 0, 0);">泛型类型 </font><code>T</code><font style="color:rgb(0, 0, 0);"> 说明了 </font><code>item1</code><font style="color:rgb(0, 0, 0);"> 和 </font><code>item2</code><font style="color:rgb(0, 0, 0);"> 必须拥有同样的类型，同时 </font><code>T: Summary</code><font style="color:rgb(0, 0, 0);"> 说明了 </font><code>T</code><font style="color:rgb(0, 0, 0);"> 必须实现 </font><code>Summary</code><font style="color:rgb(0, 0, 0);"> 特征。</font></p>
<h4 id="多重约束"><a href="#多重约束" class="headerlink" title="多重约束"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/trait/trait.html#%E5%A4%9A%E9%87%8D%E7%BA%A6%E6%9D%9F"><font style="color:rgb(0, 0, 0);">多重约束</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>(item: &amp;(<span class="keyword">impl</span> <span class="title class_">Summary</span> + Display)) &#123;&#125;</span><br><span class="line"><span class="comment">// 个人更喜欢下面这种写法</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>&lt;T: Summary + Display&gt;(item:&amp;T)&#123;&#125;</span><br></pre></td></tr></table></figure>

<p><code>notify</code> 函数接收一个<strong>引用类型参数</strong>，这个参数的类型必须同时实现了 <code>Summary</code> 和 <code>Display</code> 这两个 trait。  </p>
<h5 id="impl-Summary-Display-是什么意思"><a href="#impl-Summary-Display-是什么意思" class="headerlink" title="(impl Summary + Display) 是什么意思"></a>(impl Summary + Display) 是什么意思</h5><p>表示类型必须同时实现：</p>
<ul>
<li><code>Summary</code>（你自定义的 trait）</li>
<li><code>Display</code>（Rust 标准库里的格式化 trait，支持 <code>&#123;&#125;</code> 打印）</li>
</ul>
<p>比如，这样的类型才能传进去：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">News</span> &#123;&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">News</span> &#123; ... &#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Display</span> <span class="keyword">for</span> <span class="title class_">News</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">notify</span>(&amp;news); <span class="comment">// ✅ 满足约束</span></span><br></pre></td></tr></table></figure>

<h5 id="什么时候用-合并多个-trait"><a href="#什么时候用-合并多个-trait" class="headerlink" title="什么时候用 + 合并多个 trait"></a>什么时候用 <code>+</code> 合并多个 trait</h5><p> 当你希望函数参数同时满足多个 trait 的约束（比如可以 <code>.sum()</code> 又可以 <code>&#123;&#125;</code> 打印），就需要用 <code>+</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt::Display;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">sum</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>(item: &amp;(<span class="keyword">impl</span> <span class="title class_">Summary</span> + Display)) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; - &#123;&#125;&quot;</span>, item, item.<span class="title function_ invoke__">sum</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>写法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>fn notify(item: &amp;impl Summary)</code></td>
<td>接收实现了 <code>Summary</code> 的引用</td>
</tr>
<tr>
<td><code>fn notify(item: &amp;impl Summary + Display)</code></td>
<td>接收实现了 <code>Summary</code> <strong>和</strong> <code>Display</code> 的引用</td>
</tr>
<tr>
<td><code>fn notify&lt;T: Summary&gt;(item: &amp;T)</code></td>
<td>等价于第 1 种，写法更通用</td>
</tr>
<tr>
<td><code>fn notify&lt;T: Summary + Display&gt;(item: &amp;T)</code></td>
<td>等价于第 2 种，更灵活</td>
</tr>
</tbody></table>
<h4 id="Where-约束"><a href="#Where-约束" class="headerlink" title="Where 约束"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/trait/trait.html#where-%E7%BA%A6%E6%9D%9F"><font style="color:rgb(0, 0, 0);">Where 约束</font></a></h4><h4 id="语法对比"><a href="#语法对比" class="headerlink" title="语法对比"></a>语法对比</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通写法：所有约束都写在 &lt;&gt; 中</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">example</span>&lt;T: TraitA + TraitB, U: TraitC&gt;(t: T, u: U) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// where 写法：约束单独写在 where 里</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">example</span>&lt;T, U&gt;(t: T, u: U)</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    T: TraitA + TraitB,</span><br><span class="line">    U: TraitC,</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>

<p> 效果一样，但 <code>where</code> 方式在约束很多时更清晰！  </p>
<h5 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt::Display;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print_pair</span>&lt;T, U&gt;(x: T, y: U)</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    T: Display,</span><br><span class="line">    U: Display,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;x: &#123;&#125;, y: &#123;&#125;&quot;</span>, x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="函数返回中的impl-Trait"><a href="#函数返回中的impl-Trait" class="headerlink" title="函数返回中的impl Trait"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/trait/trait.html#%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E4%B8%AD%E7%9A%84-impl-trait"><font style="color:rgb(0, 0, 0);">函数返回中的impl Trait</font></a></h4><ul>
<li>返回的类型太复杂（比如闭包、迭代器）</li>
<li>不想暴露类型细节</li>
<li>更清爽、简洁</li>
</ul>
<table>
<thead>
<tr>
<th>传统写法</th>
<th>impl Trait 写法</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>-&gt; String</code></td>
<td><code>-&gt; impl Display</code></td>
<td>不告诉你是 String，只说能被打印</td>
</tr>
<tr>
<td><code>-&gt; Vec&lt;i32&gt;</code></td>
<td><code>-&gt; impl Iterator&lt;Item = i32&gt;</code></td>
<td>不告诉你是 Vec，只说能一个个取出来</td>
</tr>
<tr>
<td><code>-&gt; MyClosureType</code></td>
<td><code>-&gt; impl Fn(i32) -&gt; i32</code></td>
<td>不告诉你闭包长啥样，只说能执行它</td>
</tr>
</tbody></table>
<h3 id="特征对象"><a href="#特征对象" class="headerlink" title="特征对象"></a>特征对象</h3><p>特征对象（trait object）是“在运行时”决定类型的方式，允许你通过 <code>**Box&lt;dyn Trait&gt;**</code> 之类的方式来处理不同类型的值，只要它们都实现了某个 trait(类似于java中的多态)。  </p>
<p>Rust 默认是<strong>静态分发</strong>（编译时决定类型），这有利于性能，但限制了某些灵活性，比如：  </p>
<p>场景：你想让一个变量，能装下多种不同类型的对象，只要它们都有相同的功能（实现了同一个 trait）</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">speak</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dog</span>;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Animal</span> <span class="keyword">for</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">speak</span>(&amp;<span class="keyword">self</span>) &#123; <span class="built_in">println!</span>(<span class="string">&quot;汪汪！&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Cat</span>;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Animal</span> <span class="keyword">for</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">speak</span>(&amp;<span class="keyword">self</span>) &#123; <span class="built_in">println!</span>(<span class="string">&quot;喵喵！&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">zoo</span> = <span class="built_in">vec!</span>[Dog, Cat]; <span class="comment">// ❌ 编译错误，不同类型不能进同一个 Vec</span></span><br></pre></td></tr></table></figure>

<p> 使用特征对象解决 </p>
<p><code>Box&lt;dyn Animal&gt;</code> 就是一个 <strong>特征对象</strong>。<br>意思是：“我不知道你具体是 Dog 还是 Cat，反正你能 <code>speak()</code> 就行”。  </p>
<h4 id="特征对象的使用条件"><a href="#特征对象的使用条件" class="headerlink" title="特征对象的使用条件"></a>特征对象的使用条件</h4><p>只有 <strong>trait</strong> 满足以下条件才能被做成特征对象：</p>
<h5 id="必须满足"><a href="#必须满足" class="headerlink" title="必须满足"></a>必须满足</h5><ul>
<li>trait 不能有泛型参数</li>
<li>trait 方法不能使用 <code>Self</code> 作为返回值（除非配合 <code>Box&lt;Self&gt;</code>）</li>
<li>trait 要支持 <strong>对象安全（object safe）</strong></li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">speak</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dog</span>;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Animal</span> <span class="keyword">for</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">speak</span>(&amp;<span class="keyword">self</span>) &#123; <span class="built_in">println!</span>(<span class="string">&quot;Dog says: 汪汪！&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Cat</span>;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Animal</span> <span class="keyword">for</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">speak</span>(&amp;<span class="keyword">self</span>) &#123; <span class="built_in">println!</span>(<span class="string">&quot;Cat says: 喵喵！&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">zoo</span>: <span class="type">Vec</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Animal&gt;&gt; = <span class="built_in">vec!</span>[</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Dog),</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Cat),</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">animal</span> <span class="keyword">in</span> zoo &#123;</span><br><span class="line">        animal.<span class="title function_ invoke__">speak</span>(); <span class="comment">// 动态调用</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="dyn"><a href="#dyn" class="headerlink" title="dyn"></a>dyn</h4><p><code>**dyn**</code> 是 Rust 中的关键词，意思是：“我要使用一个<strong>动态分发的 trait 对象</strong>”。</p>
<p><code>dyn Trait</code> 是动态大小类型（DST），不能直接使用，必须用 <code>Box</code>、<code>&amp;</code> 或 <code>Rc</code> 等包起来。</p>
<table>
<thead>
<tr>
<th>包装方式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Box&lt;dyn Trait&gt;</code></td>
<td>放到堆上，适合所有权转移</td>
</tr>
<tr>
<td><code>&amp;dyn Trait</code></td>
<td>借用引用，适合只读调用</td>
</tr>
<tr>
<td><code>Rc&lt;dyn Trait&gt;</code></td>
<td>多所有权，适合多处共享使用</td>
</tr>
<tr>
<td><code>Arc&lt;dyn Trait&gt;</code></td>
<td>多线程共享</td>
</tr>
</tbody></table>
<h5 id="类比理解（📦装箱思想）"><a href="#类比理解（📦装箱思想）" class="headerlink" title="类比理解（📦装箱思想）"></a>类比理解（📦装箱思想）</h5><p>你可以把 <code>dyn Trait</code> 理解成一个“尺寸不定的物品”，Rust 不允许你直接拿在手上，必须：</p>
<ul>
<li>用一个盒子（<code>Box</code>）装起来，放堆上</li>
<li>或者用引用（<code>&amp;</code>）指向它</li>
</ul>
<p>否则编译器无法分配空间，不知道该怎么处理它。</p>
<h4 id="Self-与-self"><a href="#Self-与-self" class="headerlink" title="Self 与 self"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/trait/trait-object.html#self-%E4%B8%8E-self"><font style="color:rgb(0, 0, 0);">Self 与 self</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">Draw</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Clone)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Button</span>;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Draw</span> <span class="keyword">for</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.<span class="title function_ invoke__">clone</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">button</span> = Button;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">newb</span> = button.<span class="title function_ invoke__">draw</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>self</code><font style="color:rgb(0, 0, 0);">指代的就是当前的实例对象，也就是 </font><code>button.draw()</code><font style="color:rgb(0, 0, 0);"> 中的 </font><code>button</code><font style="color:rgb(0, 0, 0);"> 实例，</font><code>Self</code><font style="color:rgb(0, 0, 0);"> 则指代的是 </font><code>Button</code><font style="color:rgb(0, 0, 0);"> 类型</font></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/07/01/%E7%89%B9%E5%BE%81/" data-id="cmcn4u1ba000qlrqwbn731ay8" data-title="特征" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-泛型" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/30/%E6%B3%9B%E5%9E%8B/" class="article-date">
  <time class="dt-published" datetime="2025-06-30T09:17:07.000Z" itemprop="datePublished">2025-06-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/30/%E6%B3%9B%E5%9E%8B/">泛型</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="什么是泛型"><a href="#什么是泛型" class="headerlink" title="什么是泛型"></a>什么是泛型</h3><p>泛型就是一种“<strong>可变类型的占位符</strong>”，可以让函数、结构体、枚举、方法等在不指定具体类型的情况下工作。</p>
<h3 id="为什么要用泛型"><a href="#为什么要用泛型" class="headerlink" title="为什么要用泛型"></a>为什么要用泛型</h3><ul>
<li>减少重复代码（比如：<code>fn print_i32</code>、<code>fn print_f64</code>…）</li>
<li>增强代码复用</li>
<li>提高灵活性和扩展性</li>
</ul>
<h3 id="泛型种类"><a href="#泛型种类" class="headerlink" title="泛型种类"></a>泛型种类</h3><h4 id="泛型函数"><a href="#泛型函数" class="headerlink" title="泛型函数"></a>泛型函数</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">largest</span>&lt;T: <span class="built_in">PartialOrd</span> + <span class="built_in">Copy</span>&gt;(list: &amp;[T]) <span class="punctuation">-&gt;</span> T &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">largest</span> = list[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> &amp;item <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>PartialOrd</code><font style="color:rgb(64, 64, 64);"> trait</font><font style="color:rgb(64, 64, 64);">:</font><ul>
<li><font style="color:rgb(64, 64, 64);">这是 Rust 中的一个特质(trait)，用于定义部分排序关系</font></li>
<li><font style="color:rgb(64, 64, 64);">实现了</font><font style="color:rgb(64, 64, 64);"> </font><code>PartialOrd</code><font style="color:rgb(64, 64, 64);"> </font><font style="color:rgb(64, 64, 64);">的类型可以使用</font><font style="color:rgb(64, 64, 64);"> </font><code>&lt;</code><font style="color:rgb(64, 64, 64);">,</font><font style="color:rgb(64, 64, 64);"> </font><code>&gt;</code><font style="color:rgb(64, 64, 64);">,</font><font style="color:rgb(64, 64, 64);"> </font><code>&lt;=</code><font style="color:rgb(64, 64, 64);">,</font><font style="color:rgb(64, 64, 64);"> </font><code>&gt;=</code><font style="color:rgb(64, 64, 64);"> </font><font style="color:rgb(64, 64, 64);">等比较运算符</font></li>
<li><font style="color:rgb(64, 64, 64);">与</font><font style="color:rgb(64, 64, 64);"> </font><code>Ord</code><font style="color:rgb(64, 64, 64);"> </font><font style="color:rgb(64, 64, 64);">不同，</font><code>PartialOrd</code><font style="color:rgb(64, 64, 64);"> </font><font style="color:rgb(64, 64, 64);">允许存在不可比较的值（比如浮点数中的 NaN）</font></li>
<li><font style="color:rgb(64, 64, 64);">在函数签名中</font><font style="color:rgb(64, 64, 64);"> </font><code>T: PartialOrd</code><font style="color:rgb(64, 64, 64);"> </font><font style="color:rgb(64, 64, 64);">表示泛型类型 T 必须实现这个 trait</font></li>
</ul>
</li>
<li><code>T:</code><strong><font style="color:rgb(64, 64, 64);"> 语法</font></strong><font style="color:rgb(64, 64, 64);">:</font><ul>
<li><font style="color:rgb(64, 64, 64);">这是 Rust 的 trait bound 语法</font></li>
<li><code>T: PartialOrd + Copy</code><font style="color:rgb(64, 64, 64);"> </font><font style="color:rgb(64, 64, 64);">表示泛型类型 T 必须同时实现</font><font style="color:rgb(64, 64, 64);"> </font><code>PartialOrd</code><font style="color:rgb(64, 64, 64);"> </font><font style="color:rgb(64, 64, 64);">和</font><font style="color:rgb(64, 64, 64);"> </font><code>Copy</code><font style="color:rgb(64, 64, 64);"> </font><font style="color:rgb(64, 64, 64);">这两个 trait</font></li>
<li><code>Copy</code><font style="color:rgb(64, 64, 64);"> trait 表示类型可以通过位复制来拷贝（而不是移动所有权）</font></li>
</ul>
</li>
</ol>
<h4 id="泛型结构体"><a href="#泛型结构体" class="headerlink" title=" 泛型结构体 "></a><font style="color:rgb(64, 64, 64);"> 泛型结构体 </font></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用法</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">p1</span> = Point &#123; x: <span class="number">5</span>, y: <span class="number">10</span> &#125;;      <span class="comment">// T = i32</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">p2</span> = Point &#123; x: <span class="number">1.0</span>, y: <span class="number">4.0</span> &#125;;   <span class="comment">// T = f64</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="多泛型"><a href="#多泛型" class="headerlink" title="多泛型"></a>多泛型</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;T, U&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: U,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">p</span> = Point &#123; x: <span class="number">5</span>, y: <span class="number">3.2</span> &#125;; <span class="comment">// T = i32, U = f64</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="泛型方法"><a href="#泛型方法" class="headerlink" title="泛型方法"></a>泛型方法</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T&gt; Point&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">x</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;T &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.x</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 你也可以为某些具体类型单独实现方法：</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Point</span>&lt;<span class="type">f64</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">distance_from_origin</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        (<span class="keyword">self</span>.x.<span class="title function_ invoke__">powi</span>(<span class="number">2</span>) + <span class="keyword">self</span>.y.<span class="title function_ invoke__">powi</span>(<span class="number">2</span>)).<span class="title function_ invoke__">sqrt</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>部分</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>impl&lt;T&gt;</code></td>
<td>💡 声明：我们**为某个类型参数 **<code>T</code> 实现方法</td>
</tr>
<tr>
<td><code>Point&lt;T&gt;</code></td>
<td>💡 表示我们是<strong>为 <strong><code>Point&lt;T&gt;</code></strong> 类型的实例</strong>实现这些方法</td>
</tr>
</tbody></table>
<h4 id="泛型枚举"><a href="#泛型枚举" class="headerlink" title="泛型枚举"></a>泛型枚举</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Option</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(T),</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T, E&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(T),</span><br><span class="line">    <span class="title function_ invoke__">Err</span>(E),</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Trait-Bound（约束泛型）"><a href="#Trait-Bound（约束泛型）" class="headerlink" title="Trait Bound（约束泛型）"></a>Trait Bound（约束泛型）</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">print</span>&lt;T: std::fmt::Display&gt;(item: T) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, item);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 你也可以使用 where 来让代码更清晰：</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print</span>&lt;T, U&gt;(t: T, u: U)</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    T: std::fmt::Display,</span><br><span class="line">    U: std::fmt::<span class="built_in">Debug</span>,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; &#123;:?&#125;&quot;</span>, t, u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="结构体方法"><a href="#结构体方法" class="headerlink" title="结构体方法"></a>结构体方法</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p1</span> = Point &#123; x: <span class="number">1</span>, y: <span class="number">2</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p2</span> = Point &#123; x: <span class="number">1.1</span>, y: <span class="number">2.2</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p3</span> = p1.<span class="title function_ invoke__">mixup</span>(p2);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;-&#123;&#125;&quot;</span>, p3.x, p3.y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;T, U&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: U,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T, U&gt; Point&lt;T, U&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">mixup</span>&lt;T1, U1&gt;(<span class="keyword">self</span>, other: Point&lt;T1, U1&gt;) <span class="punctuation">-&gt;</span> Point&lt;T, U1&gt; &#123;</span><br><span class="line">        Point &#123;</span><br><span class="line">            x: <span class="keyword">self</span>.x,</span><br><span class="line">            y: other.y,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="显式地指定泛型的类型参数"><a href="#显式地指定泛型的类型参数" class="headerlink" title="显式地指定泛型的类型参数"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/trait/generic.html#%E6%98%BE%E5%BC%8F%E5%9C%B0%E6%8C%87%E5%AE%9A%E6%B3%9B%E5%9E%8B%E7%9A%84%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0"><font style="color:rgb(0, 0, 0);">显式地指定泛型的类型参数</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt::Display;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">create_and_print</span>&lt;T&gt;() <span class="keyword">where</span> T: <span class="built_in">From</span>&lt;<span class="type">i32</span>&gt; + Display &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span>: T = <span class="number">100</span>.<span class="title function_ invoke__">into</span>(); <span class="comment">// 创建了类型为 T 的变量 a，它的初始值由 100 转换而来</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;a is: &#123;&#125;&quot;</span>, a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">create_and_print</span>(); <span class="comment">// 会报错:consider specifying the generic argument</span></span><br><span class="line">                       <span class="comment">//需要指定泛型:create_and_print::&lt;T&gt;();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="const-泛型"><a href="#const-泛型" class="headerlink" title="const 泛型"></a>const 泛型</h4><p><strong>把常量值也当作“泛型参数”来传进去</strong>，就像你传类型参数 <code>&lt;T&gt;</code> 一样，你可以传常量参数 <code>&lt;const N: usize&gt;</code>。</p>
<h5 id="常见用途场景：定长数组"><a href="#常见用途场景：定长数组" class="headerlink" title="常见用途场景：定长数组"></a>常见用途场景：定长数组</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">FixedArray</span>&lt;T, <span class="keyword">const</span> N: <span class="type">usize</span>&gt; &#123;</span><br><span class="line">    data: [T; N],</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 可以用它定义不同长度的数组容器：</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = FixedArray::&lt;<span class="type">i32</span>, <span class="number">4</span>&gt; &#123; data: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>] &#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span> = FixedArray::&lt;<span class="type">u8</span>, <span class="number">2</span>&gt;  &#123; data: [<span class="number">10</span>, <span class="number">20</span>] &#125;;</span><br></pre></td></tr></table></figure>

<p><strong>N 是一个编译时常量</strong>，可以是数组长度、维度、固定编号等。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;const N: usize&gt;</code></td>
<td>N 是一个常量参数</td>
</tr>
<tr>
<td><code>[T; N]</code></td>
<td>使用 const 泛型做数组长度</td>
</tr>
<tr>
<td>可用于 struct、enum、function</td>
<td>都可以带 const 泛型参数</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/30/%E6%B3%9B%E5%9E%8B/" data-id="cmcn4u1b9000mlrqw57m796hx" data-title="泛型" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-方法" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/29/%E6%96%B9%E6%B3%95/" class="article-date">
  <time class="dt-published" datetime="2025-06-29T08:11:03.000Z" itemprop="datePublished">2025-06-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/29/%E6%96%B9%E6%B3%95/">方法</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <table>
<thead>
<tr>
<th>类型</th>
<th>定义方式</th>
<th>是否需要实例（self）</th>
<th>调用方式</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>普通函数</td>
<td><code>fn xxx(...)</code></td>
<td>❌ 不用 <code>self</code></td>
<td><code>xxx(...)</code></td>
<td>全局或模块函数</td>
</tr>
<tr>
<td>方法（方法函数）</td>
<td><code>fn xxx(&amp;self)</code></td>
<td>✅ 需要实例（self）</td>
<td><code>实例.xxx()</code></td>
<td>操作某个实例的行为（面向对象）</td>
</tr>
<tr>
<td>关联函数</td>
<td><code>fn xxx(...)</code>（但在 impl 块中）</td>
<td>❌ 不需要 <code>self</code></td>
<td><code>类型名::xxx(...)</code></td>
<td>属于类型，但不需要对象</td>
</tr>
</tbody></table>
<h3 id="普通函数（function）"><a href="#普通函数（function）" class="headerlink" title="普通函数（function）"></a>普通函数（function）</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">printPet</span>(name: Pets) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Pet is &#123;:?&#125;&quot;</span>, name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>是全局函数</li>
<li>跟类型 <code>Pets</code> 没关系</li>
<li>调用时直接用 <code>printPet(...)</code></li>
</ul>
<h3 id="方法（method）"><a href="#方法（method）" class="headerlink" title="方法（method）"></a>方法（method）</h3><p>定义在 <code>impl</code> 块中，并且有 <code>&amp;self</code>：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">say_hi</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Hi, 我是 &#123;&#125;&quot;</span>, <span class="keyword">self</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = Person &#123;</span><br><span class="line">        name: <span class="string">&quot;小明&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    p.<span class="title function_ invoke__">say_hi</span>(); <span class="comment">// ⬅️ 调用方法时，自动把 p 作为 &amp;self 传进去</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>&amp;self</code> 表示这个方法作用在某个具体的实例上</li>
</ul>
<p>这行</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.<span class="title function_ invoke__">say_hi</span>();</span><br></pre></td></tr></table></figure>

<p>等价于下面这行 <strong>真实的传参方式</strong>：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person::<span class="title function_ invoke__">say_hi</span>(&amp;p);</span><br></pre></td></tr></table></figure>

<p>&amp;self 其实就是 &amp;p</p>
<h3 id="关联函数（associated-function）"><a href="#关联函数（associated-function）" class="headerlink" title="关联函数（associated function）"></a>关联函数（associated function）</h3><p> 定义在 <code>impl</code> 块中，但没有 <code>self</code> 参数：  </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    radius: <span class="type">f64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    <span class="comment">// 关联函数（构造器）</span></span><br><span class="line">    <span class="comment">// new是Circle的关联函数，因为它的第一个参数不是self，且new并不是关键字</span></span><br><span class="line">    <span class="comment">// 这种方法往往用于初始化当前结构体的实例</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(radius: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; radius &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方法（需要实例）</span></span><br><span class="line">    <span class="comment">// Circle的方法，&amp;self表示借用当前的Circle结构体</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">area</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="number">3.14</span> * <span class="keyword">self</span>.radius * <span class="keyword">self</span>.radius</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = Circle::<span class="title function_ invoke__">new</span>(<span class="number">2.0</span>);   <span class="comment">// 调用关联函数</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;面积是 &#123;&#125;&quot;</span>, c.<span class="title function_ invoke__">area</span>()); <span class="comment">// 调用方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>没有 <code>self</code>，代表这个函数<strong>和实例没关系</strong></li>
<li>调用方式是通过类型名：<code>Pets::print(&amp;dog)</code></li>
</ul>
<p>可以把它想象成 Java&#x2F;C++&#x2F;Python 中的 “静态方法”。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ol>
<li>普通函数不进 impl，哪里都能调；</li>
<li>方法必须有 self，用对象来调；</li>
<li>关联函数无 self，用类型来找。</li>
<li><code>impl 块</code> 中的名称，必须是你要给它实现方法的类型名。如果你想给 <code>Person</code> 类型添加方法，那 <code>impl</code> 后面就必须写 <code>Person</code>。</li>
</ol>
<h3 id="self、-self-和-mut-self"><a href="#self、-self-和-mut-self" class="headerlink" title="self、&amp;self 和 &amp;mut self"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/method.html#selfself-%E5%92%8C-mut-self"><font style="color:rgb(0, 0, 0);">self、&amp;self 和 &amp;mut self</font></a></h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    width: <span class="type">u32</span>,</span><br><span class="line">    height: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">area</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.width * <span class="keyword">self</span>.height</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rect1</span> = Rectangle &#123; width: <span class="number">30</span>, height: <span class="number">50</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(</span><br><span class="line">        <span class="string">&quot;The area of the rectangle is &#123;&#125; square pixels.&quot;</span>,</span><br><span class="line">        rect1.<span class="title function_ invoke__">area</span>()</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>self</code><font style="color:rgb(0, 0, 0);"> 表示 </font><code>Rectangle</code><font style="color:rgb(0, 0, 0);"> 的所有权转移到该方法中，这种形式用的较少</font></li>
<li><code>&lt;&amp;self</code><font style="color:rgb(0, 0, 0);"> </font><font style="color:rgb(0, 0, 0);">表示该方法对</font><font style="color:rgb(0, 0, 0);"> </font><code>Rectangle</code><font style="color:rgb(0, 0, 0);"> </font><font style="color:rgb(0, 0, 0);">的不可变借用</font></li>
<li><code>&amp;mut self</code><font style="color:rgb(0, 0, 0);"> 表示可变借用</font></li>
<li><code>Self</code><font style="color:rgb(0, 0, 0);"> 指代被实现方法的结构体类型</font></li>
</ul>
<h3 id="方法名跟结构体字段名相同"><a href="#方法名跟结构体字段名相同" class="headerlink" title="方法名跟结构体字段名相同"></a>方法名跟结构体字段名相同</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">width</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.width &gt; <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(width:<span class="type">u32</span>,height:<span class="type">u32</span>)<span class="punctuation">-&gt;</span><span class="keyword">Self</span>&#123;</span><br><span class="line">        Rectangle&#123;width,height&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rect1</span> = Rectangle &#123;</span><br><span class="line">        width: <span class="number">30</span>,</span><br><span class="line">        height: <span class="number">50</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> rect1.<span class="title function_ invoke__">width</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;The rectangle has a nonzero width; it is &#123;&#125;&quot;</span>, rect1.width);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0, 0, 0);">使用 </font><code>rect1.width()</code><font style="color:rgb(0, 0, 0);"> 时，Rust 知道我们调用的是它的方法，如果使用 </font><code>rect1.width</code><font style="color:rgb(0, 0, 0);">，则是访问它的字段</font></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/29/%E6%96%B9%E6%B3%95/" data-id="cmcn4u1b7000glrqw0q8varw6" data-title="方法" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-模式匹配" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/28/%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D/" class="article-date">
  <time class="dt-published" datetime="2025-06-28T08:13:24.000Z" itemprop="datePublished">2025-06-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/28/%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D/">模式匹配</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="match"><a href="#match" class="headerlink" title="match"></a>match</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">direction</span> = Direction::Down;</span><br><span class="line">    <span class="keyword">match</span>  direction &#123;</span><br><span class="line">        Direction::Up =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Up&quot;</span>),</span><br><span class="line">        _=&gt;<span class="built_in">println!</span>(<span class="string">&quot;other&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Direction</span> &#123;</span><br><span class="line">    Up,</span><br><span class="line">    Down,</span><br><span class="line">    Left,</span><br><span class="line">    Right,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>match</code><font style="color:rgb(0, 0, 0);"> 的匹配必须要穷举出所有可能，因此这里用 </font><code>_</code><font style="color:rgb(0, 0, 0);"> 来代表未列出的所有可能性</font></li>
<li><code>match</code><font style="color:rgb(0, 0, 0);"> </font><font style="color:rgb(0, 0, 0);">的每一个分支都必须是一个表达式，且所有分支的表达式最终返回值的类型必须相同</font></li>
<li><strong><font style="color:rgb(0, 0, 0);">X | Y</font></strong><font style="color:rgb(0, 0, 0);">，类似逻辑运算符 </font><code>或</code><font style="color:rgb(0, 0, 0);">，代表该分支可以匹配 </font><code>X</code><font style="color:rgb(0, 0, 0);"> 也可以匹配 </font><code>Y</code><font style="color:rgb(0, 0, 0);">，只要满足一个即可</font></li>
</ul>
<h4 id="match匹配"><a href="#match匹配" class="headerlink" title="match匹配"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/match-if-let.html#match-%E5%8C%B9%E9%85%8D"><font style="color:rgb(0, 0, 0);">match匹配</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">match</span> target &#123;</span><br><span class="line">    模式<span class="number">1</span> =&gt; 表达式<span class="number">1</span>,</span><br><span class="line">    模式<span class="number">2</span> =&gt; &#123;</span><br><span class="line">        语句<span class="number">1</span>;</span><br><span class="line">        语句<span class="number">2</span>;</span><br><span class="line">        表达式<span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    _ =&gt; 表达式<span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>模式2举例</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">num</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="keyword">match</span> num &#123;</span><br><span class="line">        <span class="number">1</span> =&gt; <span class="string">&quot;one&quot;</span>,</span><br><span class="line">        <span class="number">2</span> =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;匹配到数字 2&quot;</span>);</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">msg</span> = <span class="string">&quot;two&quot;</span>;</span><br><span class="line">            msg  <span class="comment">// 返回值是 &quot;two&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        _ =&gt; <span class="string">&quot;other&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;result = &#123;&#125;&quot;</span>, result); <span class="comment">// 输出：result = two</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用match表达式赋值"><a href="#使用match表达式赋值" class="headerlink" title="使用match表达式赋值"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/match-if-let.html#%E4%BD%BF%E7%94%A8-match-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%B5%8B%E5%80%BC"><font style="color:rgb(0, 0, 0);">使用match表达式赋值</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">IpAddr</span> &#123;</span><br><span class="line">   Ipv4,</span><br><span class="line">   Ipv6</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ip1</span> = IpAddr::Ipv6;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ip_str</span> = <span class="keyword">match</span> ip1 &#123;</span><br><span class="line">        IpAddr::Ipv4 =&gt; <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">        _ =&gt; <span class="string">&quot;::1&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, ip_str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0, 0, 0);">匹配到 </font><code>_</code><font style="color:rgb(0, 0, 0);"> 分支，所以将 </font><code>&quot;::1&quot;</code><font style="color:rgb(0, 0, 0);"> 赋值给了 </font><code>ip_str</code></p>
<h4 id="模式绑定"><a href="#模式绑定" class="headerlink" title="模式绑定"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/match-if-let.html#%E6%A8%A1%E5%BC%8F%E7%BB%91%E5%AE%9A"><font style="color:rgb(0, 0, 0);">模式绑定</font></a></h4><p><font style="color:rgb(0, 0, 0);">模式匹配的另外一个重要功能是从模式中取出绑定的值</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">coin</span> =  Coin::<span class="title function_ invoke__">Quarter</span>(UsState::Alabama);</span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,<span class="title function_ invoke__">value</span>(coin))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">value</span>(coin:Coin)<span class="punctuation">-&gt;</span><span class="type">u8</span>&#123;</span><br><span class="line">    <span class="keyword">match</span> coin &#123;</span><br><span class="line">        Coin::<span class="title function_ invoke__">Quarter</span>(state)=&gt;&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,state);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        _=&gt;&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">UsState</span> &#123;</span><br><span class="line">    Alabama,</span><br><span class="line">    Alaska,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Coin</span> &#123;</span><br><span class="line">    Penny,</span><br><span class="line">    Nickel,</span><br><span class="line">    Dime,</span><br><span class="line">    <span class="title function_ invoke__">Quarter</span>(UsState),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="通配符"><a href="#通配符" class="headerlink" title="_通配符"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/match-if-let.html#_-%E9%80%9A%E9%85%8D%E7%AC%A6"><font style="color:rgb(0, 0, 0);">_通配符</font></a></h4><p>在 Rust 中，<code>_</code> 被称为<strong>通配符模式</strong>，它的作用是：</p>
<p>✅ <strong>匹配任意值，但</strong><br>❌ <strong>不会绑定变量，也不会使用这个值。</strong></p>
<table>
<thead>
<tr>
<th><strong>用法场景</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>match</code> 的默认分支</td>
<td><strong>匹配所有剩下的情况</strong></td>
</tr>
<tr>
<td><strong>解构时忽略某些字段</strong></td>
<td><strong>只取你关心的值，忽略其他</strong></td>
</tr>
<tr>
<td><strong>抑制 unused 变量警告</strong></td>
<td><strong>你声明了变量但暂时不用</strong></td>
</tr>
</tbody></table>
<h4 id="模式守卫"><a href="#模式守卫" class="headerlink" title="模式守卫"></a>模式守卫</h4><p><strong>模式守卫</strong>是写在 <code>match</code> 分支后面的额外条件，用 <code>if</code> 引入，起到“过滤器”的作用。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> x &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(i) <span class="keyword">if</span> i &gt; <span class="number">3</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Big number: &#123;&#125;&quot;</span>, i),</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(i) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Small number: &#123;&#125;&quot;</span>, i),</span><br><span class="line">    <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Got nothing&quot;</span>),</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>

<ul>
<li><code>if i &gt; 3</code> 就是一个 <strong>模式守卫</strong></li>
<li>它只有在模式 <code>Some(i)</code> 匹配成功后，<strong>再判断 <strong><code>**i &gt; 3**</code></strong> 是否为 true</strong></li>
</ul>
<h4 id="模式守卫迭代器"><a href="#模式守卫迭代器" class="headerlink" title="模式守卫迭代器"></a>模式守卫迭代器</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="built_in">vec!</span>[<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line">    <span class="keyword">for</span> (a, b) <span class="keyword">in</span> a.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">zip</span>(b.<span class="title function_ invoke__">iter</span>()) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; &#123;&#125;-&gt;&#123;&#125;&quot;</span>, a, b, a + b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">打印结果</span><br><span class="line"><span class="number">1</span> <span class="number">4</span><span class="punctuation">-&gt;</span><span class="number">5</span></span><br><span class="line"><span class="number">2</span> <span class="number">5</span><span class="punctuation">-&gt;</span><span class="number">7</span></span><br><span class="line"><span class="number">3</span> <span class="number">6</span><span class="punctuation">-&gt;</span><span class="number">9</span></span><br></pre></td></tr></table></figure>

<h3 id="if-let匹配"><a href="#if-let匹配" class="headerlink" title="if let匹配"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/match-if-let.html#if-let-%E5%8C%B9%E9%85%8D"><font style="color:rgb(0, 0, 0);">if let匹配</font></a></h3><p><font style="color:rgb(0, 0, 0);">有时会遇到只有一个模式的值需要被处理，其它值直接忽略的场景，如果用 </font><code>match</code><font style="color:rgb(0, 0, 0);"> 来处理就要写成下面这样：</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span> = <span class="title function_ invoke__">Some</span>(<span class="number">3u8</span>);</span><br><span class="line"><span class="keyword">match</span> v &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(<span class="number">3</span>) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;three&quot;</span>),</span><br><span class="line">    _ =&gt; (),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以使用if let匹配</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="number">3</span>) = v &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;three&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><font style="color:rgb(0, 0, 0);">当你只要匹配一个条件，且忽略其他条件时就用 </font></strong><code>if let</code><strong><font style="color:rgb(0, 0, 0);"> ，否则都用 </font></strong><code>match</code><font style="color:rgb(0, 0, 0);">。</font></p>
<h3 id="matches-宏"><a href="#matches-宏" class="headerlink" title="matches!宏"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/match-if-let.html#matches%E5%AE%8F"><font style="color:rgb(0, 0, 0);">matches!宏</font></a></h3><p><font style="color:rgb(0, 0, 0);">它可以将一个表达式跟模式进行匹配，然后返回匹配的结果 </font><code>true</code><font style="color:rgb(0, 0, 0);"> or </font><code>false</code><font style="color:rgb(0, 0, 0);">。</font></p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a><font style="color:rgb(0, 0, 0);">语法</font></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">matches!(值, 模式)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>match</code>: 多种分支逻辑处理</li>
<li><code>matches!</code>: 判断是否符合某种模式，结果是布尔值</li>
</ul>
<h4 id="匹配某个枚举变体"><a href="#匹配某个枚举变体" class="headerlink" title="匹配某个枚举变体"></a>匹配某个枚举变体</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">MyEnum</span> &#123;</span><br><span class="line">    A,</span><br><span class="line">    B,</span><br><span class="line">    <span class="title function_ invoke__">C</span>(<span class="type">i32</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">val</span> = MyEnum::<span class="title function_ invoke__">C</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> matches!(val, MyEnum::<span class="title function_ invoke__">C</span>(_)) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;是 C 变体！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="结合-if-使用"><a href="#结合-if-使用" class="headerlink" title="结合 if 使用"></a>结合 <code>if</code> 使用</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> matches!(x, <span class="title function_ invoke__">Some</span>(_)) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;有值！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="用作布尔表达式"><a href="#用作布尔表达式" class="headerlink" title="用作布尔表达式"></a>用作布尔表达式</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="title function_ invoke__">Some</span>(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">is_none</span> = matches!(x, <span class="literal">None</span>);  <span class="comment">// false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="带条件匹配（守卫）"><a href="#带条件匹配（守卫）" class="headerlink" title="带条件匹配（守卫）"></a>带条件匹配（守卫）</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="title function_ invoke__">Some</span>(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> matches!(x, <span class="title function_ invoke__">Some</span>(v) <span class="keyword">if</span> v &gt; <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;匹配到大于 3 的 Some&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><table>
<thead>
<tr>
<th>特性</th>
<th><code>match</code> 语句</th>
<th><code>matches!</code> 宏</th>
</tr>
</thead>
<tbody><tr>
<td>返回类型</td>
<td>任意类型（表达式）</td>
<td><code>bool</code>（true &#x2F; false）</td>
</tr>
<tr>
<td>用于</td>
<td>执行不同逻辑</td>
<td>判断某个值是否匹配某个模式</td>
</tr>
<tr>
<td>可否写逻辑块</td>
<td>✅ 可以写 <code>&#123;&#125;</code> 多行</td>
<td>❌ 不能，只能判断</td>
</tr>
<tr>
<td>是否简洁</td>
<td>❌ 相对繁琐</td>
<td>✅ 非常简洁</td>
</tr>
</tbody></table>
<h3 id="变量遮蔽"><a href="#变量遮蔽" class="headerlink" title="变量遮蔽"></a>变量遮蔽</h3><h4 id="if-let-Some-age-age-中，为什么还能打印出-age-30？"><a href="#if-let-Some-age-age-中，为什么还能打印出-age-30？" class="headerlink" title="if let Some(age) = age 中，为什么还能打印出 age = 30？"></a><code>if let Some(age) = age</code> 中，为什么还能打印出 <code>age = 30</code>？</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">age</span> = <span class="title function_ invoke__">Some</span>(<span class="number">30</span>);</span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;在匹配前，age是&#123;:?&#125;&quot;</span>, age);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(age) = age &#123;</span><br><span class="line">       <span class="built_in">println!</span>(<span class="string">&quot;匹配出来的age是&#123;&#125;&quot;</span>, age);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;在匹配后，age是&#123;:?&#125;&quot;</span>, age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这一句其实做了 <strong>两件事</strong>：</p>
<ol>
<li><strong>匹配</strong>外层的 <code>age</code>（它是 <code>Option&lt;i32&gt;</code>，值为 <code>Some(30)</code>）</li>
<li>**创建一个新的局部变量 **<code>**age**</code>，它的类型是 <code>i32</code>，值是 30</li>
</ol>
<p>这就叫做 <strong>变量遮蔽（shadowing）</strong>：</p>
<ul>
<li><code>if let</code> 里的 <code>age</code><strong>是新的变量</strong></li>
<li>它 **暂时遮蔽了外层的 **<code>**age**</code></li>
<li>匹配代码块外还是原来的 <code>Option&lt;i32&gt;</code> 类型</li>
</ul>
<h3 id="绑定符"><a href="#绑定符" class="headerlink" title="@绑定符"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/all-patterns.html#%E7%BB%91%E5%AE%9A"><font style="color:rgb(0, 0, 0);">@绑定</font></a>符</h3><p> Rust 里的 <code>@</code> 是“<strong>一边匹配，一边命名</strong>”的工具。  </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">age</span> = <span class="title function_ invoke__">Some</span>(<span class="number">18</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(x @ <span class="number">13</span>..=<span class="number">19</span>) = age &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;青少年：&#123;&#125;&quot;</span>, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>写法</th>
<th>意思</th>
</tr>
</thead>
<tbody><tr>
<td><code>x @ 条件</code></td>
<td>如果满足“条件”，就起名叫 <code>x</code></td>
</tr>
<tr>
<td><code>Some(x @ ..)</code></td>
<td>匹配 <code>Some</code>，解出值叫 <code>x</code></td>
</tr>
</tbody></table>
<h4 id="前绑定后解构"><a href="#前绑定后解构" class="headerlink" title="@前绑定后解构"></a>@前绑定后解构</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// 绑定新变量 `p`，同时对 `Point` 进行解构</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> @ Point &#123;x: px, y: py &#125; = Point &#123;x: <span class="number">10</span>, y: <span class="number">23</span>&#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;x: &#123;&#125;, y: &#123;&#125;&quot;</span>, px, py);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, p);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">point</span> = Point &#123;x: <span class="number">10</span>, y: <span class="number">5</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">p</span> @ Point &#123;x: <span class="number">10</span>, y&#125; = point &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;x is 10 and y is &#123;&#125; in &#123;:?&#125;&quot;</span>, y, p);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;x was not 10 :(&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="序列化-反序列化"><a href="#序列化-反序列化" class="headerlink" title="序列化-&gt;反序列化"></a>序列化-&gt;反序列化</h3><p>引入依赖</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">serde</span> = &#123; version = <span class="string">&quot;1.0&quot;</span>, features = [<span class="string">&quot;derive&quot;</span>] &#125;</span><br><span class="line"><span class="attr">serde_json</span> = <span class="string">&quot;1.0&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>serde</code> 是 <strong>序列化框架的核心</strong>（负责 trait 定义、推导机制）</li>
<li><code>serde_json</code> 是 <strong>支持 JSON 格式的具体实现</strong></li>
</ul>
<h4 id="serde"><a href="#serde" class="headerlink" title="serde"></a><code>serde</code></h4><p>提供了 <code>Serialize</code>、<code>Deserialize</code> 这两个核心 trait，还有宏 <code>#[derive(Serialize, Deserialize)]</code></p>
<h4 id="serde-json"><a href="#serde-json" class="headerlink" title="serde_json"></a>serde_json</h4><p>提供了具体的 JSON 格式处理器，包括：</p>
<ul>
<li><code>to_string()</code></li>
<li><code>from_str()</code></li>
<li><code>Value</code> 类型（类似 JS 的动态 JSON 类型）</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> serde::&#123;Deserialize, Serialize&#125;;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">info</span> = Information &#123;</span><br><span class="line">        name: <span class="string">&quot;John&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        age: <span class="number">20</span>,</span><br><span class="line">        email: <span class="string">&quot;john@example.com&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        address: Address &#123;</span><br><span class="line">            strees: <span class="string">&quot;123 Main St&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            city: <span class="string">&quot;New York&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        &#125;,</span><br><span class="line">        phone_number: <span class="built_in">vec!</span>[<span class="string">&quot;123-456-7890&quot;</span>.<span class="title function_ invoke__">to_string</span>(), <span class="string">&quot;098-765-4321&quot;</span>.<span class="title function_ invoke__">to_string</span>()],</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">str_info</span> = serde_json::<span class="title function_ invoke__">to_string_pretty</span>(&amp;info).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, str_info);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">infomation</span>: Information = serde_json::<span class="title function_ invoke__">from_str</span>(&amp;str_info).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, infomation);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#[derive(Serialize, Deserialize, Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Information</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    age: <span class="type">i32</span>,</span><br><span class="line">    email: <span class="type">String</span>,</span><br><span class="line">    address: Address,</span><br><span class="line">    phone_number: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#[derive(Serialize, Deserialize, Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">    strees: <span class="type">String</span>,</span><br><span class="line">    city: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/28/%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D/" data-id="cmcn4u1b8000klrqw87pkeybk" data-title="模式匹配" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-结构体" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/27/%E7%BB%93%E6%9E%84%E4%BD%93/" class="article-date">
  <time class="dt-published" datetime="2025-06-27T01:12:57.000Z" itemprop="datePublished">2025-06-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/27/%E7%BB%93%E6%9E%84%E4%BD%93/">结构体</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="结构体语法"><a href="#结构体语法" class="headerlink" title="结构体语法"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E7%BB%93%E6%9E%84%E4%BD%93%E8%AF%AD%E6%B3%95"><font style="color:rgb(0, 0, 0);">结构体语法</font></a></h3><h4 id="定义结构体"><a href="#定义结构体" class="headerlink" title="定义结构体"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%84%E4%BD%93"><font style="color:rgb(0, 0, 0);">定义结构体</font></a></h4><p><font style="color:rgb(0, 0, 0);">一个结构体由几部分组成：</font></p>
<ul>
<li><font style="color:rgb(0, 0, 0);">通过关键字</font><font style="color:rgb(0, 0, 0);"> </font><code>&gt;struct</code><font style="color:rgb(0, 0, 0);"> </font><font style="color:rgb(0, 0, 0);">定义</font></li>
<li><font style="color:rgb(0, 0, 0);">一个清晰明确的结构体</font><font style="color:rgb(0, 0, 0);"> </font><code>名称</code></li>
<li><font style="color:rgb(0, 0, 0);">几个有名字的结构体 </font><code>字段</code></li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    active: <span class="type">bool</span>,</span><br><span class="line">    username: <span class="type">String</span>,</span><br><span class="line">    email: <span class="type">String</span>,</span><br><span class="line">    sign_in_count: <span class="type">u64</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建结构体实例"><a href="#创建结构体实例" class="headerlink" title="创建结构体实例"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E5%88%9B%E5%BB%BA%E7%BB%93%E6%9E%84%E4%BD%93%E5%AE%9E%E4%BE%8B"><font style="color:rgb(0, 0, 0);">创建结构体实例</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">user1</span> = User &#123;</span><br><span class="line">    email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someone@example.com&quot;</span>),</span><br><span class="line">    username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someusername123&quot;</span>),</span><br><span class="line">    active: <span class="literal">true</span>,</span><br><span class="line">    sign_in_count: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><font style="color:rgb(0, 0, 0);">初始化实例时，</font><strong><font style="color:rgb(0, 0, 0);">每个字段</font></strong><font style="color:rgb(0, 0, 0);">都需要进行初始化</font></li>
<li><font style="color:rgb(0, 0, 0);">初始化时的字段顺序</font><strong><font style="color:rgb(0, 0, 0);">不需要</font></strong><font style="color:rgb(0, 0, 0);">和结构体定义时的顺序一致</font></li>
</ol>
<h4 id="访问结构体字段"><a href="#访问结构体字段" class="headerlink" title="访问结构体字段"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E8%AE%BF%E9%97%AE%E7%BB%93%E6%9E%84%E4%BD%93%E5%AD%97%E6%AE%B5"><font style="color:rgb(0, 0, 0);">访问结构体字段</font></a></h4><p><font style="color:rgb(0, 0, 0);">通过 </font><code>.</code><font style="color:rgb(0, 0, 0);"> 操作符即可访问结构体实例内部的字段值，也可以修改它们：</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可变的才能进行修改</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">user</span> = User &#123;</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someusername123&quot;</span>),</span><br><span class="line">        email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someone@example.com&quot;</span>),</span><br><span class="line">        sign_in_count: <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    user.active = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, user.active)</span><br></pre></td></tr></table></figure>

<h4 id="结构体更新语法"><a href="#结构体更新语法" class="headerlink" title="结构体更新语法"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E7%BB%93%E6%9E%84%E4%BD%93%E6%9B%B4%E6%96%B0%E8%AF%AD%E6%B3%95"><font style="color:rgb(0, 0, 0);">结构体更新语法</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">user2</span> = User &#123;</span><br><span class="line">      active: user1.active,</span><br><span class="line">      username: user1.username,</span><br><span class="line">      email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;another@example.com&quot;</span>),</span><br><span class="line">      sign_in_count: user1.sign_in_count,</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">user2</span> = User &#123;</span><br><span class="line">      email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;another@example.com&quot;</span>),</span><br><span class="line">      ..user1</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p><code>..user1</code><font style="color:rgb(0, 0, 0);"> 必须在结构体的尾部使用。</font></p>
<p><font style="color:#DF2A3F;">注意:</font>user 部分字段转移给了 user2,user 的 username 所有权进行了转移,导致 user 中 username 无法使用</p>
<h3 id="元组结构体-Tuple-Struct"><a href="#元组结构体-Tuple-Struct" class="headerlink" title="元组结构体(Tuple Struct)"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E5%85%83%E7%BB%84%E7%BB%93%E6%9E%84%E4%BD%93tuple-struct"><font style="color:rgb(0, 0, 0);">元组结构体(Tuple Struct)</font></a></h3><p><font style="color:rgb(0, 0, 0);">结构体必须要有名称，但是结构体的字段可以没有名称，这种结构体长得很像元组，因此被称为元组结构体，例如：</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Color</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">color</span> = <span class="title function_ invoke__">Color</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, color.<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="单元结构体-Unit-like-Struct"><a href="#单元结构体-Unit-like-Struct" class="headerlink" title="单元结构体(Unit-like Struct)"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E5%8D%95%E5%85%83%E7%BB%93%E6%9E%84%E4%BD%93unit-like-struct"><font style="color:rgb(0, 0, 0);">单元结构体(Unit-like Struct)</font></a></h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt::Display;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AlwaysEqual</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Display</span> <span class="keyword">for</span> <span class="title class_">AlwaysEqual</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> std::fmt::Formatter) <span class="punctuation">-&gt;</span> std::fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="built_in">write!</span>(f, <span class="string">&quot;I’m always equal!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = AlwaysEqual;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>AlwaysEqual</code> 是一个<strong>单元结构体</strong>，不存储数据，只代表一种类型，适用于你只关心它的“行为”（即实现了哪些 trait），不关心它“长什么样子”</p>
<table>
<thead>
<tr>
<th>写法</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>struct Person &#123; name: String &#125;</code></td>
<td>普通结构体</td>
<td>有字段，有数据</td>
</tr>
<tr>
<td><code>struct Color(u8, u8, u8);</code></td>
<td>元组结构体</td>
<td>有字段，但用位置标识</td>
</tr>
<tr>
<td><code>struct AlwaysEqual;</code></td>
<td>单元结构体</td>
<td>没字段，只代表一种“类型”</td>
</tr>
</tbody></table>
<h3 id="结构体数据的所有权"><a href="#结构体数据的所有权" class="headerlink" title="结构体数据的所有权"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E7%BB%93%E6%9E%84%E4%BD%93%E6%95%B0%E6%8D%AE%E7%9A%84%E6%89%80%E6%9C%89%E6%9D%83"><font style="color:rgb(0, 0, 0);">结构体数据的所有权</font></a></h3><p>Rust 中结构体的所有权就是字段的所有权组合，当你移动结构体或字段时，相关字段也跟着转移；用引用或 clone 可避免 move。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug, Clone)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    age: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这意味着：</p>
<ul>
<li><code>name</code> 是 <code>String</code>，不是 <code>Copy</code>，<strong>会 move 或 clone</strong></li>
<li><code>age</code> 是 <code>u32</code>，是 <code>Copy</code>，<strong>不会 move</strong></li>
</ul>
<h4 id="直接-move"><a href="#直接-move" class="headerlink" title="直接 move"></a>直接 move</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">u1</span> = User &#123;</span><br><span class="line">    name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Tom&quot;</span>),</span><br><span class="line">    age: <span class="number">18</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">u2</span> = u1;</span><br></pre></td></tr></table></figure>

<p>过程是 <strong>整体 move</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">┌────────────┐</span>          <span class="string">┌────────────┐</span></span><br><span class="line"><span class="string">│</span> <span class="string">u1</span>         <span class="string">│</span>    <span class="string">==&gt;</span>   <span class="string">│</span> <span class="string">u2</span>         <span class="string">│</span></span><br><span class="line"><span class="string">│</span> <span class="attr">name:</span> <span class="string">&quot;Tom&quot;</span><span class="string">│</span>          <span class="string">│</span> <span class="attr">name:</span> <span class="string">&quot;Tom&quot;</span><span class="string">│</span></span><br><span class="line"><span class="string">│</span> <span class="attr">age:</span> <span class="number">18</span>    <span class="string">│</span>          <span class="string">│</span> <span class="attr">age:</span> <span class="number">18</span>    <span class="string">│</span></span><br><span class="line"><span class="string">└────────────┘</span>          <span class="string">└────────────┘</span></span><br></pre></td></tr></table></figure>

<p>之后 <code>u1</code> 已经无效，不能再使用！</p>
<h4 id="clone"><a href="#clone" class="headerlink" title="clone"></a>clone</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">u2</span> = u1.<span class="title function_ invoke__">clone</span>();</span><br></pre></td></tr></table></figure>

<p>这个过程是 <strong>深拷贝 name 字段</strong>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">┌────────────┐</span>          <span class="string">┌────────────┐</span></span><br><span class="line"><span class="string">│</span> <span class="string">u1</span>         <span class="string">│</span>          <span class="string">│</span> <span class="string">u2</span>         <span class="string">│</span></span><br><span class="line"><span class="string">│</span> <span class="attr">name:</span> <span class="string">&quot;Tom&quot;</span><span class="string">│</span>    <span class="string">==&gt;</span>   <span class="string">│</span> <span class="attr">name:</span> <span class="string">&quot;Tom&quot;</span><span class="string">│</span> <span class="string">（堆内存重新分配）</span></span><br><span class="line"><span class="string">│</span> <span class="attr">age:</span> <span class="number">18</span>    <span class="string">│</span>          <span class="string">│</span> <span class="attr">age:</span> <span class="number">18</span>    <span class="string">│</span></span><br><span class="line"><span class="string">└────────────┘</span>          <span class="string">└────────────┘</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>两者都能继续用！</p>
<h4 id="字段借用（引用）"><a href="#字段借用（引用）" class="headerlink" title="字段借用（引用）"></a>字段借用（引用）</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">name</span> = &amp;u1.name;</span><br></pre></td></tr></table></figure>

<p>借用只是“指向”：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">┌────────────┐</span></span><br><span class="line"><span class="string">│</span> <span class="string">u1</span>         <span class="string">│</span></span><br><span class="line"><span class="string">│</span> <span class="attr">name:</span> <span class="string">&quot;Tom&quot;</span><span class="string">│</span> <span class="string">&lt;───</span> <span class="attr">name:</span> <span class="string">&amp;String（引用）</span></span><br><span class="line"><span class="string">└────────────┘</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">结构体字段分两类：</span><br><span class="line">- <span class="built_in">Copy</span> 类型字段：不会 <span class="keyword">move</span>，可重复使用</span><br><span class="line">- 非 <span class="built_in">Copy</span> 字段（如 <span class="type">String</span>）：使用后 <span class="keyword">move</span>，原处作废</span><br><span class="line">- 想避免 <span class="keyword">move</span>：用 clone 或引用（&amp;）</span><br></pre></td></tr></table></figure>

<h3 id="解构结构体"><a href="#解构结构体" class="headerlink" title="解构结构体"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/all-patterns.html#%E8%A7%A3%E6%9E%84%E7%BB%93%E6%9E%84%E4%BD%93"><font style="color:rgb(0, 0, 0);">解构结构体</font></a></h3><p><font style="color:rgb(0, 0, 0);">模式中的变量名不必与结构体中的字段名一致</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = Point &#123; x: <span class="number">0</span>, y: <span class="number">7</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">Point</span> &#123; x: a, y: b &#125; = p;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">0</span>, a);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">7</span>, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/27/%E7%BB%93%E6%9E%84%E4%BD%93/" data-id="cmcn4u1ba000slrqw4nff0egr" data-title="结构体" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-枚举" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/26/%E6%9E%9A%E4%B8%BE/" class="article-date">
  <time class="dt-published" datetime="2025-06-26T02:29:48.000Z" itemprop="datePublished">2025-06-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/26/%E6%9E%9A%E4%B8%BE/">枚举</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="枚举值"><a href="#枚举值" class="headerlink" title="枚举值"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/enum.html#%E6%9E%9A%E4%B8%BE%E5%80%BC"><font style="color:rgb(0, 0, 0);">枚举值</font></a></h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">PokerSuit</span> &#123;</span><br><span class="line">  Clubs,</span><br><span class="line">  Spades,</span><br><span class="line">  Diamonds,</span><br><span class="line">  Hearts,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0, 0, 0);">通过 </font><code>::</code><font style="color:rgb(0, 0, 0);"> 操作符来访问 </font><code>PokerSuit</code><font style="color:rgb(0, 0, 0);"> 下的具体成员</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">heart</span> = PokerSuit::Hearts;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">diamond</span> = PokerSuit::Diamonds;</span><br></pre></td></tr></table></figure>

<h4 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">PokerSuit</span> &#123;</span><br><span class="line">    Clubs,</span><br><span class="line">    Spades,</span><br><span class="line">    Diamonds,</span><br><span class="line">    Hearts,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PokerCard</span> &#123;</span><br><span class="line">    suit: PokerSuit,</span><br><span class="line">    value: <span class="type">u8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">c1</span> = PokerCard &#123;</span><br><span class="line">       suit: PokerSuit::Clubs,</span><br><span class="line">       value: <span class="number">1</span>,</span><br><span class="line">   &#125;;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">c2</span> = PokerCard &#123;</span><br><span class="line">       suit: PokerSuit::Diamonds,</span><br><span class="line">       value: <span class="number">12</span>,</span><br><span class="line">   &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="直接将数据信息关联到枚举成员"><a href="#直接将数据信息关联到枚举成员" class="headerlink" title="直接将数据信息关联到枚举成员"></a><font style="color:rgb(0, 0, 0);">直接将数据信息关联到枚举成员</font></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">PokerCard</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Clubs</span>(<span class="type">u8</span>),</span><br><span class="line">    <span class="title function_ invoke__">Spades</span>(<span class="type">u8</span>),</span><br><span class="line">    <span class="title function_ invoke__">Diamonds</span>(<span class="type">u8</span>),</span><br><span class="line">    <span class="title function_ invoke__">Hearts</span>(<span class="type">u8</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">c1</span> = PokerCard::<span class="title function_ invoke__">Spades</span>(<span class="number">5</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">c2</span> = PokerCard::<span class="title function_ invoke__">Diamonds</span>(<span class="number">13</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Option"><a href="#Option" class="headerlink" title="Option"></a>Option<T></h3><p><code>Option&lt;T&gt;</code> 代表：<strong>可能有值（Some）</strong>，也<strong>可能没有值（None）</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Option</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(T),  <span class="comment">// 有值</span></span><br><span class="line">    <span class="literal">None</span>,     <span class="comment">// 没有值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Some(k)</code> 是一个“拆盒子”的模式。它问：这个 <code>Option</code> 有值吗？有的话，把里面的值取出来给变量 <code>k</code>。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">key</span>: <span class="type">Option</span>&lt;<span class="type">String</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="string">&quot;门钥匙&quot;</span>.<span class="title function_ invoke__">to_string</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(k) = key &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;我带了：&#123;&#125;&quot;</span>, k);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;我没带钥匙！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>Some(k)</code> 是一个 <strong>模式（pattern）</strong>，用来“拆开” <code>Option</code> 类型。</p>
<ul>
<li>如果 <code>key</code> 的值是 <code>Some(东西)</code>，就：<ul>
<li>取出里面的 <code>东西</code></li>
<li>放到变量 <code>k</code> 里</li>
</ul>
</li>
</ul>
<h4 id="unwrap-是什么？"><a href="#unwrap-是什么？" class="headerlink" title=".unwrap() 是什么？"></a>.unwrap() 是什么？</h4><ul>
<li><code>unwrap()</code> 的意思是：<strong>我确定一定有值，把它拿出来</strong></li>
<li>但如果是 <code>None</code>，程序就会 <strong>崩溃</strong>：</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = <span class="literal">None</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">n</span> = x.<span class="title function_ invoke__">unwrap</span>(); <span class="comment">// ❌ 直接 panic!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="安全地使用-unwrap-or"><a href="#安全地使用-unwrap-or" class="headerlink" title="安全地使用 .unwrap_or()"></a>安全地使用 .unwrap_or()</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">key</span>: <span class="type">Option</span>&lt;<span class="type">String</span>&gt; = <span class="literal">None</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">real_key</span> = key.<span class="title function_ invoke__">unwrap_or</span>(<span class="string">&quot;备用钥匙&quot;</span>.<span class="title function_ invoke__">to_string</span>());</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;使用钥匙：&#123;&#125;&quot;</span>, real_key);</span><br></pre></td></tr></table></figure>

<h3 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h3><p><code>Result</code> 是 Rust 用来表示 <strong>可能成功，也可能失败</strong> 的一种类型。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T, E&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(T),    <span class="comment">// 成功，里面是结果</span></span><br><span class="line">    <span class="title function_ invoke__">Err</span>(E),   <span class="comment">// 失败，里面是错误原因</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">divide</span>(x: <span class="type">i32</span>, y: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>, <span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> y == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(<span class="string">&quot;不能除以 0&quot;</span>.<span class="title function_ invoke__">to_string</span>())</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(x / y)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">divide</span>(<span class="number">10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> result &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(val) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;结果是 &#123;&#125;&quot;</span>, val),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(err) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;出错了：&#123;&#125;&quot;</span>, err),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更短的写法：if-let"><a href="#更短的写法：if-let" class="headerlink" title="更短的写法：if let"></a>更短的写法：if let</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Ok</span>(value) = <span class="title function_ invoke__">divide</span>(<span class="number">10</span>, <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;成功：&#123;&#125;&quot;</span>, value);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;出错了&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Option-和-Result-转换-及常用-api"><a href="#Option-和-Result-转换-及常用-api" class="headerlink" title="Option 和 Result 转换,及常用 api"></a>Option 和 Result 转换,及常用 api</h3><ul>
<li><code>Option&lt;T&gt;</code>：可能有值（<code>Some(T)</code>），也可能没有值（<code>None</code>）</li>
<li><code>Result&lt;T, E&gt;</code>：可能成功（<code>Ok(T)</code>），也可能失败（<code>Err(E)</code>）</li>
</ul>
<h4 id="Option-→-Result"><a href="#Option-→-Result" class="headerlink" title="Option → Result"></a>Option → Result</h4><p>如果你想把一个 <code>Option</code> 变成 <code>Result</code>，你得提供一个错误值：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">maybe_name</span>: <span class="type">Option</span>&lt;&amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="string">&quot;小明&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">result</span>: <span class="type">Result</span>&lt;&amp;<span class="type">str</span>, &amp;<span class="type">str</span>&gt; = maybe_name.<span class="title function_ invoke__">ok_or</span>(<span class="string">&quot;没有名字&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, result); <span class="comment">// Ok(&quot;小明&quot;)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>ok_or(err)</code>：如果是 <code>Some(val)</code>，就变成 <code>Ok(val)</code>；如果是 <code>None</code>，就变成 <code>Err(err)</code></li>
</ul>
<h4 id="Result-→-Option"><a href="#Result-→-Option" class="headerlink" title="Result → Option"></a>Result → Option</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">result</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Ok</span>(<span class="number">42</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">maybe</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = result.<span class="title function_ invoke__">ok</span>(); <span class="comment">// 把 Ok(42) 转为 Some(42)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, maybe); <span class="comment">// Some(42)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>ok()</code>：把 <code>Ok(val)</code> 变成 <code>Some(val)</code>，<code>Err(_)</code> 变成 <code>None</code></li>
<li><code>err()</code>：反过来取错误值：<code>Err(e)</code> → <code>Some(e)</code></li>
</ul>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><h4 id="闭包-vs-普通函数"><a href="#闭包-vs-普通函数" class="headerlink" title="闭包 vs 普通函数"></a>闭包 vs 普通函数</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">add1_fn</span>(x: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    x + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">add1_closure</span> = |x: <span class="type">i32</span>| x + <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>fn</code> 是普通函数，必须写在外面</li>
<li><code>|x| x + 1</code> 是闭包，可以写在任何地方，更灵活</li>
</ul>
<h4 id="闭包不传参数的写法"><a href="#闭包不传参数的写法" class="headerlink" title="闭包不传参数的写法"></a>闭包不传参数的写法</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">say_hi</span> = || <span class="built_in">println!</span>(<span class="string">&quot;Hi!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">say_hi</span>(); <span class="comment">// 输出：Hi!</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>||</code> 表示这个闭包不接收任何参数</li>
<li>闭包体就像普通函数一样写 <code>&#123;&#125;</code>，或者单行可以省略</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/26/%E6%9E%9A%E4%B8%BE/" data-id="cmcn4u1b8000ilrqw2cqteqb7" data-title="枚举" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-字符串" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/25/%E5%AD%97%E7%AC%A6%E4%B8%B2/" class="article-date">
  <time class="dt-published" datetime="2025-06-25T07:25:28.000Z" itemprop="datePublished">2025-06-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/25/%E5%AD%97%E7%AC%A6%E4%B8%B2/">字符串</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h3><p><font style="color:rgb(0, 0, 0);">使用方括号包括的一个序列：</font><strong><font style="color:rgb(0, 0, 0);">[开始索引..终止索引]包含左不包含右</font></strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">hello</span> = &amp;s[<span class="number">0</span>..<span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">world</span> = &amp;s[<span class="number">6</span>..<span class="number">11</span>];</span><br></pre></td></tr></table></figure>

<p>获取最后一个元素的 2 种方法</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">len</span> = s.<span class="title function_ invoke__">len</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">slice</span> = &amp;s[<span class="number">4</span>..len];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">slice</span> = &amp;s[<span class="number">4</span>..];</span><br></pre></td></tr></table></figure>

<h3 id="字符串的字面量是切片"><a href="#字符串的字面量是切片" class="headerlink" title="字符串的字面量是切片"></a>字符串的字面量是切片</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 之前提到过字符串字面量，但是没有提到它的类型：</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;Hello, world!&quot;</span>;</span><br><span class="line"><span class="comment">// 实际上，s 的类型是 &amp;str，因此你也可以这样声明：</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s</span>: &amp;<span class="type">str</span> = <span class="string">&quot;Hello, world!&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><code>&amp;str</code>指向的是不可变的引用</p>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a><a target="_blank" rel="noopener" href="https://www.yuque.com/lisiyi-ephgy/nyhpoz/pzgsysfcyx4y5btw#QVwW0">字符串</a></h3><h4 id="String-与-str-的转换"><a href="#String-与-str-的转换" class="headerlink" title="String 与 &amp;str 的转换"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/string-slice.html#string-%E4%B8%8E-str-%E7%9A%84%E8%BD%AC%E6%8D%A2"><font style="color:rgb(0, 0, 0);">String 与 &amp;str 的转换</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello,world!&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">say_hello</span>(&amp;s);</span><br><span class="line">    <span class="title function_ invoke__">say_hello</span>(&amp;s[..]);</span><br><span class="line">    <span class="title function_ invoke__">say_hello</span>(s.<span class="title function_ invoke__">as_str</span>()); <span class="comment">// 详见所有权中字符串解释</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">say_hello</span>(s: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="操作字符串"><a href="#操作字符串" class="headerlink" title="操作字符串"></a>操作字符串</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="symbol">&#x27;static</span> <span class="type">str</span></span><br></pre></td></tr></table></figure>

<p>它是一个：</p>
<ul>
<li><strong>不可变的字符串引用</strong></li>
<li>存储在<strong>程序的只读内存区</strong></li>
<li>生命周期是 <code>&#39;static</code>（程序整个运行期都有效）</li>
<li>有能力去修改内容</li>
</ul>
<h5 id="追加-Push"><a href="#追加-Push" class="headerlink" title="追加(Push)"></a>追加(Push)</h5><p><font style="color:rgb(0, 0, 0);">在字符串尾部可以使用 </font><code>push()</code><font style="color:rgb(0, 0, 0);"> 方法追加字符 </font><code>char</code><font style="color:rgb(0, 0, 0);">，也可以使用 </font><code>push_str()</code><font style="color:rgb(0, 0, 0);"> 方法追加字符串字面量。这两个方法都是</font><strong><font style="color:rgb(0, 0, 0);">在原有的字符串上追加，并不会返回新的字符串</font></strong><font style="color:rgb(0, 0, 0);">。由于字符串追加操作要修改原来的字符串，则该字符串必须是可变的，即</font><strong><font style="color:rgb(0, 0, 0);">字符串变量必须由 </font></strong><code>**mut**</code><strong><font style="color:rgb(0, 0, 0);"> 关键字修饰</font></strong><font style="color:rgb(0, 0, 0);">。</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello &quot;</span>);</span><br><span class="line"></span><br><span class="line">    s.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;rust&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;追加字符串 push_str() -&gt; &#123;&#125;&quot;</span>, s);</span><br><span class="line"></span><br><span class="line">    s.<span class="title function_ invoke__">push</span>(<span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;追加字符 push() -&gt; &#123;&#125;&quot;</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="插入-Insert"><a href="#插入-Insert" class="headerlink" title="插入(Insert)"></a>插入(Insert)</h5><p><font style="color:rgb(0, 0, 0);">字符串插入操作要</font><strong><font style="color:rgb(0, 0, 0);">修改原来的字符串</font></strong><font style="color:rgb(0, 0, 0);">，则该字符串必须是可变的，即</font><strong><font style="color:rgb(0, 0, 0);">字符串变量必须由 </font></strong><code>**mut**</code><strong><font style="color:rgb(0, 0, 0);"> 关键字修饰</font></strong><font style="color:rgb(0, 0, 0);">。</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello rust!&quot;</span>);</span><br><span class="line">    s.<span class="title function_ invoke__">insert</span>(<span class="number">5</span>, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;插入字符 insert() -&gt; &#123;&#125;&quot;</span>, s);</span><br><span class="line">    s.<span class="title function_ invoke__">insert_str</span>(<span class="number">6</span>, <span class="string">&quot; I like&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;插入字符串 insert_str() -&gt; &#123;&#125;&quot;</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="替换-Replace"><a href="#替换-Replace" class="headerlink" title="替换 (Replace)"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/string-slice.html#%E6%9B%BF%E6%8D%A2-replace"><font style="color:rgb(0, 0, 0);">替换 (Replace)</font></a></h5><p><font style="color:rgb(0, 0, 0);">该方法是返回一个新的字符串，而不是操作原来的字符串。</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string_replace</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;I like rust. Learning rust is my favorite!&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">new_string_replace</span> = string_replace.<span class="title function_ invoke__">replace</span>(<span class="string">&quot;rust&quot;</span>, <span class="string">&quot;RUST&quot;</span>);</span><br><span class="line">    dbg!(new_string_replace);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="replacen"><a href="#replacen" class="headerlink" title="replacen"></a><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">replacen</font></h5><p><font style="color:rgb(0, 0, 0);">前两个参数与 </font><code>replace()</code><font style="color:rgb(0, 0, 0);"> 方法一样，第三个参数则表示替换的个数。</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string_replace</span> = <span class="string">&quot;I like rust. Learning rust is my favorite!&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">new_string_replacen</span> = string_replace.<span class="title function_ invoke__">replacen</span>(<span class="string">&quot;rust&quot;</span>, <span class="string">&quot;RUST&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    dbg!(new_string_replacen);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="replace-range"><a href="#replace-range" class="headerlink" title="replace_range"></a>replace_range</h5><p>该方法是直接操作原来的字符串</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">string</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="comment">// 如果范围小于替换长度,字符串会变长,反之会变短</span></span><br><span class="line">    string.<span class="title function_ invoke__">replace_range</span>(<span class="number">0</span>..<span class="number">1</span>, <span class="string">&quot;H&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="删除-Delete"><a href="#删除-Delete" class="headerlink" title="删除 (Delete)"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/string-slice.html#%E5%88%A0%E9%99%A4-delete"><font style="color:rgb(0, 0, 0);">删除 (Delete)</font></a></h5><p><font style="color:rgb(0, 0, 0);">与字符串删除相关的方法有 4 个，它们分别是 </font><code>pop()</code><font style="color:rgb(0, 0, 0);">，</font><code>remove()</code><font style="color:rgb(0, 0, 0);">，</font><code>truncate()</code><font style="color:rgb(0, 0, 0);">，</font><code>clear()</code><font style="color:rgb(0, 0, 0);">。这四个方法仅适用于 </font><code>String</code>类型<br><code>pop</code><font style="color:rgb(0, 0, 0);"> —— 删除并返回字符串的最后一个字符</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">string_pop</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;rust pop 中文!&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p1</span> = string_pop.<span class="title function_ invoke__">pop</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p2</span> = string_pop.<span class="title function_ invoke__">pop</span>();</span><br><span class="line">    dbg!(p1);</span><br><span class="line">    dbg!(p2);</span><br><span class="line">    dbg!(string_pop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>remove</code><font style="color:rgb(0, 0, 0);"> —— 删除并返回字符串中指定位置的字符</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">string_remove</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;测试remove方法&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(</span><br><span class="line">        <span class="string">&quot;string_remove 占 &#123;&#125; 个字节&quot;</span>,</span><br><span class="line">        std::mem::<span class="title function_ invoke__">size_of_val</span>(string_remove.<span class="title function_ invoke__">as_str</span>())</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 删除第一个汉字</span></span><br><span class="line">    string_remove.<span class="title function_ invoke__">remove</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 下面代码会发生错误</span></span><br><span class="line">    <span class="comment">// string_remove.remove(1);</span></span><br><span class="line">    <span class="comment">// 直接删除第二个汉字</span></span><br><span class="line">    <span class="comment">// string_remove.remove(3);</span></span><br><span class="line">    dbg!(string_remove);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>truncate</code><font style="color:rgb(0, 0, 0);"> —— 删除字符串中从指定位置开始到结尾的全部字符</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">string_truncate</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;测试truncate&quot;</span>);</span><br><span class="line">    string_truncate.<span class="title function_ invoke__">truncate</span>(<span class="number">3</span>);</span><br><span class="line">    dbg!(string_truncate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>clear</code><font style="color:rgb(0, 0, 0);"> —— 清空字符串</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">string_clear</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;string clear&quot;</span>);</span><br><span class="line">    string_clear.<span class="title function_ invoke__">clear</span>();</span><br><span class="line">    dbg!(string_clear);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="连接-Concatenate"><a href="#连接-Concatenate" class="headerlink" title="连接 (Concatenate)"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/string-slice.html#%E8%BF%9E%E6%8E%A5-concatenate"><font style="color:rgb(0, 0, 0);">连接 (Concatenate)</font></a></h5><h6 id="使用-或者-连接字符串"><a href="#使用-或者-连接字符串" class="headerlink" title="使用 + 或者 += 连接字符串"></a><font style="color:rgb(0, 0, 0);">使用 </font><code>+</code><font style="color:rgb(0, 0, 0);"> 或者 </font><code>+=</code><font style="color:rgb(0, 0, 0);"> 连接字符串</font></h6><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string_append</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello &quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string_rust</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;rust&quot;</span>);</span><br><span class="line">    <span class="comment">// &amp;string_rust会自动解引用为&amp;str</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = string_append + &amp;string_rust;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">result</span> = result + <span class="string">&quot;!&quot;</span>; <span class="comment">// `result + &quot;!&quot;` 中的 `result` 是不可变的</span></span><br><span class="line">    result += <span class="string">&quot;!!!&quot;</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;连接字符串 + -&gt; &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="let-result-string-append-string-rust"><a href="#let-result-string-append-string-rust" class="headerlink" title="let result &#x3D; string_append + &amp;string_rust;"></a>let result &#x3D; string_append + &amp;string_rust;</h6><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这2行代码等价</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">result</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello &quot;</span>) + &amp;<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;rust&quot;</span>);</span><br><span class="line"><span class="comment">// 这个 + 的行为其实是：</span></span><br><span class="line"><span class="type">String</span>::<span class="title function_ invoke__">add</span>(<span class="keyword">self</span>, rhs: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>string_append</code> 被 <strong>移动（move）</strong></li>
<li><code>&amp;string_rust</code> 会被自动解引用为 <code>&amp;str</code></li>
<li>结果是一个新的 <code>String</code>，赋值给 <code>result</code></li>
</ul>
<h6 id="let-mut-result-result-“-”"><a href="#let-mut-result-result-“-”" class="headerlink" title="let mut result &#x3D; result + “!”;"></a>let mut result &#x3D; result + “!”;</h6><ul>
<li>原来的 <code>result</code> 是不可变的</li>
<li>你用 <code>+ &quot;!&quot;</code> 创建了一个新的 <code>String</code></li>
<li>然后你把这个新的字符串用 <code>let mut result = ...</code><strong>重新声明为一个可变变量</strong></li>
</ul>
<p>❗ 这不是修改旧的 <code>result</code>，而是创建了新的变量（同名），并且是 <code>mut</code>。</p>
<h6 id="result-“-”"><a href="#result-“-”" class="headerlink" title="result +&#x3D; “!!!”;"></a>result +&#x3D; “!!!”;</h6><ul>
<li>这是对新的、可变的 <code>result</code> 做操作</li>
<li><code>+=</code> 实际上调用的是 <code>String::push_str()</code> 方法</li>
</ul>
<h6 id="String-add-self-rhs-str-String"><a href="#String-add-self-rhs-str-String" class="headerlink" title="String::add(self, rhs: &amp;str) -&gt; String"></a>String::add(self, rhs: &amp;str) -&gt; String</h6><ol>
<li>self 是 String（所有权），不是 &amp;String</li>
<li>rhs 是 &amp;str，也就是右边你用 &amp;string_rust 是 ✅ 没问题的</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello,&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s2</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;world!&quot;</span>);</span><br><span class="line">    <span class="comment">// 在下句中，s1的所有权被转移走了，因此后面不能再使用s1</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s3</span> = s1 + &amp;s2;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(s3,<span class="string">&quot;hello,world!&quot;</span>);</span><br><span class="line">    <span class="comment">// 下面的语句如果去掉注释，就会报错 ,s1的所有权已经转移到s3</span></span><br><span class="line">    <span class="comment">// println!(&quot;&#123;&#125;&quot;,s1);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="使用-format-连接字符串"><a href="#使用-format-连接字符串" class="headerlink" title="使用 format! 连接字符串"></a><font style="color:rgb(0, 0, 0);">使用 </font><code>format!</code><font style="color:rgb(0, 0, 0);"> 连接字符串</font></h6><p><code>format!</code><font style="color:rgb(0, 0, 0);"> 这种方式适用于 </font><code>String</code><font style="color:rgb(0, 0, 0);"> 和 </font><code>&amp;str</code><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">,所有权不会转移</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s1</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s2</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;rust&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125; &#123;&#125;!&quot;</span>, s1, s2);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="操作-UTF-8-字符串"><a href="#操作-UTF-8-字符串" class="headerlink" title="操作 UTF-8 字符串"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/string-slice.html#%E6%93%8D%E4%BD%9C-utf-8-%E5%AD%97%E7%AC%A6%E4%B8%B2"><font style="color:rgb(0, 0, 0);">操作 UTF-8 字符串</font></a></h4><h5 id="字符"><a href="#字符" class="headerlink" title="字符"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/string-slice.html#%E5%AD%97%E7%AC%A6"><font style="color:rgb(0, 0, 0);">字符</font></a></h5><p><font style="color:rgb(0, 0, 0);">如果你想要以 Unicode 字符的方式遍历字符串，最好的办法是使用 </font><code>chars</code><font style="color:rgb(0, 0, 0);"> 方法，例如：</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="variable">c</span> <span class="keyword">in</span> <span class="string">&quot;中国人&quot;</span>.<span class="title function_ invoke__">chars</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="字节"><a href="#字节" class="headerlink" title="字节"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/string-slice.html#%E5%AD%97%E8%8A%82"><font style="color:rgb(0, 0, 0);">字节</font></a></h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="variable">b</span> <span class="keyword">in</span> <span class="string">&quot;中国人&quot;</span>.<span class="title function_ invoke__">bytes</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="utf8-slice"><a href="#utf8-slice" class="headerlink" title="utf8_slice"></a><a target="_blank" rel="noopener" href="https://practice-zh.course.rs/collections/string.html#utf8_slice"><font style="color:rgb(0, 0, 0);">utf8_slice</font></a></h5><p><font style="color:rgb(0, 0, 0);">可以使用 </font><a target="_blank" rel="noopener" href="https://docs.rs/utf8_slice/1.0.0/utf8_slice/fn.slice.html"><font style="color:rgb(32, 96, 159);">utf8_slice</font></a><font style="color:rgb(0, 0, 0);"> 来按照字符的自然索引方式对 UTF-8 字符串进行切片访问，与之前的切片方式相比，它索引的是字符，而之前的方式索引的是字节.</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> utf8_slice;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;The 🚀 goes to the 🌑!&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">rocket</span> = utf8_slice::<span class="title function_ invoke__">slice</span>(s, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">   <span class="comment">// Will equal &quot;🚀&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/25/%E5%AD%97%E7%AC%A6%E4%B8%B2/" data-id="cmcn4u1b40009lrqwgve87suo" data-title="字符串" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-数组切片" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/24/%E6%95%B0%E7%BB%84%E5%88%87%E7%89%87/" class="article-date">
  <time class="dt-published" datetime="2025-06-24T06:41:10.000Z" itemprop="datePublished">2025-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/24/%E6%95%B0%E7%BB%84%E5%88%87%E7%89%87/">数组切片</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><ul>
<li><font style="color:rgb(0, 0, 0);">长度固定</font></li>
<li><font style="color:rgb(0, 0, 0);">元素必须有相同的类型</font></li>
<li><font style="color:rgb(0, 0, 0);">依次线性排列</font></li>
</ul>
<p><font style="color:rgb(0, 0, 0);">这里说的数组是 Rust 的基本类型，是固定长度的，这点与其他编程语言不同，其它编程语言的数组往往是可变长度的，与 Rust 中的动态数组 </font><code>Vecto</code><font style="color:rgb(0, 0, 0);"> 类似</font></p>
<h4 id="创建数组"><a href="#创建数组" class="headerlink" title="创建数组"></a><font style="color:rgb(0, 0, 0);">创建数组</font></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="数组声明类型"><a href="#数组声明类型" class="headerlink" title="数组声明类型"></a><font style="color:rgb(0, 0, 0);">数组声明类型</font></h5><p><code>i32</code><font style="color:rgb(0, 0, 0);"> 是元素类型，分号后面的数字 </font><code>5</code><font style="color:rgb(0, 0, 0);"> 是数组长度</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">3</span>; <span class="number">5</span>];</span><br></pre></td></tr></table></figure>

<p><code>[3; 5]</code><font style="color:rgb(0, 0, 0);"> 和 </font><code>[类型; 长度]</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">3</span>; <span class="number">5</span>];</span><br></pre></td></tr></table></figure>

<h3 id="数组切片"><a href="#数组切片" class="headerlink" title="数组切片"></a>数组切片</h3><p><font style="color:rgb(0, 0, 0);">许你引用集合中的部分连续片段，而不是整个集合，对于数组也是，数组切片允许我们引用数组的一部分：</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span>: [<span class="type">i32</span>; <span class="number">5</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">slice</span>: &amp;[<span class="type">i32</span>] = &amp;a[<span class="number">1</span>..<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">assert_eq!</span>(slice, &amp;[<span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/24/%E6%95%B0%E7%BB%84%E5%88%87%E7%89%87/" data-id="cmcn4u1b6000elrqwha5re78j" data-title="数组切片" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%B6%E4%BB%96/" rel="tag">其他</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Rust/" style="font-size: 20px;">Rust</a> <a href="/tags/%E5%85%B6%E4%BB%96/" style="font-size: 10px;">其他</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/07/">July 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">June 2025</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/07/03/%E8%BF%94%E5%9B%9E%E5%80%BC%E5%92%8C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/">返回值和错误处理</a>
          </li>
        
          <li>
            <a href="/2025/07/02/%E9%9B%86%E5%90%88/">集合</a>
          </li>
        
          <li>
            <a href="/2025/07/01/%E7%89%B9%E5%BE%81/">特征</a>
          </li>
        
          <li>
            <a href="/2025/06/30/%E6%B3%9B%E5%9E%8B/">泛型</a>
          </li>
        
          <li>
            <a href="/2025/06/29/%E6%96%B9%E6%B3%95/">方法</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>