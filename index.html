<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Li</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Li">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Li">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Li" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Li</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-模式匹配" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/28/%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D/" class="article-date">
  <time class="dt-published" datetime="2025-06-28T08:13:24.000Z" itemprop="datePublished">2025-06-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/28/%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D/">模式匹配</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="match"><a href="#match" class="headerlink" title="match"></a>match</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">direction</span> = Direction::Down;</span><br><span class="line">    <span class="keyword">match</span>  direction &#123;</span><br><span class="line">        Direction::Up =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Up&quot;</span>),</span><br><span class="line">        _=&gt;<span class="built_in">println!</span>(<span class="string">&quot;other&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Direction</span> &#123;</span><br><span class="line">    Up,</span><br><span class="line">    Down,</span><br><span class="line">    Left,</span><br><span class="line">    Right,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>match</code><font style="color:rgb(0, 0, 0);"> 的匹配必须要穷举出所有可能，因此这里用 </font><code>_</code><font style="color:rgb(0, 0, 0);"> 来代表未列出的所有可能性</font></li>
<li><code>match</code><font style="color:rgb(0, 0, 0);"> </font><font style="color:rgb(0, 0, 0);">的每一个分支都必须是一个表达式，且所有分支的表达式最终返回值的类型必须相同</font></li>
<li><strong><font style="color:rgb(0, 0, 0);">X | Y</font></strong><font style="color:rgb(0, 0, 0);">，类似逻辑运算符 </font><code>或</code><font style="color:rgb(0, 0, 0);">，代表该分支可以匹配 </font><code>X</code><font style="color:rgb(0, 0, 0);"> 也可以匹配 </font><code>Y</code><font style="color:rgb(0, 0, 0);">，只要满足一个即可</font></li>
</ul>
<h4 id="match匹配"><a href="#match匹配" class="headerlink" title="match匹配"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/match-if-let.html#match-%E5%8C%B9%E9%85%8D"><font style="color:rgb(0, 0, 0);">match匹配</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">match</span> target &#123;</span><br><span class="line">    模式<span class="number">1</span> =&gt; 表达式<span class="number">1</span>,</span><br><span class="line">    模式<span class="number">2</span> =&gt; &#123;</span><br><span class="line">        语句<span class="number">1</span>;</span><br><span class="line">        语句<span class="number">2</span>;</span><br><span class="line">        表达式<span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    _ =&gt; 表达式<span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>模式2举例</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">num</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="keyword">match</span> num &#123;</span><br><span class="line">        <span class="number">1</span> =&gt; <span class="string">&quot;one&quot;</span>,</span><br><span class="line">        <span class="number">2</span> =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;匹配到数字 2&quot;</span>);</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">msg</span> = <span class="string">&quot;two&quot;</span>;</span><br><span class="line">            msg  <span class="comment">// 返回值是 &quot;two&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        _ =&gt; <span class="string">&quot;other&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;result = &#123;&#125;&quot;</span>, result); <span class="comment">// 输出：result = two</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用match表达式赋值"><a href="#使用match表达式赋值" class="headerlink" title="使用match表达式赋值"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/match-if-let.html#%E4%BD%BF%E7%94%A8-match-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%B5%8B%E5%80%BC"><font style="color:rgb(0, 0, 0);">使用match表达式赋值</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">IpAddr</span> &#123;</span><br><span class="line">   Ipv4,</span><br><span class="line">   Ipv6</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ip1</span> = IpAddr::Ipv6;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ip_str</span> = <span class="keyword">match</span> ip1 &#123;</span><br><span class="line">        IpAddr::Ipv4 =&gt; <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">        _ =&gt; <span class="string">&quot;::1&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, ip_str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0, 0, 0);">匹配到 </font><code>_</code><font style="color:rgb(0, 0, 0);"> 分支，所以将 </font><code>&quot;::1&quot;</code><font style="color:rgb(0, 0, 0);"> 赋值给了 </font><code>ip_str</code></p>
<h4 id="模式绑定"><a href="#模式绑定" class="headerlink" title="模式绑定"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/match-if-let.html#%E6%A8%A1%E5%BC%8F%E7%BB%91%E5%AE%9A"><font style="color:rgb(0, 0, 0);">模式绑定</font></a></h4><p><font style="color:rgb(0, 0, 0);">模式匹配的另外一个重要功能是从模式中取出绑定的值</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">coin</span> =  Coin::<span class="title function_ invoke__">Quarter</span>(UsState::Alabama);</span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,<span class="title function_ invoke__">value</span>(coin))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">value</span>(coin:Coin)<span class="punctuation">-&gt;</span><span class="type">u8</span>&#123;</span><br><span class="line">    <span class="keyword">match</span> coin &#123;</span><br><span class="line">        Coin::<span class="title function_ invoke__">Quarter</span>(state)=&gt;&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,state);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        _=&gt;&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">UsState</span> &#123;</span><br><span class="line">    Alabama,</span><br><span class="line">    Alaska,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Coin</span> &#123;</span><br><span class="line">    Penny,</span><br><span class="line">    Nickel,</span><br><span class="line">    Dime,</span><br><span class="line">    <span class="title function_ invoke__">Quarter</span>(UsState),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="通配符"><a href="#通配符" class="headerlink" title="_通配符"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/match-if-let.html#_-%E9%80%9A%E9%85%8D%E7%AC%A6"><font style="color:rgb(0, 0, 0);">_通配符</font></a></h4><p>在 Rust 中，<code>_</code> 被称为<strong>通配符模式</strong>，它的作用是：</p>
<p>✅ <strong>匹配任意值，但</strong><br>❌ <strong>不会绑定变量，也不会使用这个值。</strong></p>
<table>
<thead>
<tr>
<th><strong>用法场景</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>match</code> 的默认分支</td>
<td><strong>匹配所有剩下的情况</strong></td>
</tr>
<tr>
<td><strong>解构时忽略某些字段</strong></td>
<td><strong>只取你关心的值，忽略其他</strong></td>
</tr>
<tr>
<td><strong>抑制 unused 变量警告</strong></td>
<td><strong>你声明了变量但暂时不用</strong></td>
</tr>
</tbody></table>
<h4 id="模式守卫"><a href="#模式守卫" class="headerlink" title="模式守卫"></a>模式守卫</h4><p><strong>模式守卫</strong>是写在 <code>match</code> 分支后面的额外条件，用 <code>if</code> 引入，起到“过滤器”的作用。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> x &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(i) <span class="keyword">if</span> i &gt; <span class="number">3</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Big number: &#123;&#125;&quot;</span>, i),</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(i) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Small number: &#123;&#125;&quot;</span>, i),</span><br><span class="line">    <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Got nothing&quot;</span>),</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>

<ul>
<li><code>if i &gt; 3</code> 就是一个 <strong>模式守卫</strong></li>
<li>它只有在模式 <code>Some(i)</code> 匹配成功后，<strong>再判断 <strong><code>**i &gt; 3**</code></strong> 是否为 true</strong></li>
</ul>
<h4 id="模式守卫迭代器"><a href="#模式守卫迭代器" class="headerlink" title="模式守卫迭代器"></a>模式守卫迭代器</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="built_in">vec!</span>[<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line">    <span class="keyword">for</span> (a, b) <span class="keyword">in</span> a.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">zip</span>(b.<span class="title function_ invoke__">iter</span>()) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; &#123;&#125;-&gt;&#123;&#125;&quot;</span>, a, b, a + b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">打印结果</span><br><span class="line"><span class="number">1</span> <span class="number">4</span><span class="punctuation">-&gt;</span><span class="number">5</span></span><br><span class="line"><span class="number">2</span> <span class="number">5</span><span class="punctuation">-&gt;</span><span class="number">7</span></span><br><span class="line"><span class="number">3</span> <span class="number">6</span><span class="punctuation">-&gt;</span><span class="number">9</span></span><br></pre></td></tr></table></figure>

<h3 id="if-let匹配"><a href="#if-let匹配" class="headerlink" title="if let匹配"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/match-if-let.html#if-let-%E5%8C%B9%E9%85%8D"><font style="color:rgb(0, 0, 0);">if let匹配</font></a></h3><p><font style="color:rgb(0, 0, 0);">有时会遇到只有一个模式的值需要被处理，其它值直接忽略的场景，如果用 </font><code>match</code><font style="color:rgb(0, 0, 0);"> 来处理就要写成下面这样：</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span> = <span class="title function_ invoke__">Some</span>(<span class="number">3u8</span>);</span><br><span class="line"><span class="keyword">match</span> v &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(<span class="number">3</span>) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;three&quot;</span>),</span><br><span class="line">    _ =&gt; (),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以使用if let匹配</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="number">3</span>) = v &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;three&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><font style="color:rgb(0, 0, 0);">当你只要匹配一个条件，且忽略其他条件时就用 </font></strong><code>if let</code><strong><font style="color:rgb(0, 0, 0);"> ，否则都用 </font></strong><code>match</code><font style="color:rgb(0, 0, 0);">。</font></p>
<h3 id="matches-宏"><a href="#matches-宏" class="headerlink" title="matches!宏"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/match-if-let.html#matches%E5%AE%8F"><font style="color:rgb(0, 0, 0);">matches!宏</font></a></h3><p><font style="color:rgb(0, 0, 0);">它可以将一个表达式跟模式进行匹配，然后返回匹配的结果 </font><code>true</code><font style="color:rgb(0, 0, 0);"> or </font><code>false</code><font style="color:rgb(0, 0, 0);">。</font></p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a><font style="color:rgb(0, 0, 0);">语法</font></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">matches!(值, 模式)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>match</code>: 多种分支逻辑处理</li>
<li><code>matches!</code>: 判断是否符合某种模式，结果是布尔值</li>
</ul>
<h4 id="匹配某个枚举变体"><a href="#匹配某个枚举变体" class="headerlink" title="匹配某个枚举变体"></a>匹配某个枚举变体</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">MyEnum</span> &#123;</span><br><span class="line">    A,</span><br><span class="line">    B,</span><br><span class="line">    <span class="title function_ invoke__">C</span>(<span class="type">i32</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">val</span> = MyEnum::<span class="title function_ invoke__">C</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> matches!(val, MyEnum::<span class="title function_ invoke__">C</span>(_)) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;是 C 变体！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="结合-if-使用"><a href="#结合-if-使用" class="headerlink" title="结合 if 使用"></a>结合 <code>if</code> 使用</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> matches!(x, <span class="title function_ invoke__">Some</span>(_)) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;有值！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="用作布尔表达式"><a href="#用作布尔表达式" class="headerlink" title="用作布尔表达式"></a>用作布尔表达式</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="title function_ invoke__">Some</span>(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">is_none</span> = matches!(x, <span class="literal">None</span>);  <span class="comment">// false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="带条件匹配（守卫）"><a href="#带条件匹配（守卫）" class="headerlink" title="带条件匹配（守卫）"></a>带条件匹配（守卫）</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="title function_ invoke__">Some</span>(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> matches!(x, <span class="title function_ invoke__">Some</span>(v) <span class="keyword">if</span> v &gt; <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;匹配到大于 3 的 Some&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><table>
<thead>
<tr>
<th>特性</th>
<th><code>match</code> 语句</th>
<th><code>matches!</code> 宏</th>
</tr>
</thead>
<tbody><tr>
<td>返回类型</td>
<td>任意类型（表达式）</td>
<td><code>bool</code>（true &#x2F; false）</td>
</tr>
<tr>
<td>用于</td>
<td>执行不同逻辑</td>
<td>判断某个值是否匹配某个模式</td>
</tr>
<tr>
<td>可否写逻辑块</td>
<td>✅ 可以写 <code>&#123;&#125;</code> 多行</td>
<td>❌ 不能，只能判断</td>
</tr>
<tr>
<td>是否简洁</td>
<td>❌ 相对繁琐</td>
<td>✅ 非常简洁</td>
</tr>
</tbody></table>
<h3 id="变量遮蔽"><a href="#变量遮蔽" class="headerlink" title="变量遮蔽"></a>变量遮蔽</h3><h4 id="if-let-Some-age-age-中，为什么还能打印出-age-30？"><a href="#if-let-Some-age-age-中，为什么还能打印出-age-30？" class="headerlink" title="if let Some(age) = age 中，为什么还能打印出 age = 30？"></a><code>if let Some(age) = age</code> 中，为什么还能打印出 <code>age = 30</code>？</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">age</span> = <span class="title function_ invoke__">Some</span>(<span class="number">30</span>);</span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;在匹配前，age是&#123;:?&#125;&quot;</span>, age);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(age) = age &#123;</span><br><span class="line">       <span class="built_in">println!</span>(<span class="string">&quot;匹配出来的age是&#123;&#125;&quot;</span>, age);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;在匹配后，age是&#123;:?&#125;&quot;</span>, age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这一句其实做了 <strong>两件事</strong>：</p>
<ol>
<li><strong>匹配</strong>外层的 <code>age</code>（它是 <code>Option&lt;i32&gt;</code>，值为 <code>Some(30)</code>）</li>
<li>**创建一个新的局部变量 **<code>**age**</code>，它的类型是 <code>i32</code>，值是 30</li>
</ol>
<p>这就叫做 <strong>变量遮蔽（shadowing）</strong>：</p>
<ul>
<li><code>if let</code> 里的 <code>age</code><strong>是新的变量</strong></li>
<li>它 **暂时遮蔽了外层的 **<code>**age**</code></li>
<li>匹配代码块外还是原来的 <code>Option&lt;i32&gt;</code> 类型</li>
</ul>
<h3 id="绑定符"><a href="#绑定符" class="headerlink" title="@绑定符"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/all-patterns.html#%E7%BB%91%E5%AE%9A"><font style="color:rgb(0, 0, 0);">@绑定</font></a>符</h3><p> Rust 里的 <code>@</code> 是“<strong>一边匹配，一边命名</strong>”的工具。  </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">age</span> = <span class="title function_ invoke__">Some</span>(<span class="number">18</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(x @ <span class="number">13</span>..=<span class="number">19</span>) = age &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;青少年：&#123;&#125;&quot;</span>, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>写法</th>
<th>意思</th>
</tr>
</thead>
<tbody><tr>
<td><code>x @ 条件</code></td>
<td>如果满足“条件”，就起名叫 <code>x</code></td>
</tr>
<tr>
<td><code>Some(x @ ..)</code></td>
<td>匹配 <code>Some</code>，解出值叫 <code>x</code></td>
</tr>
</tbody></table>
<h4 id="前绑定后解构"><a href="#前绑定后解构" class="headerlink" title="@前绑定后解构"></a>@前绑定后解构</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// 绑定新变量 `p`，同时对 `Point` 进行解构</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> @ Point &#123;x: px, y: py &#125; = Point &#123;x: <span class="number">10</span>, y: <span class="number">23</span>&#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;x: &#123;&#125;, y: &#123;&#125;&quot;</span>, px, py);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, p);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">point</span> = Point &#123;x: <span class="number">10</span>, y: <span class="number">5</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">p</span> @ Point &#123;x: <span class="number">10</span>, y&#125; = point &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;x is 10 and y is &#123;&#125; in &#123;:?&#125;&quot;</span>, y, p);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;x was not 10 :(&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="序列化-反序列化"><a href="#序列化-反序列化" class="headerlink" title="序列化-&gt;反序列化"></a>序列化-&gt;反序列化</h3><p>引入依赖</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">serde</span> = &#123; version = <span class="string">&quot;1.0&quot;</span>, features = [<span class="string">&quot;derive&quot;</span>] &#125;</span><br><span class="line"><span class="attr">serde_json</span> = <span class="string">&quot;1.0&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>serde</code> 是 <strong>序列化框架的核心</strong>（负责 trait 定义、推导机制）</li>
<li><code>serde_json</code> 是 <strong>支持 JSON 格式的具体实现</strong></li>
</ul>
<h4 id="serde"><a href="#serde" class="headerlink" title="serde"></a><code>serde</code></h4><p>提供了 <code>Serialize</code>、<code>Deserialize</code> 这两个核心 trait，还有宏 <code>#[derive(Serialize, Deserialize)]</code></p>
<h4 id="serde-json"><a href="#serde-json" class="headerlink" title="serde_json"></a>serde_json</h4><p>提供了具体的 JSON 格式处理器，包括：</p>
<ul>
<li><code>to_string()</code></li>
<li><code>from_str()</code></li>
<li><code>Value</code> 类型（类似 JS 的动态 JSON 类型）</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> serde::&#123;Deserialize, Serialize&#125;;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">info</span> = Information &#123;</span><br><span class="line">        name: <span class="string">&quot;John&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        age: <span class="number">20</span>,</span><br><span class="line">        email: <span class="string">&quot;john@example.com&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        address: Address &#123;</span><br><span class="line">            strees: <span class="string">&quot;123 Main St&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            city: <span class="string">&quot;New York&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        &#125;,</span><br><span class="line">        phone_number: <span class="built_in">vec!</span>[<span class="string">&quot;123-456-7890&quot;</span>.<span class="title function_ invoke__">to_string</span>(), <span class="string">&quot;098-765-4321&quot;</span>.<span class="title function_ invoke__">to_string</span>()],</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">str_info</span> = serde_json::<span class="title function_ invoke__">to_string_pretty</span>(&amp;info).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, str_info);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">infomation</span>: Information = serde_json::<span class="title function_ invoke__">from_str</span>(&amp;str_info).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, infomation);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#[derive(Serialize, Deserialize, Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Information</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    age: <span class="type">i32</span>,</span><br><span class="line">    email: <span class="type">String</span>,</span><br><span class="line">    address: Address,</span><br><span class="line">    phone_number: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#[derive(Serialize, Deserialize, Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">    strees: <span class="type">String</span>,</span><br><span class="line">    city: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/28/%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D/" data-id="cmcfzbttw000kggqwaz7pcuvh" data-title="模式匹配" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-结构体" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/27/%E7%BB%93%E6%9E%84%E4%BD%93/" class="article-date">
  <time class="dt-published" datetime="2025-06-27T01:12:57.000Z" itemprop="datePublished">2025-06-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/27/%E7%BB%93%E6%9E%84%E4%BD%93/">结构体</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="结构体语法"><a href="#结构体语法" class="headerlink" title="结构体语法"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E7%BB%93%E6%9E%84%E4%BD%93%E8%AF%AD%E6%B3%95"><font style="color:rgb(0, 0, 0);">结构体语法</font></a></h3><h4 id="定义结构体"><a href="#定义结构体" class="headerlink" title="定义结构体"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%84%E4%BD%93"><font style="color:rgb(0, 0, 0);">定义结构体</font></a></h4><p><font style="color:rgb(0, 0, 0);">一个结构体由几部分组成：</font></p>
<ul>
<li><font style="color:rgb(0, 0, 0);">通过关键字</font><font style="color:rgb(0, 0, 0);"> </font><code>&gt;struct</code><font style="color:rgb(0, 0, 0);"> </font><font style="color:rgb(0, 0, 0);">定义</font></li>
<li><font style="color:rgb(0, 0, 0);">一个清晰明确的结构体</font><font style="color:rgb(0, 0, 0);"> </font><code>名称</code></li>
<li><font style="color:rgb(0, 0, 0);">几个有名字的结构体 </font><code>字段</code></li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    active: <span class="type">bool</span>,</span><br><span class="line">    username: <span class="type">String</span>,</span><br><span class="line">    email: <span class="type">String</span>,</span><br><span class="line">    sign_in_count: <span class="type">u64</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建结构体实例"><a href="#创建结构体实例" class="headerlink" title="创建结构体实例"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E5%88%9B%E5%BB%BA%E7%BB%93%E6%9E%84%E4%BD%93%E5%AE%9E%E4%BE%8B"><font style="color:rgb(0, 0, 0);">创建结构体实例</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">user1</span> = User &#123;</span><br><span class="line">    email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someone@example.com&quot;</span>),</span><br><span class="line">    username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someusername123&quot;</span>),</span><br><span class="line">    active: <span class="literal">true</span>,</span><br><span class="line">    sign_in_count: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><font style="color:rgb(0, 0, 0);">初始化实例时，</font><strong><font style="color:rgb(0, 0, 0);">每个字段</font></strong><font style="color:rgb(0, 0, 0);">都需要进行初始化</font></li>
<li><font style="color:rgb(0, 0, 0);">初始化时的字段顺序</font><strong><font style="color:rgb(0, 0, 0);">不需要</font></strong><font style="color:rgb(0, 0, 0);">和结构体定义时的顺序一致</font></li>
</ol>
<h4 id="访问结构体字段"><a href="#访问结构体字段" class="headerlink" title="访问结构体字段"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E8%AE%BF%E9%97%AE%E7%BB%93%E6%9E%84%E4%BD%93%E5%AD%97%E6%AE%B5"><font style="color:rgb(0, 0, 0);">访问结构体字段</font></a></h4><p><font style="color:rgb(0, 0, 0);">通过 </font><code>.</code><font style="color:rgb(0, 0, 0);"> 操作符即可访问结构体实例内部的字段值，也可以修改它们：</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可变的才能进行修改</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">user</span> = User &#123;</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someusername123&quot;</span>),</span><br><span class="line">        email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someone@example.com&quot;</span>),</span><br><span class="line">        sign_in_count: <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    user.active = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, user.active)</span><br></pre></td></tr></table></figure>

<h4 id="结构体更新语法"><a href="#结构体更新语法" class="headerlink" title="结构体更新语法"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E7%BB%93%E6%9E%84%E4%BD%93%E6%9B%B4%E6%96%B0%E8%AF%AD%E6%B3%95"><font style="color:rgb(0, 0, 0);">结构体更新语法</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">user2</span> = User &#123;</span><br><span class="line">      active: user1.active,</span><br><span class="line">      username: user1.username,</span><br><span class="line">      email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;another@example.com&quot;</span>),</span><br><span class="line">      sign_in_count: user1.sign_in_count,</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">user2</span> = User &#123;</span><br><span class="line">      email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;another@example.com&quot;</span>),</span><br><span class="line">      ..user1</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p><code>..user1</code><font style="color:rgb(0, 0, 0);"> 必须在结构体的尾部使用。</font></p>
<p><font style="color:#DF2A3F;">注意:</font>user 部分字段转移给了 user2,user 的 username 所有权进行了转移,导致 user 中 username 无法使用</p>
<h3 id="元组结构体-Tuple-Struct"><a href="#元组结构体-Tuple-Struct" class="headerlink" title="元组结构体(Tuple Struct)"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E5%85%83%E7%BB%84%E7%BB%93%E6%9E%84%E4%BD%93tuple-struct"><font style="color:rgb(0, 0, 0);">元组结构体(Tuple Struct)</font></a></h3><p><font style="color:rgb(0, 0, 0);">结构体必须要有名称，但是结构体的字段可以没有名称，这种结构体长得很像元组，因此被称为元组结构体，例如：</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Color</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">color</span> = <span class="title function_ invoke__">Color</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, color.<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="单元结构体-Unit-like-Struct"><a href="#单元结构体-Unit-like-Struct" class="headerlink" title="单元结构体(Unit-like Struct)"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E5%8D%95%E5%85%83%E7%BB%93%E6%9E%84%E4%BD%93unit-like-struct"><font style="color:rgb(0, 0, 0);">单元结构体(Unit-like Struct)</font></a></h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt::Display;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AlwaysEqual</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Display</span> <span class="keyword">for</span> <span class="title class_">AlwaysEqual</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> std::fmt::Formatter) <span class="punctuation">-&gt;</span> std::fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="built_in">write!</span>(f, <span class="string">&quot;I’m always equal!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = AlwaysEqual;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>AlwaysEqual</code> 是一个<strong>单元结构体</strong>，不存储数据，只代表一种类型，适用于你只关心它的“行为”（即实现了哪些 trait），不关心它“长什么样子”</p>
<table>
<thead>
<tr>
<th>写法</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>struct Person &#123; name: String &#125;</code></td>
<td>普通结构体</td>
<td>有字段，有数据</td>
</tr>
<tr>
<td><code>struct Color(u8, u8, u8);</code></td>
<td>元组结构体</td>
<td>有字段，但用位置标识</td>
</tr>
<tr>
<td><code>struct AlwaysEqual;</code></td>
<td>单元结构体</td>
<td>没字段，只代表一种“类型”</td>
</tr>
</tbody></table>
<h3 id="结构体数据的所有权"><a href="#结构体数据的所有权" class="headerlink" title="结构体数据的所有权"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/struct.html#%E7%BB%93%E6%9E%84%E4%BD%93%E6%95%B0%E6%8D%AE%E7%9A%84%E6%89%80%E6%9C%89%E6%9D%83"><font style="color:rgb(0, 0, 0);">结构体数据的所有权</font></a></h3><p>Rust 中结构体的所有权就是字段的所有权组合，当你移动结构体或字段时，相关字段也跟着转移；用引用或 clone 可避免 move。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug, Clone)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    age: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这意味着：</p>
<ul>
<li><code>name</code> 是 <code>String</code>，不是 <code>Copy</code>，<strong>会 move 或 clone</strong></li>
<li><code>age</code> 是 <code>u32</code>，是 <code>Copy</code>，<strong>不会 move</strong></li>
</ul>
<h4 id="直接-move"><a href="#直接-move" class="headerlink" title="直接 move"></a>直接 move</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">u1</span> = User &#123;</span><br><span class="line">    name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Tom&quot;</span>),</span><br><span class="line">    age: <span class="number">18</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">u2</span> = u1;</span><br></pre></td></tr></table></figure>

<p>过程是 <strong>整体 move</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">┌────────────┐</span>          <span class="string">┌────────────┐</span></span><br><span class="line"><span class="string">│</span> <span class="string">u1</span>         <span class="string">│</span>    <span class="string">==&gt;</span>   <span class="string">│</span> <span class="string">u2</span>         <span class="string">│</span></span><br><span class="line"><span class="string">│</span> <span class="attr">name:</span> <span class="string">&quot;Tom&quot;</span><span class="string">│</span>          <span class="string">│</span> <span class="attr">name:</span> <span class="string">&quot;Tom&quot;</span><span class="string">│</span></span><br><span class="line"><span class="string">│</span> <span class="attr">age:</span> <span class="number">18</span>    <span class="string">│</span>          <span class="string">│</span> <span class="attr">age:</span> <span class="number">18</span>    <span class="string">│</span></span><br><span class="line"><span class="string">└────────────┘</span>          <span class="string">└────────────┘</span></span><br></pre></td></tr></table></figure>

<p>之后 <code>u1</code> 已经无效，不能再使用！</p>
<h4 id="clone"><a href="#clone" class="headerlink" title="clone"></a>clone</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">u2</span> = u1.<span class="title function_ invoke__">clone</span>();</span><br></pre></td></tr></table></figure>

<p>这个过程是 <strong>深拷贝 name 字段</strong>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">┌────────────┐</span>          <span class="string">┌────────────┐</span></span><br><span class="line"><span class="string">│</span> <span class="string">u1</span>         <span class="string">│</span>          <span class="string">│</span> <span class="string">u2</span>         <span class="string">│</span></span><br><span class="line"><span class="string">│</span> <span class="attr">name:</span> <span class="string">&quot;Tom&quot;</span><span class="string">│</span>    <span class="string">==&gt;</span>   <span class="string">│</span> <span class="attr">name:</span> <span class="string">&quot;Tom&quot;</span><span class="string">│</span> <span class="string">（堆内存重新分配）</span></span><br><span class="line"><span class="string">│</span> <span class="attr">age:</span> <span class="number">18</span>    <span class="string">│</span>          <span class="string">│</span> <span class="attr">age:</span> <span class="number">18</span>    <span class="string">│</span></span><br><span class="line"><span class="string">└────────────┘</span>          <span class="string">└────────────┘</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>两者都能继续用！</p>
<h4 id="字段借用（引用）"><a href="#字段借用（引用）" class="headerlink" title="字段借用（引用）"></a>字段借用（引用）</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">name</span> = &amp;u1.name;</span><br></pre></td></tr></table></figure>

<p>借用只是“指向”：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">┌────────────┐</span></span><br><span class="line"><span class="string">│</span> <span class="string">u1</span>         <span class="string">│</span></span><br><span class="line"><span class="string">│</span> <span class="attr">name:</span> <span class="string">&quot;Tom&quot;</span><span class="string">│</span> <span class="string">&lt;───</span> <span class="attr">name:</span> <span class="string">&amp;String（引用）</span></span><br><span class="line"><span class="string">└────────────┘</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">结构体字段分两类：</span><br><span class="line">- <span class="built_in">Copy</span> 类型字段：不会 <span class="keyword">move</span>，可重复使用</span><br><span class="line">- 非 <span class="built_in">Copy</span> 字段（如 <span class="type">String</span>）：使用后 <span class="keyword">move</span>，原处作废</span><br><span class="line">- 想避免 <span class="keyword">move</span>：用 clone 或引用（&amp;）</span><br></pre></td></tr></table></figure>

<h3 id="解构结构体"><a href="#解构结构体" class="headerlink" title="解构结构体"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/match-pattern/all-patterns.html#%E8%A7%A3%E6%9E%84%E7%BB%93%E6%9E%84%E4%BD%93"><font style="color:rgb(0, 0, 0);">解构结构体</font></a></h3><p><font style="color:rgb(0, 0, 0);">模式中的变量名不必与结构体中的字段名一致</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = Point &#123; x: <span class="number">0</span>, y: <span class="number">7</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">Point</span> &#123; x: a, y: b &#125; = p;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">0</span>, a);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">7</span>, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/27/%E7%BB%93%E6%9E%84%E4%BD%93/" data-id="cmcfzbtu3000qggqw59yu2g6s" data-title="结构体" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-枚举" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/26/%E6%9E%9A%E4%B8%BE/" class="article-date">
  <time class="dt-published" datetime="2025-06-26T02:29:48.000Z" itemprop="datePublished">2025-06-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/26/%E6%9E%9A%E4%B8%BE/">枚举</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="枚举值"><a href="#枚举值" class="headerlink" title="枚举值"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/enum.html#%E6%9E%9A%E4%B8%BE%E5%80%BC"><font style="color:rgb(0, 0, 0);">枚举值</font></a></h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">PokerSuit</span> &#123;</span><br><span class="line">  Clubs,</span><br><span class="line">  Spades,</span><br><span class="line">  Diamonds,</span><br><span class="line">  Hearts,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0, 0, 0);">通过 </font><code>::</code><font style="color:rgb(0, 0, 0);"> 操作符来访问 </font><code>PokerSuit</code><font style="color:rgb(0, 0, 0);"> 下的具体成员</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">heart</span> = PokerSuit::Hearts;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">diamond</span> = PokerSuit::Diamonds;</span><br></pre></td></tr></table></figure>

<h4 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">PokerSuit</span> &#123;</span><br><span class="line">    Clubs,</span><br><span class="line">    Spades,</span><br><span class="line">    Diamonds,</span><br><span class="line">    Hearts,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PokerCard</span> &#123;</span><br><span class="line">    suit: PokerSuit,</span><br><span class="line">    value: <span class="type">u8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">c1</span> = PokerCard &#123;</span><br><span class="line">       suit: PokerSuit::Clubs,</span><br><span class="line">       value: <span class="number">1</span>,</span><br><span class="line">   &#125;;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">c2</span> = PokerCard &#123;</span><br><span class="line">       suit: PokerSuit::Diamonds,</span><br><span class="line">       value: <span class="number">12</span>,</span><br><span class="line">   &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="直接将数据信息关联到枚举成员"><a href="#直接将数据信息关联到枚举成员" class="headerlink" title="直接将数据信息关联到枚举成员"></a><font style="color:rgb(0, 0, 0);">直接将数据信息关联到枚举成员</font></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">PokerCard</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Clubs</span>(<span class="type">u8</span>),</span><br><span class="line">    <span class="title function_ invoke__">Spades</span>(<span class="type">u8</span>),</span><br><span class="line">    <span class="title function_ invoke__">Diamonds</span>(<span class="type">u8</span>),</span><br><span class="line">    <span class="title function_ invoke__">Hearts</span>(<span class="type">u8</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">c1</span> = PokerCard::<span class="title function_ invoke__">Spades</span>(<span class="number">5</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">c2</span> = PokerCard::<span class="title function_ invoke__">Diamonds</span>(<span class="number">13</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Option"><a href="#Option" class="headerlink" title="Option"></a>Option<T></h3><p><code>Option&lt;T&gt;</code> 代表：<strong>可能有值（Some）</strong>，也<strong>可能没有值（None）</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Option</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(T),  <span class="comment">// 有值</span></span><br><span class="line">    <span class="literal">None</span>,     <span class="comment">// 没有值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Some(k)</code> 是一个“拆盒子”的模式。它问：这个 <code>Option</code> 有值吗？有的话，把里面的值取出来给变量 <code>k</code>。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">key</span>: <span class="type">Option</span>&lt;<span class="type">String</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="string">&quot;门钥匙&quot;</span>.<span class="title function_ invoke__">to_string</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(k) = key &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;我带了：&#123;&#125;&quot;</span>, k);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;我没带钥匙！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>Some(k)</code> 是一个 <strong>模式（pattern）</strong>，用来“拆开” <code>Option</code> 类型。</p>
<ul>
<li>如果 <code>key</code> 的值是 <code>Some(东西)</code>，就：<ul>
<li>取出里面的 <code>东西</code></li>
<li>放到变量 <code>k</code> 里</li>
</ul>
</li>
</ul>
<h4 id="unwrap-是什么？"><a href="#unwrap-是什么？" class="headerlink" title=".unwrap() 是什么？"></a>.unwrap() 是什么？</h4><ul>
<li><code>unwrap()</code> 的意思是：<strong>我确定一定有值，把它拿出来</strong></li>
<li>但如果是 <code>None</code>，程序就会 <strong>崩溃</strong>：</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = <span class="literal">None</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">n</span> = x.<span class="title function_ invoke__">unwrap</span>(); <span class="comment">// ❌ 直接 panic!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="安全地使用-unwrap-or"><a href="#安全地使用-unwrap-or" class="headerlink" title="安全地使用 .unwrap_or()"></a>安全地使用 .unwrap_or()</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">key</span>: <span class="type">Option</span>&lt;<span class="type">String</span>&gt; = <span class="literal">None</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">real_key</span> = key.<span class="title function_ invoke__">unwrap_or</span>(<span class="string">&quot;备用钥匙&quot;</span>.<span class="title function_ invoke__">to_string</span>());</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;使用钥匙：&#123;&#125;&quot;</span>, real_key);</span><br></pre></td></tr></table></figure>

<h3 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h3><p><code>Result</code> 是 Rust 用来表示 <strong>可能成功，也可能失败</strong> 的一种类型。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T, E&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(T),    <span class="comment">// 成功，里面是结果</span></span><br><span class="line">    <span class="title function_ invoke__">Err</span>(E),   <span class="comment">// 失败，里面是错误原因</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">divide</span>(x: <span class="type">i32</span>, y: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>, <span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> y == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(<span class="string">&quot;不能除以 0&quot;</span>.<span class="title function_ invoke__">to_string</span>())</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(x / y)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">divide</span>(<span class="number">10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> result &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(val) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;结果是 &#123;&#125;&quot;</span>, val),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(err) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;出错了：&#123;&#125;&quot;</span>, err),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更短的写法：if-let"><a href="#更短的写法：if-let" class="headerlink" title="更短的写法：if let"></a>更短的写法：if let</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Ok</span>(value) = <span class="title function_ invoke__">divide</span>(<span class="number">10</span>, <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;成功：&#123;&#125;&quot;</span>, value);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;出错了&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Option-和-Result-转换-及常用-api"><a href="#Option-和-Result-转换-及常用-api" class="headerlink" title="Option 和 Result 转换,及常用 api"></a>Option 和 Result 转换,及常用 api</h3><ul>
<li><code>Option&lt;T&gt;</code>：可能有值（<code>Some(T)</code>），也可能没有值（<code>None</code>）</li>
<li><code>Result&lt;T, E&gt;</code>：可能成功（<code>Ok(T)</code>），也可能失败（<code>Err(E)</code>）</li>
</ul>
<h4 id="Option-→-Result"><a href="#Option-→-Result" class="headerlink" title="Option → Result"></a>Option → Result</h4><p>如果你想把一个 <code>Option</code> 变成 <code>Result</code>，你得提供一个错误值：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">maybe_name</span>: <span class="type">Option</span>&lt;&amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="string">&quot;小明&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">result</span>: <span class="type">Result</span>&lt;&amp;<span class="type">str</span>, &amp;<span class="type">str</span>&gt; = maybe_name.<span class="title function_ invoke__">ok_or</span>(<span class="string">&quot;没有名字&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, result); <span class="comment">// Ok(&quot;小明&quot;)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>ok_or(err)</code>：如果是 <code>Some(val)</code>，就变成 <code>Ok(val)</code>；如果是 <code>None</code>，就变成 <code>Err(err)</code></li>
</ul>
<h4 id="Result-→-Option"><a href="#Result-→-Option" class="headerlink" title="Result → Option"></a>Result → Option</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">result</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Ok</span>(<span class="number">42</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">maybe</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = result.<span class="title function_ invoke__">ok</span>(); <span class="comment">// 把 Ok(42) 转为 Some(42)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, maybe); <span class="comment">// Some(42)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>ok()</code>：把 <code>Ok(val)</code> 变成 <code>Some(val)</code>，<code>Err(_)</code> 变成 <code>None</code></li>
<li><code>err()</code>：反过来取错误值：<code>Err(e)</code> → <code>Some(e)</code></li>
</ul>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><h4 id="闭包-vs-普通函数"><a href="#闭包-vs-普通函数" class="headerlink" title="闭包 vs 普通函数"></a>闭包 vs 普通函数</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">add1_fn</span>(x: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    x + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">add1_closure</span> = |x: <span class="type">i32</span>| x + <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>fn</code> 是普通函数，必须写在外面</li>
<li><code>|x| x + 1</code> 是闭包，可以写在任何地方，更灵活</li>
</ul>
<h4 id="闭包不传参数的写法"><a href="#闭包不传参数的写法" class="headerlink" title="闭包不传参数的写法"></a>闭包不传参数的写法</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">say_hi</span> = || <span class="built_in">println!</span>(<span class="string">&quot;Hi!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">say_hi</span>(); <span class="comment">// 输出：Hi!</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>||</code> 表示这个闭包不接收任何参数</li>
<li>闭包体就像普通函数一样写 <code>&#123;&#125;</code>，或者单行可以省略</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/26/%E6%9E%9A%E4%B8%BE/" data-id="cmcfzbttv000gggqw9gsk9po0" data-title="枚举" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-字符串" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/25/%E5%AD%97%E7%AC%A6%E4%B8%B2/" class="article-date">
  <time class="dt-published" datetime="2025-06-25T07:25:28.000Z" itemprop="datePublished">2025-06-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/25/%E5%AD%97%E7%AC%A6%E4%B8%B2/">字符串</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h3><p><font style="color:rgb(0, 0, 0);">使用方括号包括的一个序列：</font><strong><font style="color:rgb(0, 0, 0);">[开始索引..终止索引]包含左不包含右</font></strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">hello</span> = &amp;s[<span class="number">0</span>..<span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">world</span> = &amp;s[<span class="number">6</span>..<span class="number">11</span>];</span><br></pre></td></tr></table></figure>

<p>获取最后一个元素的 2 种方法</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">len</span> = s.<span class="title function_ invoke__">len</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">slice</span> = &amp;s[<span class="number">4</span>..len];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">slice</span> = &amp;s[<span class="number">4</span>..];</span><br></pre></td></tr></table></figure>

<h3 id="字符串的字面量是切片"><a href="#字符串的字面量是切片" class="headerlink" title="字符串的字面量是切片"></a>字符串的字面量是切片</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 之前提到过字符串字面量，但是没有提到它的类型：</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;Hello, world!&quot;</span>;</span><br><span class="line"><span class="comment">// 实际上，s 的类型是 &amp;str，因此你也可以这样声明：</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s</span>: &amp;<span class="type">str</span> = <span class="string">&quot;Hello, world!&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><code>&amp;str</code>指向的是不可变的引用</p>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a><a target="_blank" rel="noopener" href="https://www.yuque.com/lisiyi-ephgy/nyhpoz/pzgsysfcyx4y5btw#QVwW0">字符串</a></h3><h4 id="String-与-str-的转换"><a href="#String-与-str-的转换" class="headerlink" title="String 与 &amp;str 的转换"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/string-slice.html#string-%E4%B8%8E-str-%E7%9A%84%E8%BD%AC%E6%8D%A2"><font style="color:rgb(0, 0, 0);">String 与 &amp;str 的转换</font></a></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello,world!&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">say_hello</span>(&amp;s);</span><br><span class="line">    <span class="title function_ invoke__">say_hello</span>(&amp;s[..]);</span><br><span class="line">    <span class="title function_ invoke__">say_hello</span>(s.<span class="title function_ invoke__">as_str</span>()); <span class="comment">// 详见所有权中字符串解释</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">say_hello</span>(s: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="操作字符串"><a href="#操作字符串" class="headerlink" title="操作字符串"></a>操作字符串</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="symbol">&#x27;static</span> <span class="type">str</span></span><br></pre></td></tr></table></figure>

<p>它是一个：</p>
<ul>
<li><strong>不可变的字符串引用</strong></li>
<li>存储在<strong>程序的只读内存区</strong></li>
<li>生命周期是 <code>&#39;static</code>（程序整个运行期都有效）</li>
<li>有能力去修改内容</li>
</ul>
<h5 id="追加-Push"><a href="#追加-Push" class="headerlink" title="追加(Push)"></a>追加(Push)</h5><p><font style="color:rgb(0, 0, 0);">在字符串尾部可以使用 </font><code>push()</code><font style="color:rgb(0, 0, 0);"> 方法追加字符 </font><code>char</code><font style="color:rgb(0, 0, 0);">，也可以使用 </font><code>push_str()</code><font style="color:rgb(0, 0, 0);"> 方法追加字符串字面量。这两个方法都是</font><strong><font style="color:rgb(0, 0, 0);">在原有的字符串上追加，并不会返回新的字符串</font></strong><font style="color:rgb(0, 0, 0);">。由于字符串追加操作要修改原来的字符串，则该字符串必须是可变的，即</font><strong><font style="color:rgb(0, 0, 0);">字符串变量必须由 </font></strong><code>**mut**</code><strong><font style="color:rgb(0, 0, 0);"> 关键字修饰</font></strong><font style="color:rgb(0, 0, 0);">。</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello &quot;</span>);</span><br><span class="line"></span><br><span class="line">    s.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;rust&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;追加字符串 push_str() -&gt; &#123;&#125;&quot;</span>, s);</span><br><span class="line"></span><br><span class="line">    s.<span class="title function_ invoke__">push</span>(<span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;追加字符 push() -&gt; &#123;&#125;&quot;</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="插入-Insert"><a href="#插入-Insert" class="headerlink" title="插入(Insert)"></a>插入(Insert)</h5><p><font style="color:rgb(0, 0, 0);">字符串插入操作要</font><strong><font style="color:rgb(0, 0, 0);">修改原来的字符串</font></strong><font style="color:rgb(0, 0, 0);">，则该字符串必须是可变的，即</font><strong><font style="color:rgb(0, 0, 0);">字符串变量必须由 </font></strong><code>**mut**</code><strong><font style="color:rgb(0, 0, 0);"> 关键字修饰</font></strong><font style="color:rgb(0, 0, 0);">。</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello rust!&quot;</span>);</span><br><span class="line">    s.<span class="title function_ invoke__">insert</span>(<span class="number">5</span>, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;插入字符 insert() -&gt; &#123;&#125;&quot;</span>, s);</span><br><span class="line">    s.<span class="title function_ invoke__">insert_str</span>(<span class="number">6</span>, <span class="string">&quot; I like&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;插入字符串 insert_str() -&gt; &#123;&#125;&quot;</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="替换-Replace"><a href="#替换-Replace" class="headerlink" title="替换 (Replace)"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/string-slice.html#%E6%9B%BF%E6%8D%A2-replace"><font style="color:rgb(0, 0, 0);">替换 (Replace)</font></a></h5><p><font style="color:rgb(0, 0, 0);">该方法是返回一个新的字符串，而不是操作原来的字符串。</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string_replace</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;I like rust. Learning rust is my favorite!&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">new_string_replace</span> = string_replace.<span class="title function_ invoke__">replace</span>(<span class="string">&quot;rust&quot;</span>, <span class="string">&quot;RUST&quot;</span>);</span><br><span class="line">    dbg!(new_string_replace);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="replacen"><a href="#replacen" class="headerlink" title="replacen"></a><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">replacen</font></h5><p><font style="color:rgb(0, 0, 0);">前两个参数与 </font><code>replace()</code><font style="color:rgb(0, 0, 0);"> 方法一样，第三个参数则表示替换的个数。</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string_replace</span> = <span class="string">&quot;I like rust. Learning rust is my favorite!&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">new_string_replacen</span> = string_replace.<span class="title function_ invoke__">replacen</span>(<span class="string">&quot;rust&quot;</span>, <span class="string">&quot;RUST&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    dbg!(new_string_replacen);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="replace-range"><a href="#replace-range" class="headerlink" title="replace_range"></a>replace_range</h5><p>该方法是直接操作原来的字符串</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">string</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="comment">// 如果范围小于替换长度,字符串会变长,反之会变短</span></span><br><span class="line">    string.<span class="title function_ invoke__">replace_range</span>(<span class="number">0</span>..<span class="number">1</span>, <span class="string">&quot;H&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="删除-Delete"><a href="#删除-Delete" class="headerlink" title="删除 (Delete)"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/string-slice.html#%E5%88%A0%E9%99%A4-delete"><font style="color:rgb(0, 0, 0);">删除 (Delete)</font></a></h5><p><font style="color:rgb(0, 0, 0);">与字符串删除相关的方法有 4 个，它们分别是 </font><code>pop()</code><font style="color:rgb(0, 0, 0);">，</font><code>remove()</code><font style="color:rgb(0, 0, 0);">，</font><code>truncate()</code><font style="color:rgb(0, 0, 0);">，</font><code>clear()</code><font style="color:rgb(0, 0, 0);">。这四个方法仅适用于 </font><code>String</code>类型<br><code>pop</code><font style="color:rgb(0, 0, 0);"> —— 删除并返回字符串的最后一个字符</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">string_pop</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;rust pop 中文!&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p1</span> = string_pop.<span class="title function_ invoke__">pop</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p2</span> = string_pop.<span class="title function_ invoke__">pop</span>();</span><br><span class="line">    dbg!(p1);</span><br><span class="line">    dbg!(p2);</span><br><span class="line">    dbg!(string_pop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>remove</code><font style="color:rgb(0, 0, 0);"> —— 删除并返回字符串中指定位置的字符</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">string_remove</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;测试remove方法&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(</span><br><span class="line">        <span class="string">&quot;string_remove 占 &#123;&#125; 个字节&quot;</span>,</span><br><span class="line">        std::mem::<span class="title function_ invoke__">size_of_val</span>(string_remove.<span class="title function_ invoke__">as_str</span>())</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 删除第一个汉字</span></span><br><span class="line">    string_remove.<span class="title function_ invoke__">remove</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 下面代码会发生错误</span></span><br><span class="line">    <span class="comment">// string_remove.remove(1);</span></span><br><span class="line">    <span class="comment">// 直接删除第二个汉字</span></span><br><span class="line">    <span class="comment">// string_remove.remove(3);</span></span><br><span class="line">    dbg!(string_remove);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>truncate</code><font style="color:rgb(0, 0, 0);"> —— 删除字符串中从指定位置开始到结尾的全部字符</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">string_truncate</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;测试truncate&quot;</span>);</span><br><span class="line">    string_truncate.<span class="title function_ invoke__">truncate</span>(<span class="number">3</span>);</span><br><span class="line">    dbg!(string_truncate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>clear</code><font style="color:rgb(0, 0, 0);"> —— 清空字符串</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">string_clear</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;string clear&quot;</span>);</span><br><span class="line">    string_clear.<span class="title function_ invoke__">clear</span>();</span><br><span class="line">    dbg!(string_clear);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="连接-Concatenate"><a href="#连接-Concatenate" class="headerlink" title="连接 (Concatenate)"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/string-slice.html#%E8%BF%9E%E6%8E%A5-concatenate"><font style="color:rgb(0, 0, 0);">连接 (Concatenate)</font></a></h5><h6 id="使用-或者-连接字符串"><a href="#使用-或者-连接字符串" class="headerlink" title="使用 + 或者 += 连接字符串"></a><font style="color:rgb(0, 0, 0);">使用 </font><code>+</code><font style="color:rgb(0, 0, 0);"> 或者 </font><code>+=</code><font style="color:rgb(0, 0, 0);"> 连接字符串</font></h6><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string_append</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello &quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string_rust</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;rust&quot;</span>);</span><br><span class="line">    <span class="comment">// &amp;string_rust会自动解引用为&amp;str</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = string_append + &amp;string_rust;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">result</span> = result + <span class="string">&quot;!&quot;</span>; <span class="comment">// `result + &quot;!&quot;` 中的 `result` 是不可变的</span></span><br><span class="line">    result += <span class="string">&quot;!!!&quot;</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;连接字符串 + -&gt; &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="let-result-string-append-string-rust"><a href="#let-result-string-append-string-rust" class="headerlink" title="let result &#x3D; string_append + &amp;string_rust;"></a>let result &#x3D; string_append + &amp;string_rust;</h6><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这2行代码等价</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">result</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello &quot;</span>) + &amp;<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;rust&quot;</span>);</span><br><span class="line"><span class="comment">// 这个 + 的行为其实是：</span></span><br><span class="line"><span class="type">String</span>::<span class="title function_ invoke__">add</span>(<span class="keyword">self</span>, rhs: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>string_append</code> 被 <strong>移动（move）</strong></li>
<li><code>&amp;string_rust</code> 会被自动解引用为 <code>&amp;str</code></li>
<li>结果是一个新的 <code>String</code>，赋值给 <code>result</code></li>
</ul>
<h6 id="let-mut-result-result-“-”"><a href="#let-mut-result-result-“-”" class="headerlink" title="let mut result &#x3D; result + “!”;"></a>let mut result &#x3D; result + “!”;</h6><ul>
<li>原来的 <code>result</code> 是不可变的</li>
<li>你用 <code>+ &quot;!&quot;</code> 创建了一个新的 <code>String</code></li>
<li>然后你把这个新的字符串用 <code>let mut result = ...</code><strong>重新声明为一个可变变量</strong></li>
</ul>
<p>❗ 这不是修改旧的 <code>result</code>，而是创建了新的变量（同名），并且是 <code>mut</code>。</p>
<h6 id="result-“-”"><a href="#result-“-”" class="headerlink" title="result +&#x3D; “!!!”;"></a>result +&#x3D; “!!!”;</h6><ul>
<li>这是对新的、可变的 <code>result</code> 做操作</li>
<li><code>+=</code> 实际上调用的是 <code>String::push_str()</code> 方法</li>
</ul>
<h6 id="String-add-self-rhs-str-String"><a href="#String-add-self-rhs-str-String" class="headerlink" title="String::add(self, rhs: &amp;str) -&gt; String"></a>String::add(self, rhs: &amp;str) -&gt; String</h6><ol>
<li>self 是 String（所有权），不是 &amp;String</li>
<li>rhs 是 &amp;str，也就是右边你用 &amp;string_rust 是 ✅ 没问题的</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello,&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s2</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;world!&quot;</span>);</span><br><span class="line">    <span class="comment">// 在下句中，s1的所有权被转移走了，因此后面不能再使用s1</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s3</span> = s1 + &amp;s2;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(s3,<span class="string">&quot;hello,world!&quot;</span>);</span><br><span class="line">    <span class="comment">// 下面的语句如果去掉注释，就会报错 ,s1的所有权已经转移到s3</span></span><br><span class="line">    <span class="comment">// println!(&quot;&#123;&#125;&quot;,s1);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="使用-format-连接字符串"><a href="#使用-format-连接字符串" class="headerlink" title="使用 format! 连接字符串"></a><font style="color:rgb(0, 0, 0);">使用 </font><code>format!</code><font style="color:rgb(0, 0, 0);"> 连接字符串</font></h6><p><code>format!</code><font style="color:rgb(0, 0, 0);"> 这种方式适用于 </font><code>String</code><font style="color:rgb(0, 0, 0);"> 和 </font><code>&amp;str</code><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">,所有权不会转移</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s1</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s2</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;rust&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125; &#123;&#125;!&quot;</span>, s1, s2);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="操作-UTF-8-字符串"><a href="#操作-UTF-8-字符串" class="headerlink" title="操作 UTF-8 字符串"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/string-slice.html#%E6%93%8D%E4%BD%9C-utf-8-%E5%AD%97%E7%AC%A6%E4%B8%B2"><font style="color:rgb(0, 0, 0);">操作 UTF-8 字符串</font></a></h4><h5 id="字符"><a href="#字符" class="headerlink" title="字符"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/string-slice.html#%E5%AD%97%E7%AC%A6"><font style="color:rgb(0, 0, 0);">字符</font></a></h5><p><font style="color:rgb(0, 0, 0);">如果你想要以 Unicode 字符的方式遍历字符串，最好的办法是使用 </font><code>chars</code><font style="color:rgb(0, 0, 0);"> 方法，例如：</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="variable">c</span> <span class="keyword">in</span> <span class="string">&quot;中国人&quot;</span>.<span class="title function_ invoke__">chars</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="字节"><a href="#字节" class="headerlink" title="字节"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/compound-type/string-slice.html#%E5%AD%97%E8%8A%82"><font style="color:rgb(0, 0, 0);">字节</font></a></h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="variable">b</span> <span class="keyword">in</span> <span class="string">&quot;中国人&quot;</span>.<span class="title function_ invoke__">bytes</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="utf8-slice"><a href="#utf8-slice" class="headerlink" title="utf8_slice"></a><a target="_blank" rel="noopener" href="https://practice-zh.course.rs/collections/string.html#utf8_slice"><font style="color:rgb(0, 0, 0);">utf8_slice</font></a></h5><p><font style="color:rgb(0, 0, 0);">可以使用 </font><a target="_blank" rel="noopener" href="https://docs.rs/utf8_slice/1.0.0/utf8_slice/fn.slice.html"><font style="color:rgb(32, 96, 159);">utf8_slice</font></a><font style="color:rgb(0, 0, 0);"> 来按照字符的自然索引方式对 UTF-8 字符串进行切片访问，与之前的切片方式相比，它索引的是字符，而之前的方式索引的是字节.</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> utf8_slice;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;The 🚀 goes to the 🌑!&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">rocket</span> = utf8_slice::<span class="title function_ invoke__">slice</span>(s, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">   <span class="comment">// Will equal &quot;🚀&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/25/%E5%AD%97%E7%AC%A6%E4%B8%B2/" data-id="cmcfzbttt0009ggqw334v70uy" data-title="字符串" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-数组切片" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/24/%E6%95%B0%E7%BB%84%E5%88%87%E7%89%87/" class="article-date">
  <time class="dt-published" datetime="2025-06-24T06:41:10.000Z" itemprop="datePublished">2025-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/24/%E6%95%B0%E7%BB%84%E5%88%87%E7%89%87/">数组切片</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><ul>
<li><font style="color:rgb(0, 0, 0);">长度固定</font></li>
<li><font style="color:rgb(0, 0, 0);">元素必须有相同的类型</font></li>
<li><font style="color:rgb(0, 0, 0);">依次线性排列</font></li>
</ul>
<p><font style="color:rgb(0, 0, 0);">这里说的数组是 Rust 的基本类型，是固定长度的，这点与其他编程语言不同，其它编程语言的数组往往是可变长度的，与 Rust 中的动态数组 </font><code>Vecto</code><font style="color:rgb(0, 0, 0);"> 类似</font></p>
<h4 id="创建数组"><a href="#创建数组" class="headerlink" title="创建数组"></a><font style="color:rgb(0, 0, 0);">创建数组</font></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="数组声明类型"><a href="#数组声明类型" class="headerlink" title="数组声明类型"></a><font style="color:rgb(0, 0, 0);">数组声明类型</font></h5><p><code>i32</code><font style="color:rgb(0, 0, 0);"> 是元素类型，分号后面的数字 </font><code>5</code><font style="color:rgb(0, 0, 0);"> 是数组长度</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">3</span>; <span class="number">5</span>];</span><br></pre></td></tr></table></figure>

<p><code>[3; 5]</code><font style="color:rgb(0, 0, 0);"> 和 </font><code>[类型; 长度]</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">3</span>; <span class="number">5</span>];</span><br></pre></td></tr></table></figure>

<h3 id="数组切片"><a href="#数组切片" class="headerlink" title="数组切片"></a>数组切片</h3><p><font style="color:rgb(0, 0, 0);">许你引用集合中的部分连续片段，而不是整个集合，对于数组也是，数组切片允许我们引用数组的一部分：</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span>: [<span class="type">i32</span>; <span class="number">5</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">slice</span>: &amp;[<span class="type">i32</span>] = &amp;a[<span class="number">1</span>..<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">assert_eq!</span>(slice, &amp;[<span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/24/%E6%95%B0%E7%BB%84%E5%88%87%E7%89%87/" data-id="cmcfzbttv000eggqwa5dwbzs8" data-title="数组切片" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-所有权和借用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/23/%E6%89%80%E6%9C%89%E6%9D%83%E5%92%8C%E5%80%9F%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2025-06-23T07:23:00.000Z" itemprop="datePublished">2025-06-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/23/%E6%89%80%E6%9C%89%E6%9D%83%E5%92%8C%E5%80%9F%E7%94%A8/">所有权和借用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="所有权"><a href="#所有权" class="headerlink" title="所有权"></a>所有权</h3><h4 id="所有权的原则"><a href="#所有权的原则" class="headerlink" title="所有权的原则"></a>所有权的原则</h4><ol>
<li><font style="color:rgb(0, 0, 0);">Rust 中每一个值都被一个变量所拥有，该变量被称为值的所有者</font></li>
<li><font style="color:rgb(0, 0, 0);">一个值同时只能被一个变量所拥有，或者说一个值只能拥有一个所有者</font></li>
<li><font style="color:rgb(0, 0, 0);">当所有者（变量）离开作用域范围时，这个值将被丢弃(drop)</font></li>
</ol>
<h4 id="转移所有权"><a href="#转移所有权" class="headerlink" title="转移所有权"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/ownership/ownership.html#%E8%BD%AC%E7%A7%BB%E6%89%80%E6%9C%89%E6%9D%83"><font style="color:rgb(0, 0, 0);">转移所有权</font></a></h4><p>该段代码是通过<font style="color:#DF2A3F;">自动拷贝</font>的方式来赋值,都被存在栈中,不需要堆上分配内存;因此不需要所有权转移</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">y</span> = x;</span><br></pre></td></tr></table></figure>

<h4 id="String"><a href="#String" class="headerlink" title="String"></a>String</h4><blockquote>
<p>回忆:当初接触 Java 的时候也觉得 String 好难,数不清的 api 要熟悉</p>
</blockquote>
<p><font style="color:rgb(0, 0, 0);"><code>String</code> 类型是一个复杂类型，由存储在栈中的</font><strong><font style="color:rgb(0, 0, 0);">堆指针</font></strong><font style="color:rgb(0, 0, 0);">、</font><strong><font style="color:rgb(0, 0, 0);">字符串长度</font></strong><font style="color:rgb(0, 0, 0);">、</font><strong><font style="color:rgb(0, 0, 0);">字符串容量</font></strong><font style="color:rgb(0, 0, 0);">共同组成，其中</font><strong><font style="color:rgb(0, 0, 0);">堆指针</font></strong><font style="color:rgb(0, 0, 0);">是最重要的，它指向了真实存储字符串内容的堆内存，至于长度和容量;：容量是堆内存分配空间的大小，长度是目前已经使用的大小</font></p>
<h5 id="String-是堆分配的拥有所有权的类型"><a href="#String-是堆分配的拥有所有权的类型" class="headerlink" title="String 是堆分配的拥有所有权的类型"></a>String 是堆分配的拥有所有权的类型</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s2</span> = s1;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;, world!&quot;</span>, s1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解释：</p>
<ul>
<li>String::from(“hello”) 创建了一个堆分配的字符串，s1 是它的所有者。</li>
<li>s2 &#x3D; s1; 是<strong>所有权的转移（move）</strong>，s1 被“搬走”，不再有效。</li>
<li>所以再使用 s1 会报错，因为 Rust 不允许使用已经失效的所有权变量。</li>
</ul>
<h5 id="str-是不可变引用（指向静态内存）"><a href="#str-是不可变引用（指向静态内存）" class="headerlink" title="&amp;str 是不可变引用（指向静态内存）"></a>&amp;str 是不可变引用（指向静态内存）</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span>: &amp;<span class="type">str</span> = <span class="string">&quot;hello, world&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = x;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;,&#123;&#125;&quot;</span>,x,y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解释：</p>
<ul>
<li>“hello, world” 是一个 字符串字面量，类型是 &amp;’static str，保存在 只读内存区域。</li>
<li>x 是这个字符串的不可变引用。</li>
<li>y &#x3D; x 只是复制了引用（指针地址），没有所有权的转移。</li>
<li>所以 x 和 y 都可以继续使用。</li>
</ul>
<p>&amp;’static str</p>
<ul>
<li>指向一段只读 UTF-8 字符串的不可变引用</li>
<li>这段内存由编译器在程序编译时分配，永远不会释放</li>
<li>所以你不需要也不能管理它的生命周期</li>
</ul>
<h6 id="为什么-str-不会转移所有权"><a href="#为什么-str-不会转移所有权" class="headerlink" title="** 为什么 &amp;str 不会转移所有权 **"></a>** 为什么 <code>&amp;str</code> 不会转移所有权 **</h6><p>因为它只是一个“只读指针”，不拥有真正的内存块。</p>
<ul>
<li>所有权概念只适用于拥有堆内存的数据，如 <code>String</code>、<code>Vec</code>。</li>
<li><code>&amp;str</code> 只是“看一下”而已，Rust 编译器不认为你把东西“搬走”了，所以不会触发 <code>move</code>。</li>
</ul>
<h5 id="String-vs-str"><a href="#String-vs-str" class="headerlink" title="String vs &amp;str"></a>String vs &amp;str</h5><table>
<thead>
<tr>
<th>表达式</th>
<th>类型</th>
<th>存储位置</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>&quot;hello, world&quot;</code></td>
<td><code>&amp;&#39;static str</code></td>
<td>编译期静态内存</td>
<td><code>&amp;str</code> 是借用的字符串切片（引用），而不是拥有内存的字符串</td>
</tr>
<tr>
<td><code>String::from(&quot;hello&quot;)</code></td>
<td><code>String</code></td>
<td>堆（heap）</td>
<td>是一个 拥有所有权的动态字符串对象</td>
</tr>
</tbody></table>
<ul>
<li>String 就像一个拥有自己“内存”的包裹（盒子），里面装的是字符数组。</li>
<li>&amp;str 就像是从这个包裹里“拆出”一块标签，指向这段字符数据。</li>
<li>你不能直接用一个包裹当作标签，得“打开”它，拿出标签（即 &amp;string）。</li>
</ul>
<h6 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h6><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s_slice</span>: &amp;<span class="type">str</span> = &amp;s;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>s</code> 拥有堆上的字符串 <code>&quot;hello&quot;</code></li>
<li><code>s_slice</code> 只是“借用”了 <code>s</code> 的一部分或者全部</li>
<li>不会发生所有权转移</li>
<li><code>s</code> 和 <code>s_slice</code> 可以同时使用（因为 <code>&amp;str</code> 是不可变引用）</li>
</ul>
<h5 id="克隆-深拷贝"><a href="#克隆-深拷贝" class="headerlink" title="克隆(深拷贝)"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/ownership/ownership.html#%E5%85%8B%E9%9A%86%E6%B7%B1%E6%8B%B7%E8%B4%9D"><font style="color:rgb(0, 0, 0);">克隆(深拷贝)</font></a></h5><p><font style="color:rgb(0, 0, 0);">Rust 永远也不会自动创建数据的 “深拷贝”任何</font><strong><font style="color:rgb(0, 0, 0);">自动</font></strong><font style="color:rgb(0, 0, 0);">的复制都不是深拷贝，可以被认为对运行时性能影响较小。</font></p>
<p><font style="color:rgb(0, 0, 0);">深拷贝使用<code>clone</code></font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span> = s1.<span class="title function_ invoke__">clone</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;s1 = &#123;&#125;, s2 = &#123;&#125;&quot;</span>, s1, s2);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="拷贝-浅拷贝-浅拷贝"><a href="#拷贝-浅拷贝-浅拷贝" class="headerlink" title="拷贝(浅拷贝)浅拷贝"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/ownership/ownership.html#%E6%8B%B7%E8%B4%9D%E6%B5%85%E6%8B%B7%E8%B4%9D"><font style="color:rgb(0, 0, 0);">拷贝(浅拷贝)</font></a><font style="color:rgb(0, 0, 0);">浅拷贝</font></h5><p><font style="color:rgb(0, 0, 0);">只发生在栈上，因此性能很高，在日常编程中，浅拷贝无处不在;</font><font style="color:rgb(0, 0, 0);">叫做 <code>copy</code> 的特征</font></p>
<p><font style="color:rgb(0, 0, 0);">任何基本类型的组合可以</font><code>copy</code>不需要分配内存或某种形式资源的类型是可以 <code>copy</code> 的</p>
<p><font style="color:rgb(0, 0, 0);">不可变引用 </font><code>&amp;T</code><font style="color:rgb(0, 0, 0);">可变引用 </font><code>&amp;mut T</code><font style="color:rgb(0, 0, 0);"> 是不可以 Copy 的</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">y</span> = x;</span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;x = &#123;&#125;, y = &#123;&#125;&quot;</span>, x, y);</span><br></pre></td></tr></table></figure>

<h5 id="函数传值与返回"><a href="#函数传值与返回" class="headerlink" title="函数传值与返回"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/ownership/ownership.html#%E5%87%BD%E6%95%B0%E4%BC%A0%E5%80%BC%E4%B8%8E%E8%BF%94%E5%9B%9E"><font style="color:rgb(0, 0, 0);">函数传值与返回</font></a></h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">a</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">b</span> = <span class="number">123</span>;</span><br><span class="line">  <span class="title function_ invoke__">str</span>(a);</span><br><span class="line">  <span class="title function_ invoke__">copy</span>(b);</span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, a); <span class="comment">// 这行会报错出a离开str作用域就会drop</span></span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">str</span>(some_string: <span class="type">String</span>)&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, some_string)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">copy</span>(some_integer: <span class="type">i32</span>)&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, some_integer)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="as-bytes-和-into-bytes"><a href="#as-bytes-和-into-bytes" class="headerlink" title="as_bytes 和 into_bytes"></a>as_bytes 和 into_bytes</h5><p>into_bytes</p>
<ul>
<li>返回值类型是：<code>Vec&lt;u8&gt;</code> → 一个新的字节数组，拥有堆内存</li>
<li>转移了 <code>String</code> 的所有权，<code>s</code> 不再可用</li>
<li>创建新对象并返回，可随意修改</li>
</ul>
<p>as_bytes()</p>
<ul>
<li>返回值类型是：<code>&amp;[u8]</code> → 字节切片的引用</li>
<li>是对 <code>String</code> 中底层数据的 不可变借用</li>
<li>不创建新数据、不移动内存</li>
<li>快速、安全</li>
<li>不能修改返回的字节数组</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="comment">// as_bytes 不转移所有权</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = s.<span class="title function_ invoke__">as_bytes</span>();         <span class="comment">// a: &amp;[u8]</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, a);          <span class="comment">// 输出: [104, 101, 108, 108, 111]</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s);            <span class="comment">// ✅ s 还能用</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// into_bytes 会转移所有权</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = s.<span class="title function_ invoke__">into_bytes</span>();       <span class="comment">// b: Vec&lt;u8&gt;</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, b);          <span class="comment">// 输出: [104, 101, 108, 108, 111]</span></span><br><span class="line">    <span class="comment">// println!(&quot;&#123;&#125;&quot;, s);         // ❌ 编译错误：s 已被 move</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>方法</th>
<th>返回类型</th>
<th>是否消耗 <code>String</code> 所有权</th>
<th>是否分配新内存</th>
<th>是否可修改</th>
</tr>
</thead>
<tbody><tr>
<td><code>as_bytes()</code></td>
<td><code>&amp;[u8]</code>（字节切片引用）</td>
<td>❌ 否（只是借用）</td>
<td>❌ 否</td>
<td>❌ 不可修改</td>
</tr>
<tr>
<td><code>into_bytes()</code></td>
<td><code>Vec&lt;u8&gt;</code>（堆分配的字节数组）</td>
<td>✅ 是（移动所有权）</td>
<td>✅ 是</td>
<td>✅ 可修改</td>
</tr>
</tbody></table>
<p>只看不动用 <code>as_bytes()</code>，要改要带走用 <code>into_bytes()</code></p>
<h5 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">t</span> = (<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>), <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;world&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fill the blanks</span></span><br><span class="line">    <span class="keyword">let</span> (<span class="keyword">ref</span> s1, <span class="keyword">ref</span> s2) = t;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;, &#123;:?&#125;, &#123;:?&#125;&quot;</span>, s1, s2, t); <span class="comment">// -&gt; &quot;hello&quot;, &quot;world&quot;, (&quot;hello&quot;, &quot;world&quot;)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> (<span class="keyword">ref</span> s1, <span class="keyword">ref</span> s2) = t</span><br></pre></td></tr></table></figure>

<p>这行代码的意思是我不要把 <code>t</code> 拆开并移动（move）里面的两个 <code>String</code>，而是想用引用的方式借用它们，让 <code>s1</code> 和 <code>s2</code> 是两个 <code>&amp;String</code> 类型的引用。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">t ----------<span class="punctuation">-&gt;</span> (<span class="title function_ invoke__">String</span>(<span class="string">&quot;hello&quot;</span>), <span class="title function_ invoke__">String</span>(<span class="string">&quot;world&quot;</span>))</span><br><span class="line">                |              |</span><br><span class="line">               <span class="keyword">ref</span>            <span class="keyword">ref</span></span><br><span class="line">                |              |</span><br><span class="line">              s1: &amp;<span class="type">String</span>    s2: &amp;<span class="type">String</span></span><br></pre></td></tr></table></figure>

<h5 id="Box-和解引用操作"><a href="#Box-和解引用操作" class="headerlink" title="Box 和解引用操作 *"></a>Box<T> 和解引用操作 *</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">y</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="number">3</span>);   <span class="comment">// 关键：可变绑定！</span></span><br><span class="line"></span><br><span class="line">    *y = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(*x, <span class="number">5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Box-new-5-是什么意思？"><a href="#Box-new-5-是什么意思？" class="headerlink" title="Box::new(5) 是什么意思？"></a>Box::new(5) 是什么意思？</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let x = Box::new(5);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Box&lt;T&gt;</code> 是 Rust 提供的 <strong>堆分配智能指针</strong></li>
<li><code>Box::new(5)</code> 把值 <code>5</code> 放入堆内存，并返回一个指向它的 <code>Box&lt;i32&gt;</code></li>
<li><code>x</code> 现在持有这块堆内存的所有权</li>
<li>内存布局如下：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">栈：x ---------------&gt; 堆：[5]</span><br></pre></td></tr></table></figure>

<h6 id="✅-let-mut-y-Box-new-3-这句为什么加-mut？"><a href="#✅-let-mut-y-Box-new-3-这句为什么加-mut？" class="headerlink" title="✅ let mut y = Box::new(3); 这句为什么加 mut？"></a>✅ <code>let mut y = Box::new(3);</code> 这句为什么加 <code>mut</code>？</h6><ul>
<li><code>Box&lt;T&gt;</code> 本身是一个不可变指针（默认）</li>
<li>如果你想修改 <strong>它指向的值</strong>，就必须先让变量 <code>y</code> 是 <code>mut</code> 的</li>
<li>否则下面的 <code>*y = 4;</code> 会报错！</li>
</ul>
<h6 id="✅-y-4-是什么意思？"><a href="#✅-y-4-是什么意思？" class="headerlink" title="✅ *y = 4; 是什么意思？"></a>✅ <code>*y = 4;</code> 是什么意思？</h6><ul>
<li>这是<strong>解引用操作符</strong>，表示“访问 Box 指向的值”</li>
<li>类似于 C&#x2F;C++ 里的 <code>*ptr = 4;</code>：把指针指向的内容改成 4</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let mut y = Box::new(3); // y 指向堆中值 3</span><br><span class="line">*y = 4;                  // 把堆中的值改成 4</span><br></pre></td></tr></table></figure>

<p>执行后：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">栈：y ---------------&gt; 堆：[4]</span><br></pre></td></tr></table></figure>

<h6 id="✅-assert-eq-x-5-是什么意思？"><a href="#✅-assert-eq-x-5-是什么意思？" class="headerlink" title="✅ assert_eq!(*x, 5); 是什么意思？"></a>✅ <code>assert_eq!(*x, 5);</code> 是什么意思？</h6><ul>
<li><code>*x</code> 是解引用 <code>x</code>，拿到 <code>Box</code> 指向的值</li>
<li><code>assert_eq!</code> 用来做测试断言，验证值是否等于预期</li>
<li>本句断言：x 指向的值是 5 → ✅ 成立</li>
</ul>
<h6 id="🧠-总结"><a href="#🧠-总结" class="headerlink" title="🧠 总结"></a>🧠 总结</h6><table>
<thead>
<tr>
<th>表达式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Box::new(5)</code></td>
<td>把 5 放进堆里，并返回一个指向它的智能指针</td>
</tr>
<tr>
<td><code>let mut y</code></td>
<td>让 y 可变，这样才能通过 y 修改堆中的数据</td>
</tr>
<tr>
<td><code>*y = 4</code></td>
<td>解引用 y，修改它指向的堆内存里的值</td>
</tr>
<tr>
<td><code>*x</code></td>
<td>解引用 x，获取它指向的值</td>
</tr>
</tbody></table>
<h6 id="🧾-类比理解（Box-就像盒子）："><a href="#🧾-类比理解（Box-就像盒子）：" class="headerlink" title="🧾 类比理解（Box 就像盒子）："></a>🧾 类比理解（Box 就像盒子）：</h6><ul>
<li><code>Box::new(5)</code>：把 5 装进一个“盒子”（堆）</li>
<li><code>*x</code>：打开盒子，看到里面是 5</li>
<li><code>*y = 4</code>：打开盒子，把 3 换成 4</li>
</ul>
<h3 id="引用与借用"><a href="#引用与借用" class="headerlink" title="引用与借用"></a>引用与借用</h3><p><font style="color:rgb(0, 0, 0);">Rust 能否像其它编程语言一样，使用某个变量的指针或者引用呢？答案是可以</font><font style="color:rgb(0, 0, 0);">。</font><font style="color:rgb(0, 0, 0);">Rust 通过 </font><code>借用(Borrowing)</code><font style="color:rgb(0, 0, 0);"> 这个概念来达成上述的目的，</font><strong><font style="color:rgb(0, 0, 0);">获取变量的引用，称之为借用(borrowing)</font></strong><font style="color:rgb(0, 0, 0);">。正如现实生活中，如果一个人拥有某样东西，你可以从他那里借来，当使用完毕后，也必须要物归原主。</font></p>
<h4 id="引用与解引用"><a href="#引用与解引用" class="headerlink" title="引用与解引用"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/ownership/borrowing.html#%E5%BC%95%E7%94%A8%E4%B8%8E%E8%A7%A3%E5%BC%95%E7%94%A8"><font style="color:rgb(0, 0, 0);">引用与解引用</font></a></h4><p><font style="color:rgb(0, 0, 0);">常规引用是一个指针类型，指向了对象存储的内存地址。在下面代码中，我们创建一个 </font><code>i32</code><font style="color:rgb(0, 0, 0);"> 值的引用 <code>y</code>，然后使用解引用运算符来解出 </font><code>y</code><font style="color:rgb(0, 0, 0);"> 所使用的值:</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = &amp;x;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, x);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, *y);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(y, <span class="number">5</span>);     <span class="comment">// ❌ 错误：y 是 &amp;i32，5 是 i32</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>变量 <code>x</code> 是一个整数，值为 5，<code>y</code> 是对 <code>x</code> 的引用。<br>要获取 <code>y</code> 指向的值，需要用 <code>*y</code> 解引用，这样才能和 5 比较。</li>
<li><strong>Rust 不允许你直接把引用（比如 <strong><code>**&amp;x**</code></strong>）和整数（比如 <strong><code>**5**</code></strong>）进行比较</strong>，因为它们是<strong>不同的类型</strong>。</li>
</ol>
<h4 id="不可变引用"><a href="#不可变引用" class="headerlink" title="不可变引用"></a>不可变引用</h4><p><font style="color:rgb(31,35,40);">通过不可变引用，可以读取数据，但不能修 改数据。一个变量可以有多个不可变引用，但不能与可变引用共存</font></p>
<p><code>&amp;s1</code><font style="color:rgb(0, 0, 0);"> 语法，我们创建了一个</font><strong><font style="color:rgb(0, 0, 0);">指向 </font></strong><code>s1</code><strong><font style="color:rgb(0, 0, 0);"> 的引用</font></strong><font style="color:rgb(0, 0, 0);">，但是并不拥有它,引用指向的值默认也是不可变的,不能对其进行修改</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">calculate_length</span>(&amp;s1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 会报错</span></span><br><span class="line"><span class="comment">//^ `s1` is a `&amp;` reference, so the data it refers to cannot be borrowed as mutable</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">calculate_length</span>(s1: &amp;<span class="type">String</span>) &#123;</span><br><span class="line">    s1.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;string&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="可变引用"><a href="#可变引用" class="headerlink" title="可变引用"></a>可变引用</h4><p><font style="color:rgb(31,35,40);">通过可变引用，可以读取和修改数据。一个变量 在某一时刻只能有一个可变引用，且不能与不可变引用共存</font></p>
<p><code>str</code><font style="color:rgb(0, 0, 0);"> 是可变类型，其次创建一个可变的引用 </font><code>&amp;mut str</code><font style="color:rgb(0, 0, 0);"> 和接受可变引用参数 </font><code>&quot;&gt;s: &amp;mut String</code><font style="color:rgb(0, 0, 0);"> 的函数</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">str</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">calculate_length</span>(&amp;<span class="keyword">mut</span> <span class="type">str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">calculate_length</span>(s: &amp;<span class="keyword">mut</span> <span class="type">String</span>) &#123;</span><br><span class="line">    s.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;string&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="同一作用域，特定数据只能有一个可变引用"><a href="#同一作用域，特定数据只能有一个可变引用" class="headerlink" title=" 同一作用域，特定数据只能有一个可变引用"></a><font style="color:rgb(0, 0, 0);"> 同一作用域，特定数据只能有一个可变引用</font></h5><p>错误原因:你还没用完 <code>a</code>，又创建了 <code>b</code>，Rust 不知道你会不会两个同时修改 <code>x</code>，所以直接报错。</p>
<p>就像你家的一把钥匙给了哥哥还没收回来，你又给了妹妹一把 这容易出问题</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">x</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = &amp;<span class="keyword">mut</span> x;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = &amp;<span class="keyword">mut</span> x;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, a);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Rust 是聪明的，它看到你在 <code>println!(&quot;&#123;&#125;&quot;, a);</code> 之后就<strong>不再使用 <strong><code>**a**</code></strong> 了</strong>，所以就允许你创建 <code>b</code>。</p>
<p>你可以理解为：我收回了哥哥手里的钥匙（<code>a</code> 用完了），才把钥匙给了妹妹（<code>b</code>），所以是安全的。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">x</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = &amp;<span class="keyword">mut</span> x;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = &amp;<span class="keyword">mut</span> x;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Rust 规定：<strong>同一时间只能有一个人动这个东西（可变引用只能有一个）</strong>，除非前一个已经不用了。</p>
<p>下面代码会报错</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">x</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = &amp;<span class="keyword">mut</span> x;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, a);  <span class="comment">// 第一次使用 a ✅</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = &amp;<span class="keyword">mut</span> x;      <span class="comment">// ❌ a 还没“死”，不能创建 b</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, b);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, a);   <span class="comment">// 第二次使用 a（让它保持“活着”）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 Rust 中，变量的“活跃范围”（也叫“活跃生命周期”）不是你创建它的地方决定的，而是你“最后一次使用它”的位置决定的。</p>
<p>解释</p>
<ol>
<li>Rust 不会因为你用了一次变量就认为它“用完了”。只要你后面还打算用它（比如打印它、传给函数等），Rust 就认为这个变量还“活着”。** **</li>
</ol>
<h5 id="可变引用与不可变引用不能同时存在"><a href="#可变引用与不可变引用不能同时存在" class="headerlink" title="可变引用与不可变引用不能同时存在"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/ownership/borrowing.html#%E5%8F%AF%E5%8F%98%E5%BC%95%E7%94%A8%E4%B8%8E%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%BC%95%E7%94%A8%E4%B8%8D%E8%83%BD%E5%90%8C%E6%97%B6%E5%AD%98%E5%9C%A8"><font style="color:rgb(0, 0, 0);">可变引用与不可变引用不能同时存在</font></a></h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">r1</span> = &amp;s; <span class="comment">// 没问题</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">r2</span> = &amp;s; <span class="comment">// 没问题</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">r3</span> = &amp;<span class="keyword">mut</span> s; <span class="comment">// 大问题</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;, &#123;&#125;, and &#123;&#125;&quot;</span>, r1, r2, r3);</span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0, 0, 0);background-color:rgb(241, 246, 249);">注意，引用 </font><code>r1</code>,<code>r2</code>,<code>r3</code><font style="color:rgb(0, 0, 0);background-color:rgb(241, 246, 249);"> 的作用域从创建开始，一直持续到它最后一次使用的地方 </font><code>println!(....)</code><font style="color:rgb(0, 0, 0);background-color:rgb(241, 246, 249);">，这个跟变量的作用域有所不同，变量的作用域从创建持续到某一个花括号 </font></p>
<h5 id="悬垂引用"><a href="#悬垂引用" class="headerlink" title="悬垂引用"></a><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">悬垂引用</font></h5><p>悬垂引用就是：你引用了一个已经被释放掉的东西，这时候引用还在，但指向的内存已经没了，结果就变成“悬空”的，危险！</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">reference_to_nothing</span> = <span class="title function_ invoke__">dangle</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">dangle</span>() <span class="punctuation">-&gt;</span> &amp;<span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &amp;s</span><br><span class="line">&#125; <span class="comment">// s在这里会被drop</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>概念</th>
<th>生命周期由谁决定？</th>
</tr>
</thead>
<tbody><tr>
<td>普通变量（如 <code>s</code>）</td>
<td>所在代码块 <code>&#123;&#125;</code> 的作用域</td>
</tr>
<tr>
<td>引用（如 <code>&amp;s</code>）</td>
<td>从创建引用那一刻，到最后一次使用为止</td>
</tr>
</tbody></table>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li><font style="color:rgb(0, 0, 0);">同一时刻，你只能拥有要么一个可变引用，要么任意多个不可变引用</font></li>
<li><font style="color:rgb(0, 0, 0);">引用必须总是有效的</font></li>
</ul>
<h3 id="ref-和-区别"><a href="#ref-和-区别" class="headerlink" title="ref 和&amp;区别"></a>ref 和&amp;区别</h3><table>
<thead>
<tr>
<th>用法</th>
<th>出现在</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>&amp;</code></td>
<td><strong>右侧表达式</strong></td>
<td>显式创建一个引用（borrow）</td>
</tr>
<tr>
<td><code>ref</code></td>
<td><strong>模式匹配中</strong></td>
<td>在解构时生成引用变量</td>
</tr>
</tbody></table>
<h4 id="是“借用”运算符"><a href="#是“借用”运算符" class="headerlink" title="&amp; 是“借用”运算符"></a><code>&amp;</code> 是“借用”运算符</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">y</span> = &amp;x;  <span class="comment">// y 是 &amp;i32</span></span><br></pre></td></tr></table></figure>

<p>等价于：</p>
<p>“把 <code>x</code> 借给 <code>y</code>，<code>y</code> 拥有对 <code>x</code> 的只读访问权限。”</p>
<h4 id="ref-是“绑定为引用”（左侧用）"><a href="#ref-是“绑定为引用”（左侧用）" class="headerlink" title="ref 是“绑定为引用”（左侧用）"></a><code>ref</code> 是“绑定为引用”（左侧用）</h4><p>在<strong>模式匹配</strong>时，Rust 默认是移动（move）值。如果你想绑定变量为“引用”，就需要加 <code>ref</code>。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">ref</span> y = x;  <span class="comment">// y 是 &amp;String，不发生所有权移动</span></span><br></pre></td></tr></table></figure>

<p>等价于:</p>
<p>let y &#x3D; &x;</p>
<h5 id="更常见的：结构解构时使用-ref"><a href="#更常见的：结构解构时使用-ref" class="headerlink" title="更常见的：结构解构时使用 ref"></a>更常见的：结构解构时使用 <code>ref</code></h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">tup</span> = (<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hi&quot;</span>), <span class="number">42</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拆解并借用里面的值（否则会 move）</span></span><br><span class="line"><span class="keyword">let</span> (<span class="keyword">ref</span> a, <span class="keyword">ref</span> b) = tup;</span><br><span class="line"></span><br><span class="line"><span class="comment">// a 是 &amp;String，b 是 &amp;i32</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 &amp;：右侧表达式中创建引用</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = &amp;s;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;a: &#123;&#125;&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 ref：在模式匹配中创建引用</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ref</span> b = s;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b: &#123;&#125;&quot;</span>, b);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解构元组时使用 ref</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">pair</span> = (<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hi&quot;</span>), <span class="number">123</span>);</span><br><span class="line">    <span class="keyword">let</span> (<span class="keyword">ref</span> x, <span class="keyword">ref</span> y) = pair;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;x: &#123;&#125;, y: &#123;&#125;&quot;</span>, x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><ul>
<li>用 <code>&amp;</code> 是 “我要借用”</li>
<li>用 <code>ref</code> 是 “匹配时绑定为引用”</li>
<li>用 <code>ref mut</code> 是 “匹配时绑定为<strong>可变引用</strong>”</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/23/%E6%89%80%E6%9C%89%E6%9D%83%E5%92%8C%E5%80%9F%E7%94%A8/" data-id="cmcfzbttu000bggqw5ejnbvzi" data-title="所有权和借用" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-基础类型" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/22/%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B/" class="article-date">
  <time class="dt-published" datetime="2025-06-22T04:40:14.000Z" itemprop="datePublished">2025-06-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/22/%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B/">基础类型</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="基本类型"><a href="#基本类型" class="headerlink" title="基本类型"></a>基本类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>默认类型</th>
</tr>
</thead>
<tbody><tr>
<td>整数</td>
<td><code>i32</code> ✅</td>
</tr>
<tr>
<td>浮点</td>
<td><code>f64</code> ✅</td>
</tr>
</tbody></table>
<h4 id="数值类型"><a href="#数值类型" class="headerlink" title="数值类型"></a>数值类型</h4><ul>
<li><font style="color:rgb(0, 0, 0);">数值类型：</font><ul>
<li><font style="color:rgb(0, 0, 0);">有符号整数 (</font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">i8</font><font style="color:rgb(0, 0, 0);">, </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">i16</font><font style="color:rgb(0, 0, 0);">, </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">i32</font><font style="color:rgb(0, 0, 0);">, </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">i64</font><font style="color:rgb(0, 0, 0);">, </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">isize</font><font style="color:rgb(0, 0, 0);">)</font></li>
<li><font style="color:rgb(0, 0, 0);"> 无符号整数 (</font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">u8</font><font style="color:rgb(0, 0, 0);">, </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">u16</font><font style="color:rgb(0, 0, 0);">, </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">u32</font><font style="color:rgb(0, 0, 0);">, </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">u64</font><font style="color:rgb(0, 0, 0);">, </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">usize</font><font style="color:rgb(0, 0, 0);">) 、浮点数 (</font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">f32</font><font style="color:rgb(0, 0, 0);">, </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">f64</font><font style="color:rgb(0, 0, 0);">)、以及有理数、复数</font></li>
</ul>
</li>
<li>有符号和无符号区别<ul>
<li><strong><font style="color:rgb(0, 0, 0);">有符号</font></strong><font style="color:rgb(0, 0, 0);">则表示数字可以取正数、负数还有 0</font></li>
<li><strong><font style="color:rgb(0, 0, 0);">无符号数</font></strong><font style="color:rgb(0, 0, 0);">表示数字只能取正数和 0</font></li>
</ul>
</li>
</ul>
<h5 id="浮点类型"><a href="#浮点类型" class="headerlink" title="浮点类型"></a>浮点类型</h5><p> 浮点数字面量默认就是 f64 类型  </p>
<h5 id="Rang"><a href="#Rang" class="headerlink" title="Rang"></a>Rang</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">   <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..=<span class="number">10</span>&#123;</span><br><span class="line">       <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,i);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="string">&#x27;a&#x27;</span>..=<span class="string">&#x27;z&#x27;</span>&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,i);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Complex"><a href="#Complex" class="headerlink" title="Complex"></a>Complex</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Complex</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> re: T,  <span class="comment">// 实部</span></span><br><span class="line">    <span class="keyword">pub</span> im: T,  <span class="comment">// 虚部</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> num::complex::Complex; <span class="comment">// 引入 num crate 中的 Complex 复数类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = Complex &#123; re: <span class="number">2.1</span>, im: -<span class="number">1.2</span> &#125;; <span class="comment">// 创建复数 a = 2.1 - 1.2i</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = Complex::<span class="title function_ invoke__">new</span>(<span class="number">11.1</span>, <span class="number">22.2</span>);      <span class="comment">// 创建复数 b = 11.1 + 22.2i</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = a + b;                   <span class="comment">// 复数相加：实部 + 实部，虚部 + 虚部</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; + &#123;&#125;i&quot;</span>, result.re, result.im); <span class="comment">// 打印结果复数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="怎么计算"><a href="#怎么计算" class="headerlink" title="怎么计算"></a>怎么计算</h6><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">2.1</span> - <span class="number">1.2</span>i</span><br><span class="line">b = <span class="number">11.1</span> + <span class="number">22.2</span>i</span><br><span class="line">result = (<span class="number">2.1</span> + <span class="number">11.1</span>) + (-<span class="number">1.2</span> + <span class="number">22.2</span>)i = <span class="number">13.2</span> + <span class="number">21.0</span>i</span><br></pre></td></tr></table></figure>

<h6 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h6><table>
<thead>
<tr>
<th>表达式</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>Complex &#123; re: a, im: b &#125;</code></td>
<td>创建复数 <code>a + bi</code></td>
</tr>
<tr>
<td><code>Complex::new(a, b)</code></td>
<td>同上，更常用</td>
</tr>
<tr>
<td><code>a + b</code></td>
<td>复数相加</td>
</tr>
<tr>
<td><code>result.re</code></td>
<td>实部</td>
</tr>
<tr>
<td><code>result.im</code></td>
<td>虚部</td>
</tr>
</tbody></table>
<h4 id="字符、布尔、单元类型"><a href="#字符、布尔、单元类型" class="headerlink" title="字符、布尔、单元类型"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/base-type/char-bool.html#%E5%AD%97%E7%AC%A6%E5%B8%83%E5%B0%94%E5%8D%95%E5%85%83%E7%B1%BB%E5%9E%8B"><font style="color:rgb(0, 0, 0);">字符、布尔、单元类型</font></a></h4><h5 id="字符类型-char"><a href="#字符类型-char" class="headerlink" title="字符类型(char)"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/base-type/char-bool.html#%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8Bchar"><font style="color:rgb(0, 0, 0);">字符类型(char)</font></a></h5><p><font style="color:rgb(0, 0, 0);background-color:rgb(241, 246, 249);">Rust 的字符只能用 </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">‘’</font><font style="color:rgb(0, 0, 0);background-color:rgb(241, 246, 249);"> 来表示,占用4个字节， </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">“”</font><font style="color:rgb(0, 0, 0);background-color:rgb(241, 246, 249);"> 是留给字符串的。</font></p>
<h5 id="Nan"><a href="#Nan" class="headerlink" title="Nan"></a><font style="color:rgb(0, 0, 0);background-color:rgb(241, 246, 249);">Nan</font></h5><p><code>**NaN**</code><strong>（Not a Number）</strong> 是一种特殊的浮点数值，表示<strong>某个运算结果不是一个合法的数字</strong>。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = (-<span class="number">1.1f64</span>).<span class="title function_ invoke__">sqrt</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, v);</span><br><span class="line">    <span class="keyword">if</span> v.<span class="title function_ invoke__">is_nan</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;sqrt(-1.1) is NaN&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>特性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>类型</td>
<td>只出现在 <code>f32</code> 和 <code>f64</code> 中</td>
</tr>
<tr>
<td>含义</td>
<td>表示 “不是数字” 的特殊浮点值</td>
</tr>
<tr>
<td>出现场景</td>
<td>0&#x2F;0、负数开方、无效浮点运算</td>
</tr>
<tr>
<td>判断方法</td>
<td><code>x.is_nan()</code></td>
</tr>
<tr>
<td>对比行为</td>
<td><code>NaN != NaN</code> 永远为 <code>true</code>（即它不等于任何东西）</td>
</tr>
</tbody></table>
<h5 id="布尔-bool"><a href="#布尔-bool" class="headerlink" title="布尔(bool)"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/base-type/char-bool.html#%E5%B8%83%E5%B0%94bool"><font style="color:rgb(0, 0, 0);">布尔(bool)</font></a></h5><p><font style="color:rgb(0, 0, 0);">Rust 中的布尔类型有两个可能的值：</font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">true</font><font style="color:rgb(0, 0, 0);"> 和 </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">false</font><font style="color:rgb(0, 0, 0);">，布尔值占用内存的大小为 </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">1</font><font style="color:rgb(0, 0, 0);"> 个字节</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">t</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span>: <span class="type">bool</span> = <span class="literal">false</span>; <span class="comment">// 使用类型标注,显式指定f的类型</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> f &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;这是段毫无意义的代码&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="单元类型-unit"><a href="#单元类型-unit" class="headerlink" title="单元类型(unit)"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/base-type/char-bool.html#%E5%8D%95%E5%85%83%E7%B1%BB%E5%9E%8Bunit"><font style="color:rgb(0, 0, 0);">单元类型(unit)</font></a></h5><p><font style="color:rgb(0, 0, 0);">单元类型就是 </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">()</font></p>
<ol>
<li><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">main</font><font style="color:rgb(0, 0, 0);"> 函数就返回这个单元类型 </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">()</font></li>
<li><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">println!()</font><font style="color:rgb(0, 0, 0);"> 的返回值也是单元类型 </font><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">()</font></li>
</ol>
<p><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);"></font></p>
<h4 id="序列"><a href="#序列" class="headerlink" title="序列"></a><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">序列</font></h4><h4 id="类型强转"><a href="#类型强转" class="headerlink" title="类型强转"></a>类型强转</h4><p> 类型强转（type casting）是<strong>把一种类型的数据强制转换为另一种类型</strong>，通常使用 <code>as</code> 关键字完成。  </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span>: <span class="type">u8</span> = <span class="number">255</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">y</span> = x <span class="keyword">as</span> <span class="type">u16</span>;   <span class="comment">// u8 -&gt; u16</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">z</span> = x <span class="keyword">as</span> <span class="type">i32</span>;   <span class="comment">// u8 -&gt; i32</span></span><br></pre></td></tr></table></figure>

<h4 id="语句与表达式"><a href="#语句与表达式" class="headerlink" title="语句与表达式"></a><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">语句与表达式</font></h4><p><font style="color:rgb(0, 0, 0);">Rust 的函数体是由一系列语句组成，最后由一个表达式来返回值，例如</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">add_with_extra</span>(x: <span class="type">i32</span>, y: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = x + <span class="number">1</span>; <span class="comment">// 语句</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = y + <span class="number">5</span>; <span class="comment">// 语句</span></span><br><span class="line">    x + y <span class="comment">// 表达式</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 由于 let 是语句，因此不能将 let 语句赋值给其它值，如下形式是错误的</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span> = (<span class="keyword">let</span> <span class="variable">a</span> = <span class="number">8</span>);</span><br></pre></td></tr></table></figure>

<p><strong><font style="color:rgb(0, 0, 0);">表达式不能包含分号</font></strong><font style="color:rgb(0, 0, 0);">。这一点非常重要，一旦你在表达式后加上分号，它就会变成一条语句，再也</font><strong><font style="color:rgb(0, 0, 0);">不会</font></strong><font style="color:rgb(0, 0, 0);">返回一个值</font></p>
<p><font style="color:rgb(0, 0, 0);">表达式如果不返回任何值，会隐式地返回一个 </font><a target="_blank" rel="noopener" href="https://course.rs/basic/base-type/char-bool.html#%E5%8D%95%E5%85%83%E7%B1%BB%E5%9E%8B"><font style="color:rgb(32, 96, 159);">()</font></a></p>
<h5 id="举例"><a href="#举例" class="headerlink" title="举例"></a><font style="color:rgb(32, 96, 159);">举例</font></h5><p><font style="color:rgb(32, 96, 159);">x+&#x3D;2 是语句,不是表达式 v会返回()</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">     <span class="keyword">let</span> <span class="variable">v</span> = &#123;</span><br><span class="line">       <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">x</span> = <span class="number">1</span>;</span><br><span class="line">       x += <span class="number">2</span></span><br><span class="line">   &#125;;</span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, v);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(32, 96, 159);">这样x会返回3</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">     <span class="keyword">let</span> <span class="variable">v</span> = &#123;</span><br><span class="line">       <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">x</span> = <span class="number">1</span>;</span><br><span class="line">       x += <span class="number">2</span>;x</span><br><span class="line">   &#125;;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(v, <span class="number">3</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="常见格式化符号汇总"><a href="#常见格式化符号汇总" class="headerlink" title="常见格式化符号汇总"></a>常见格式化符号汇总</h3><table>
<thead>
<tr>
<th>占位符</th>
<th>含义</th>
<th>示例输出</th>
</tr>
</thead>
<tbody><tr>
<td><code>&#123;&#125;</code></td>
<td>默认格式（Display）</td>
<td><code>123</code>, <code>&quot;abc&quot;</code></td>
</tr>
<tr>
<td><code>&#123;:?&#125;</code></td>
<td>Debug 格式</td>
<td><code>[1, 2, 3]</code>, <code>MyStruct &#123;..&#125;</code></td>
</tr>
<tr>
<td><code>&#123;:#?&#125;</code></td>
<td>Pretty Debug（换行）</td>
<td>多行更易读的调试输出</td>
</tr>
<tr>
<td><code>&#123;:x&#125;</code></td>
<td>十六进制（小写）</td>
<td><code>ff</code></td>
</tr>
<tr>
<td><code>&#123;:X&#125;</code></td>
<td>十六进制（大写）</td>
<td><code>FF</code></td>
</tr>
<tr>
<td><code>&#123;:b&#125;</code></td>
<td>二进制</td>
<td><code>11111111</code></td>
</tr>
<tr>
<td><code>&#123;:o&#125;</code></td>
<td>八进制</td>
<td><code>377</code></td>
</tr>
<tr>
<td><code>&#123;:p&#125;</code></td>
<td>指针地址</td>
<td><code>0x7ffeeafd8a30</code>（仅指针）</td>
</tr>
<tr>
<td><code>&#123;:e&#125;</code></td>
<td>科学计数法（小写）</td>
<td><code>1.23e4</code></td>
</tr>
<tr>
<td><code>&#123;:E&#125;</code></td>
<td>科学计数法（大写）</td>
<td><code>1.23E4</code></td>
</tr>
<tr>
<td><code>&#123;:&gt;5&#125;</code></td>
<td>右对齐宽度为5</td>
<td><code>&#39;   42&#39;</code></td>
</tr>
<tr>
<td><code>&#123;:0&gt;5&#125;</code></td>
<td>填充0右对齐</td>
<td><code>&#39;00042&#39;</code></td>
</tr>
</tbody></table>
<h3 id="常用的浮点方法"><a href="#常用的浮点方法" class="headerlink" title="常用的浮点方法"></a>常用的浮点方法</h3><table>
<thead>
<tr>
<th>方法</th>
<th>含义</th>
<th>示例</th>
<th>输出</th>
</tr>
</thead>
<tbody><tr>
<td><code>.abs()</code></td>
<td>绝对值</td>
<td><code>(-3.5_f64).abs()</code></td>
<td><code>3.5</code></td>
</tr>
<tr>
<td><code>.ceil()</code></td>
<td>向上取整</td>
<td><code>2.3_f32.ceil()</code></td>
<td><code>3.0</code></td>
</tr>
<tr>
<td><code>.floor()</code></td>
<td>向下取整</td>
<td><code>2.9_f64.floor()</code></td>
<td><code>2.0</code></td>
</tr>
<tr>
<td><code>.round()</code></td>
<td>四舍五入</td>
<td><code>2.5_f32.round()</code></td>
<td><code>3.0</code></td>
</tr>
<tr>
<td><code>.trunc()</code></td>
<td>截断小数</td>
<td><code>2.9_f64.trunc()</code></td>
<td><code>2.0</code></td>
</tr>
<tr>
<td><code>.fract()</code></td>
<td>小数部分</td>
<td><code>3.1415_f64.fract()</code></td>
<td><code>0.1415</code></td>
</tr>
<tr>
<td><code>.sqrt()</code></td>
<td>平方根</td>
<td><code>9.0_f64.sqrt()</code></td>
<td><code>3.0</code></td>
</tr>
<tr>
<td><code>.powi(n)</code></td>
<td>整数次方</td>
<td><code>2.0_f32.powi(3)</code></td>
<td><code>8.0</code></td>
</tr>
<tr>
<td><code>.powf(x)</code></td>
<td>浮点次方</td>
<td><code>4.0_f64.powf(0.5)</code></td>
<td><code>2.0</code></td>
</tr>
<tr>
<td><code>.sin()</code> &#x2F; <code>.cos()</code></td>
<td>三角函数</td>
<td><code>std::f64::consts::PI.sin()</code></td>
<td><code>≈ 0.0</code></td>
</tr>
<tr>
<td><code>.ln()</code></td>
<td>自然对数</td>
<td><code>2.71828_f64.ln()</code></td>
<td><code>≈ 1.0</code></td>
</tr>
<tr>
<td><code>.log(base)</code></td>
<td>任意底对数</td>
<td><code>100.0_f64.log(10.0)</code></td>
<td><code>2.0</code></td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/22/%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B/" data-id="cmcfzbtts0006ggqwbk6g77ti" data-title="基础类型" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-流程控制" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/20/%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" class="article-date">
  <time class="dt-published" datetime="2025-06-20T08:44:40.000Z" itemprop="datePublished">2025-06-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/20/%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/">流程控制</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="if-来做分支控制"><a href="#if-来做分支控制" class="headerlink" title="if 来做分支控制"></a>if 来做分支控制</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> condition == <span class="literal">true</span> &#123;</span><br><span class="line">    <span class="comment">// A...</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// B...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="else-if-处理多重条件"><a href="#else-if-处理多重条件" class="headerlink" title="else if 处理多重条件"></a>else if 处理多重条件</h4><p><font style="color:rgb(0, 0, 0);">有多个分支能匹配，只有第一个匹配的分支会被执行</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">n</span> = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">4</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is divisible by 4&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> n % <span class="number">3</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is divisible by 3&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is divisible by 2&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;number is not divisible by 4, 3, or 2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="循环控制"><a href="#循环控制" class="headerlink" title="循环控制"></a>循环控制</h4><p><font style="color:rgb(0, 0, 0);">在 Rust 语言中有三种循环方式：</font><code>for</code><font style="color:rgb(0, 0, 0);">、</font><code>while</code><font style="color:rgb(0, 0, 0);"> 和 </font><code>loop</code></p>
<h5 id="for"><a href="#for" class="headerlink" title="for"></a><font style="color:rgb(48, 25, 0);background-color:rgb(246, 247, 246);">for</font></h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> 元素 <span class="keyword">in</span> 集合 &#123;</span><br><span class="line">  <span class="comment">// 使用元素干一些你懂我不懂的事情</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过索引和值的方式迭代数组</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过索引和值的方式迭代数组 `a`</span></span><br><span class="line">    <span class="keyword">for</span> (i,v) <span class="keyword">in</span> a.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">enumerate</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;第&#123;&#125;个元素是&#123;&#125;&quot;</span>,i+<span class="number">1</span>,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="while"><a href="#while" class="headerlink" title="while"></a>while</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">n</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> n &lt;= <span class="number">5</span>  &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;!&quot;</span>, n);</span><br><span class="line"></span><br><span class="line">        n = n + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;我出来了！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="loop"><a href="#loop" class="headerlink" title="loop"></a>loop</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">n</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> n &gt; <span class="number">5</span> &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, n);</span><br><span class="line">        n+=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;我出来了！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0, 0, 0);">使用 </font><code>loop</code><font style="color:rgb(0, 0, 0);"> 时，必不可少的伙伴是 </font><code>break</code><font style="color:rgb(0, 0, 0);"> 关键字，它能让循环在满足某个条件时跳出</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number</span> = <span class="keyword">loop</span> &#123;</span><br><span class="line">        count +=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> count == <span class="number">10</span> &#123;</span><br><span class="line">            <span class="keyword">break</span> count;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The number is &#123;&#125;&quot;</span>, number)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="循环标签：在多个循环之间消除歧义"><a href="#循环标签：在多个循环之间消除歧义" class="headerlink" title="循环标签：在多个循环之间消除歧义"></a>循环标签：在多个循环之间消除歧义</h6><p><code>break</code> 将只退出内层循环。<code>break &#39;counting_up;</code> 语句将退出外层循环</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="symbol">&#x27;counting_up</span>: <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;count = &#123;count&#125;&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">remaining</span> = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">loop</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;remaining = &#123;remaining&#125;&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> remaining == <span class="number">9</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> count == <span class="number">2</span> &#123;</span><br><span class="line">                <span class="keyword">break</span> <span class="symbol">&#x27;counting_up</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            remaining -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        count += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;End count = &#123;count&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="continue"><a href="#continue" class="headerlink" title="continue"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/flow-control.html#continue"><font style="color:rgb(0, 0, 0);">continue</font></a></h5><p>跳过当前的循环</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..<span class="number">4</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="break"><a href="#break" class="headerlink" title="break"></a><a target="_blank" rel="noopener" href="https://course.rs/basic/flow-control.html#break"><font style="color:rgb(0, 0, 0);">break</font></a></h5><p>跳过整个循环</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..<span class="number">4</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/20/%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" data-id="cmcfzbttw000iggqw1un1552m" data-title="流程控制" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-函数" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/20/%E5%87%BD%E6%95%B0/" class="article-date">
  <time class="dt-published" datetime="2025-06-20T01:06:09.000Z" itemprop="datePublished">2025-06-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/20/%E5%87%BD%E6%95%B0/">函数</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="函数的返回"><a href="#函数的返回" class="headerlink" title="函数的返回"></a>函数的返回</h3><ul>
<li>return + 分号</li>
<li>没有 return + 没有分号</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">add</span>(i: <span class="type">i32</span>, j: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">   i + j</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="无返回值"><a href="#无返回值" class="headerlink" title="无返回值"></a>无返回值</h4><p>如果一个函数没有返回值，那么就返回<code>()</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">print</span>(i: <span class="type">i32</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print</span>(i: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> () &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数要点"><a href="#函数要点" class="headerlink" title="函数要点"></a>函数要点</h3><ul>
<li><font style="color:rgb(0, 0, 0);">函数名和变量名使用</font><a target="_blank" rel="noopener" href="https://course.rs/practice/naming.html"><font style="color:rgb(32, 96, 159);">蛇形命名法(snake case)</font></a><font style="color:rgb(0, 0, 0);">，例如 </font><code>fn add_two() &#123;&#125;</code></li>
<li><font style="color:rgb(0, 0, 0);">函数的位置可以随便放，Rust 不关心我们在哪里定义了函数，只要有定义即可</font></li>
<li><font style="color:#DF2A3F;">每个函数参数都需要标注类型</font></li>
</ul>
<p><font style="color:rgb(0, 0, 0);">当用 </font><code>!</code><font style="color:rgb(0, 0, 0);"> 作函数返回类型的时候，表示该函数永不返回( diverging functions )，特别的，这种语法往往用做会导致程序崩溃的函数</font></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">forever</span>() <span class="punctuation">-&gt;</span> ! &#123;</span><br><span class="line">  <span class="keyword">loop</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">dead_end</span>() <span class="punctuation">-&gt;</span> ! &#123;</span><br><span class="line">  <span class="built_in">panic!</span>(<span class="string">&quot;你已经到了穷途末路，崩溃吧！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/20/%E5%87%BD%E6%95%B0/" data-id="cmcfzbttr0004ggqw9xi27jpg" data-title="函数" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/19/hello-world/" class="article-date">
  <time class="dt-published" datetime="2025-06-19T12:38:04.927Z" itemprop="datePublished">2025-06-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/19/hello-world/">hexo</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/19/hello-world/" data-id="cmcfzbttp0002ggqw2dk66udu" data-title="hexo" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%85%B6%E4%BB%96/" rel="tag">其他</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%B6%E4%BB%96/" rel="tag">其他</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Rust/" style="font-size: 20px;">Rust</a> <a href="/tags/%E5%85%B6%E4%BB%96/" style="font-size: 10px;">其他</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">June 2025</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/06/28/%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D/">模式匹配</a>
          </li>
        
          <li>
            <a href="/2025/06/27/%E7%BB%93%E6%9E%84%E4%BD%93/">结构体</a>
          </li>
        
          <li>
            <a href="/2025/06/26/%E6%9E%9A%E4%B8%BE/">枚举</a>
          </li>
        
          <li>
            <a href="/2025/06/25/%E5%AD%97%E7%AC%A6%E4%B8%B2/">字符串</a>
          </li>
        
          <li>
            <a href="/2025/06/24/%E6%95%B0%E7%BB%84%E5%88%87%E7%89%87/">数组切片</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>